import{g as d,p as u,r as o,B as g,M as c,P as y}from"./index-C5j2hIWS.js";const h=e=>d("/workflows",{params:e}),W=e=>u("/workflows",{body:e}),v=(e,t)=>u(`/workflows/${e}`,{body:t}),_=e=>d(`/workflows/${e}`),m=e=>u(`/workflows/${e}/delete`),b=e=>d(`/workflows/${e}/draft-graph`),P=e=>u(`/workflows/${e}/publish`),C=e=>u(`/workflows/${e}/cancel-publish`),G=()=>{const e=o(!1),t=o([]),s={current_page:1,page_size:20,total_page:0,total_record:0},a=o({...s});return{loading:e,workflows:t,paginator:a,loadWorkflows:async(i="",f="",r=!1)=>{if(r)a.value=s;else if(a.value.current_page>a.value.total_page)return;try{e.value=!0;const n=(await h({current_page:a.value.current_page,page_size:a.value.page_size,search_word:i,status:f})).data;a.value=n.paginator,a.value.current_page<=a.value.total_page&&(a.value.current_page+=1),r?t.value=n.list:t.value.push(...n.list)}finally{e.value=!1}}}},$=()=>{const e=o(!1),t=g();return{loading:e,handleCreateWorkflow:async a=>{try{e.value=!0;const l=await W(a);c.success("创建工作流成功"),await t.push({name:"space-workflows-detail",params:{workflow_id:l.data.id}})}finally{e.value=!1}}}},x=()=>{const e=o(!1);return{loading:e,handleUpdateWorkflow:async(s,a)=>{try{e.value=!0;const l=await v(s,a);c.success(l.message)}finally{e.value=!1}}}},z=()=>{const e=o(!1),t=o({});return{loading:e,workflow:t,loadWorkflow:async a=>{try{e.value=!0;const l=await _(a);t.value=l.data}finally{e.value=!1}}}},M=()=>({handleDeleteWorkflow:(t,s)=>{y.warning({title:"要删除该工作流吗?",content:"删除工作流后，发布的WebApp、开放API以及关联的社交媒体平台均无法使用该工作流，如果需要暂停工作流，可使用取消发布功能。",hideCancel:!1,onOk:async()=>{try{const a=await m(t);c.success(a.message)}finally{s&&s()}}})}}),U=()=>{const e=o(!1),t=o([]),s=o([]);return{loading:e,nodes:t,edges:s,loadDraftGraph:async l=>{try{e.value=!0;const f=(await b(l)).data;t.value=f.nodes.map(r=>{const{id:p,node_type:n,position:w,...k}=r;return{id:p,type:n,position:w,data:k}}),s.value=f.edges.map(r=>({...r,animated:!0,style:{strokeWidth:2,stroke:"#9ca3af"}}))}finally{t.value=[{id:"1-1",type:"start",position:{x:112.1,y:112.1},data:{name:"开始节点",type:"start",data:[]}},{id:"1-2",type:"code",position:{x:12.1,y:12.1},data:{name:"代码节点",type:"code",data:[]}}],s.value=[{id:"211212",source:"1-1",source_type:"start",target:"1-2",target_type:"code",animated:!0,style:{strokeWidth:2,stroke:"#9ca3af"}}],e.value=!1}}}},A=()=>{const e=o(!1);return{loading:e,handlePublishWorkflow:async s=>{try{e.value=!0;const a=await P(s);c.success(a.message)}finally{e.value=!1}}}},B=()=>{const e=o(!1);return{loading:e,handleCancelPublish:async s=>{try{e.value=!0;const a=await C(s);c.success(a.message)}finally{e.value=!1}}}};export{x as a,z as b,G as c,M as d,U as e,A as f,B as g,$ as u};
