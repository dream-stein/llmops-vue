import{a as te,r as $,p as P,h as ae,o as u,i as U,w as t,f as a,b as l,e,g,v as se,c as v,t as x,u as o,F as oe,s as ne,j as ie,k as de,l as re}from"./index-DGwnYLwc.js";import{h as le}from"./moment-C5S46NFB.js";import{c as ce,d as ue,e as _e,f as me}from"./use-dataset-mITRr4UQ.js";import{u as pe,a as ge,h as fe,b as be}from"./dataset-CVxg7v4t.js";import"./request-DcNozaMm.js";const ye={class:"flex items-center justify-between"},ve={class:"pt-6"},xe={class:"flex items-center justify-between"},he=te({__name:"UpdateDocumentNameModal",props:{visible:{type:Boolean,required:!0},dataset_id:{type:String,required:!0},document_id:{type:String,required:!0},onAfterUpdate:{type:Function,required:!1,default:()=>{}}},emits:["update:visible"],setup(T,{emit:m}){const f=T,D=m,w=$(!1),p=P({name:""}),b=$(),k=()=>{var d;D("update:visible",!1),(d=b.value)==null||d.resetFields()},C=async({errors:d})=>{if(!d)try{w.value=!0;const c=await pe(f.dataset_id,f.document_id,p.name);se.success(c.message),k(),f.onAfterUpdate()}finally{w.value=!1}};return ae(()=>f.visible,async d=>{var c;if(d){const h=(await ge(f.dataset_id,f.document_id)).data;(c=b.value)==null||c.resetFields(),p.name=h.name}}),(d,c)=>{const V=a("icon-close"),h=a("a-button"),y=a("a-input"),_=a("a-form-item"),S=a("a-space"),E=a("a-form"),r=a("a-modal");return u(),U(r,{width:520,visible:T.visible,"hide-title":"",footer:!1,"modal-class":"rounded-xl",onCancel:k},{default:t(()=>[l("div",ye,[c[1]||(c[1]=l("div",{class:"text-lg font-bold text-gray-700"},"重命名",-1)),e(h,{type:"text",class:"!text-gray-700",size:"small",onClick:k},{icon:t(()=>[e(V)]),_:1})]),l("div",ve,[e(E,{ref_key:"formRef",ref:b,model:p,onSubmit:C,layout:"vertical"},{default:t(()=>[e(_,{field:"name",label:"名称","asterisk-position":"end",rules:[{required:!0,message:"文档名称不能为空"}]},{default:t(()=>[e(y,{modelValue:p.name,"onUpdate:modelValue":c[0]||(c[0]=s=>p.name=s),placeholder:"请输入文档名称","show-word-limit":"","max-length":100},null,8,["modelValue"])]),_:1}),l("div",xe,[c[4]||(c[4]=l("div",{class:""},null,-1)),e(S,{size:16},{default:t(()=>[e(h,{class:"rounded-lg",onClick:k},{default:t(()=>c[2]||(c[2]=[g("取消")])),_:1}),e(h,{loading:w.value,type:"primary","html-type":"submit",class:"rounded-lg"},{default:t(()=>c[3]||(c[3]=[g(" 保存 ")])),_:1},8,["loading"])]),_:1})])]),_:1},8,["model"])])]),_:1},8,["visible"])}}}),we={class:""},ke={class:"flex items-center justify-between"},qe={class:"pt-6"},ze={class:"w-full flex justify-between gap-2"},Ce={class:"flex flex-col w-1/2"},$e={class:"border border-blue-700 bg-blue-100 rounded-lg flex flex-col mb-6"},De={class:"flex items-center justify-between px-4 py-1.5"},Ve={key:0,class:""},Se={key:1,class:""},je={key:2,class:""},Me={class:"bg-white rounded-lg p-2"},Ue={class:"flex items-center justify-between"},Re={class:""},Fe={class:"line-clamp-1"},Te={class:""},He={class:"w-1/2"},Le={class:"p-4 bg-gray-50 rounded-lg cursor-pointer"},Ye={key:0,class:"flex items-center gap-2 mb-1.5"},Ne={class:"text-gray-700 text-xs"},Be={class:"text-gray-500 line-clamp-4 h-[88px] break-all"},Oe={class:"flex items-center gap-2 text-gray-500 text-xs"},Ae={class:"line-clamp-1"},Pe={class:"flex items-center justify-between"},Ee={class:"flex items-center gap-4 w-full pl-3"},Ge={class:"flex items-center gap-4 w-full pl-3"},Ie={class:"flex items-center justify-between"},Qe=te({__name:"HitTestingModal",props:{visible:{type:Boolean,required:!0},dataset_id:{type:String,required:!0}},emits:["update:visible"],setup(T,{emit:m}){const f=T,D=m,w=$(!1),p=P([]),b=async()=>{try{w.value=!0;const s=(await be(f.dataset_id)).data;p.splice(0,p.length,...s)}finally{p.splice(0,p.length,{id:"26834b62-8bb4-410b-a626-00aded4892b9",dataset_id:"e1baf52a-1be2-4b93-ad62-6fad72f1ec37",query:"LLMOps是什么？",source:"Hit Testing",created_at:1726858849},{id:"c9fdef30-e821-480c-be6f-e355ab40eb7d",query:"想学习flask，有什么建议么？",source:"hit_testing",created_at:1728782165,dataset_id:"f3f28f75-8e60-4eba-b6df-4d1b390bbd89"},{id:"14ca23f5-2d51-4aee-b0e2-abc83a6ddffa",query:"想学习flask，有什么建议么？",source:"hit_testing",created_at:1728782165,dataset_id:"f3f28f75-8e60-4eba-b6df-4d1b390bbd89"},{id:"21f75ca5-ed0c-4369-8c2a-6dfb4842b3d1",query:"想学习flask，有什么建议么？",source:"hit_testing",dataset_id:"f3f28f75-8e60-4eba-b6df-4d1b390bbd89",created_at:1728782165}),w.value=!1}},k=$(!1),C={retrieval_strategy:"semantic",k:5,score:.5},d=P({...C}),c=()=>{Object.assign(d,{..._}),k.value=!1},V=()=>{y.splice(0,y.length),Object.assign(_,{query:_.query,...d}),k.value=!1},h=$(!1),y=P([]),_=P({query:"",...C}),S=()=>D("update:visible",!1),E=async()=>{if(_.query.trim()===""){se.error("检索源文本不能为空");return}try{h.value=!0;const s=(await fe(f.dataset_id,_)).data;y.splice(0,y.length,...s),await b()}finally{y.splice(0,y.length,{id:"1",document:{id:"2",name:"LLMOps项目API文档.md"},dataset_id:"3",position:1,score:.54,content:"推荐技能",keywords:["社交","App","成本","功能","内容分发"],character_count:487,token_count:407,hit_count:1,enabled:!0,disabled_at:0,status:"completed",error:"",updated_at:1726858854,created_at:1726858854},{id:"2",document:{id:"9",name:"天文学基础.md"},dataset_id:"3",position:1,score:.99,content:"由于宇宙暗物质的摩擦而引发的光谱湮灭现象",keywords:["社交","App","成本","功能","内容分发"],character_count:487,token_count:407,hit_count:1,enabled:!0,disabled_at:0,status:"completed",error:"",updated_at:1726858854,created_at:1726858854}),h.value=!1}};return ae(()=>f.visible,async r=>{r?await b():(p.splice(0,p.length),y.splice(0,y.length),Object.assign(_,{query:"",...C}),Object.assign(d,{...C}))}),(r,s)=>{const j=a("icon-close"),z=a("a-button"),W=a("icon-language"),R=a("a-textarea"),H=a("a-tag"),L=a("a-table-column"),Y=a("a-table"),q=a("a-divider"),J=a("icon-pushpin"),G=a("a-progress"),K=a("icon-file"),X=a("a-col"),I=a("a-row"),Z=a("a-empty"),ee=a("a-spin"),N=a("a-modal"),Q=a("a-radio-group"),F=a("a-form-item"),B=a("a-slider"),O=a("a-input-number"),i=a("a-space"),M=a("a-form");return u(),v("div",we,[e(N,{width:1e3,visible:f.visible,"hide-title":"",footer:!1,"modal-class":"rounded-xl h-3/4 overflow-auto scrollbar-w-none",onCancel:S},{default:t(()=>[l("div",ke,[s[8]||(s[8]=l("div",{class:"text-lg font-bold text-gray-700"},"召回测试",-1)),e(z,{type:"text",class:"!text-gray-700",size:"small",onClick:S},{icon:t(()=>[e(j)]),_:1})]),s[12]||(s[12]=l("div",{class:"text-gray-500"},"基于给定的查询文本测试知识库的召回效果",-1)),l("div",qe,[l("div",ze,[l("div",Ce,[l("div",$e,[l("div",De,[s[9]||(s[9]=l("div",{class:"font-bold text-gray-900"},"源文本",-1)),e(z,{size:"small",class:"rounded-lg px-2",onClick:s[0]||(s[0]=n=>k.value=!0)},{icon:t(()=>[e(W)]),default:t(()=>[_.retrieval_strategy==="semantic"?(u(),v("div",Ve," 相似性检索 ")):_.retrieval_strategy==="full_text"?(u(),v("div",Se," 全文检索 ")):(u(),v("div",je,"混合检索"))]),_:1})]),l("div",Me,[e(R,{"model-value":_.query,"onUpdate:modelValue":s[1]||(s[1]=n=>_.query=n),placeholder:"请输入文本，建议使用简短的陈述句","max-length":200,"auto-size":{minRows:6,maxRows:6},class:"!bg-white !border-0 mb-1"},null,8,["model-value"]),l("div",Ue,[e(H,{size:"small",class:"rounded text-gray-700"},{default:t(()=>[g(x(_.query.length)+"/200 ",1)]),_:1}),e(z,{loading:h.value,type:"primary",size:"small",class:"rounded-lg",onClick:E},{default:t(()=>s[10]||(s[10]=[g("召回测试")])),_:1},8,["loading"])])])]),l("div",Re,[s[11]||(s[11]=l("div",{class:"text-gray-700 font-bold mb-4"},"最近查询",-1)),e(Y,{loading:w.value,pagination:!1,size:"small",bordered:{wrapper:!1},data:p,onRowClick:s[2]||(s[2]=n=>_.query=n.query)},{columns:t(()=>[e(L,{title:"数据源","data-index":"source","header-cell-class":"text-gray-500 bg-transparent border-b font-bold","cell-class":"text-gray-500",width:110}),e(L,{title:"文本","data-index":"query","header-cell-class":"text-gray-500 bg-transparent border-b font-bold","cell-class":"text-gray-500"},{cell:t(({record:n})=>[l("div",Fe,x(n.query),1)]),_:1}),e(L,{title:"时间","data-index":"created_at","header-cell-class":"text-gray-500 bg-transparent border-b font-bold","cell-class":"text-gray-500",width:160},{cell:t(({record:n})=>[l("div",Te,x(o(le)(n.created_at*1e3).format("YYYY-MM-DD HH:mm")),1)]),_:1})]),_:1},8,["loading","data"])])]),e(q,{direction:"vertical"}),l("div",He,[e(ee,{loading:h.value,class:"w-full"},{default:t(()=>[y.length>0?(u(),U(I,{key:0,gutter:[16,16]},{default:t(()=>[(u(!0),v(oe,null,ne(y,n=>(u(),U(X,{key:n.id,span:12},{default:t(()=>[l("div",Le,[_.retrieval_strategy==="semantic"?(u(),v("div",Ye,[e(J),e(G,{"stroke-width":6,"show-text":!1,percent:n.score},null,8,["percent"]),l("div",Ne,x(n.score.toFixed(2)),1)])):ie("",!0),l("div",Be,x(n.content),1),e(q,{class:"my-2"}),l("div",Oe,[e(K,{class:"flex-shrink-0"}),l("div",Ae,x(n.document.name),1)])])]),_:2},1024))),128))]),_:1})):(u(),U(Z,{key:1}))]),_:1},8,["loading"])])])])]),_:1},8,["visible"]),e(N,{visible:k.value,"hide-title":"",footer:!1,"modal-class":"rounded-xl"},{default:t(()=>[l("div",Pe,[s[13]||(s[13]=l("div",{class:"text-lg font-bold text-gray-700"},"检索设置",-1)),e(z,{type:"text",class:"!text-gray-700",size:"small",onClick:c},{icon:t(()=>[e(j)]),_:1})]),e(M,{model:d,onSubmit:V,class:"pt-6"},{default:t(()=>[e(F,{field:"retrieval_strategy",label:"检索策略","label-align":"left"},{default:t(()=>[e(Q,{"model-value":d.retrieval_strategy,"onUpdate:modelValue":s[3]||(s[3]=n=>d.retrieval_strategy=n),"default-value":"semantic",options:[{label:"混合检索",value:"hybrid"},{label:"文本检索",value:"full_text"},{label:"相似度检索",value:"semantic"}]},null,8,["model-value"])]),_:1}),e(F,{field:"k",label:"最大召回数量"},{default:t(()=>[l("div",Ee,[e(B,{"model-value":d.k,"onUpdate:modelValue":s[4]||(s[4]=n=>d.k=n),step:1,min:1,max:10},null,8,["model-value"]),e(O,{"model-value":d.k,"onUpdate:modelValue":s[5]||(s[5]=n=>d.k=n),class:"w-[80px]","default-value":4},null,8,["model-value"])])]),_:1}),e(F,{field:"k",label:"最小匹配度"},{default:t(()=>[l("div",Ge,[e(B,{"model-value":d.score,"onUpdate:modelValue":s[6]||(s[6]=n=>d.score=n),step:.01,min:0,max:.99},null,8,["model-value"]),e(O,{"model-value":d.score,"onUpdate:modelValue":s[7]||(s[7]=n=>d.score=n),class:"w-[80px]",min:0,max:.99,step:.01,precision:2,"default-value":.5},null,8,["model-value"])])]),_:1}),l("div",Ie,[s[16]||(s[16]=l("div",{class:""},null,-1)),e(i,{size:16},{default:t(()=>[e(z,{class:"rounded-lg",onClick:c},{default:t(()=>s[14]||(s[14]=[g("取消")])),_:1}),e(z,{type:"primary","html-type":"submit",class:"rounded-lg"},{default:t(()=>s[15]||(s[15]=[g(" 保存 ")])),_:1})]),_:1})])]),_:1},8,["model"])]),_:1},8,["visible"])])}}}),We={class:"p-6"},Je={class:"flex items-center w-full gap-2 mb-6"},Ke={class:"flex items-center gap-3"},Xe={class:"flex flex-col justify-between h-[40px]"},Ze={key:1,class:"text-gray-700"},et={key:2,class:"flex items-center gap-2"},tt={key:3,class:"flex items-center gap-2"},at={class:"flex items-center justify-between mb-6"},st={class:""},lt={class:"line-clamp-1"},ot={key:0,class:"w-2 h-2 bg-green-500 rounded-sm border border-green-700"},nt={key:1,class:"w-2 h-2 bg-gray-500 rounded-sm border border-gray-700"},it={key:2,class:"text-gray-700"},dt={key:3,class:"text-gray-700"},pt=te({__name:"ListView",setup(T){var _,S;const m=de(),f=re(),D=$(!1),w=$(!1),p=$(""),{dataset:b,loadDataset:k}=ce((_=m.params)==null?void 0:_.dataset_id),{loading:C,documents:d,paginator:c,loadDocuments:V}=ue((S=m.params)==null?void 0:S.dataset_id),{handleDelete:h}=_e(),{handleUpdate:y}=me();return(E,r)=>{var N,Q,F,B,O;const s=a("icon-left"),j=a("a-button"),z=a("router-link"),W=a("a-avatar"),R=a("a-skeleton-line"),H=a("a-tag"),L=a("a-input-search"),Y=a("a-space"),q=a("a-table-column"),J=a("a-divider"),G=a("a-switch"),K=a("a-tooltip"),X=a("icon-more"),I=a("a-doption"),Z=a("a-dropdown"),ee=a("a-table");return u(),v("div",We,[l("div",Je,[e(z,{to:{name:"space-datasets-list"}},{default:t(()=>[e(j,{size:"mini",type:"text",class:"!text-gray-700"},{icon:t(()=>[e(s)]),_:1})]),_:1}),l("div",Ke,[e(W,{size:40,shape:"square",class:"rounded-lg","image-url":o(b).icon},null,8,["image-url"]),l("div",Xe,[(N=o(b))!=null&&N.name?(u(),v("div",Ze,"知识库 / "+x(o(b).name),1)):(u(),U(R,{key:0,widths:[100]})),(Q=o(b))!=null&&Q.name?(u(),v("div",tt,[e(H,{size:"small",class:"rounded h-[18px] leading-[18px] bg-gray-200 text-gray-500"},{default:t(()=>[g(x(o(b).document_count)+" 文档",1)]),_:1}),e(H,{size:"small",class:"rounded h-[18px] leading-[18px] bg-gray-200 text-gray-500"},{default:t(()=>[g(x(o(b).hit_count)+" 命中",1)]),_:1}),e(H,{size:"small",class:"rounded h-[18px] leading-[18px] bg-gray-200 text-gray-500"},{default:t(()=>[g(x(o(b).related_app_count)+" 关联应用",1)]),_:1})])):(u(),v("div",et,[e(R,{widths:[60],"line-height":18}),e(R,{widths:[60],"line-height":18}),e(R,{widths:[60],"line-height":18})]))])])]),l("div",at,[e(L,{"default-value":((F=o(m).query)==null?void 0:F.search_word)||"",placeholder:"请输入关键词搜素文档",class:"w-[240px] bg-white rounded-lg border-gray-200",onSearch:r[0]||(r[0]=i=>{o(f).push({path:o(m).path,query:{search_word:i,current_page:1}})})},null,8,["default-value"]),e(Y,{size:12},{default:t(()=>{var i;return[e(j,{class:"rounded-lg",onClick:r[1]||(r[1]=M=>D.value=!0)},{default:t(()=>r[5]||(r[5]=[g("召回测试")])),_:1}),e(z,{to:{name:"space-datasets-documents-create",params:{dataset_id:(i=o(m).params)==null?void 0:i.dataset_id}}},{default:t(()=>[e(j,{type:"primary",class:"rounded-lg"},{default:t(()=>r[6]||(r[6]=[g("添加文件")])),_:1})]),_:1},8,["to"])]}),_:1})]),l("div",st,[e(ee,{hoverable:"",pagination:{total:o(c).total_record,current:o(c).current_page,defaultCurrent:1,pageSize:o(c).page_size,defaultPageSize:20,showTotal:!0},loading:o(C),data:o(d),bordered:{wrapper:!1},onPageChange:r[2]||(r[2]=i=>{var M;o(f).push({path:o(m).path,query:{current_page:i,search_word:((M=o(m).query)==null?void 0:M.search_word)||""}})})},{columns:t(()=>[e(q,{title:"#","data-index":"position",align:"center",width:80,"header-cell-class":"rounded-tl-lg !bg-gray-200 text-gray-700","cell-class":"bg-transparent text-gray-700"}),e(q,{title:"文档名","data-index":"name",width:400,"header-cell-class":"!bg-gray-200 text-gray-700","cell-class":"bg-transparent text-gray-700"},{cell:t(({record:i})=>[l("div",lt,x(i.name),1)]),_:1}),e(q,{title:"字符数","data-index":"character_count","header-cell-class":"!bg-gray-200 text-gray-700","cell-class":"bg-transparent text-gray-700"},{cell:t(({record:i})=>[g(x((i.character_count/1e3).toFixed(1))+"k ",1)]),_:1}),e(q,{title:"召回次数","data-index":"hit_count","header-cell-class":"!bg-gray-200 text-gray-700","cell-class":"bg-transparent text-gray-700"}),e(q,{title:"上传时间","data-index":"created_at","header-cell-class":"!bg-gray-200 text-gray-700","cell-class":"bg-transparent text-gray-700"},{cell:t(({record:i})=>[g(x(o(le)(i.created_at*1e3).format("YYYY-MM-DD HH:mm:ss")),1)]),_:1}),e(q,{title:"状态","data-index":"enabled","header-cell-class":"!bg-gray-200 text-gray-700","cell-class":"bg-transparent text-gray-700"},{cell:t(({record:i})=>[e(Y,null,{default:t(()=>[i.enabled?(u(),v("div",ot)):(u(),v("div",nt)),i.enabled?(u(),v("div",it,"可用")):(u(),v("div",dt,"已禁用"))]),_:2},1024)]),_:1}),e(q,{title:"操作","data-index":"operator","header-cell-class":"rounded-tr-lg !bg-gray-200 text-gray-700","cell-class":"bg-transparent text-gray-700 !h-[40px]",width:100},{cell:t(({record:i,rowIndex:M})=>[e(Y,{size:0},{split:t(()=>[e(J,{direction:"vertical"})]),default:t(()=>[i.status==="error"?(u(),U(K,{key:0,content:`错误信息:${i.error}`},{default:t(()=>[e(G,{size:"small",type:"round","default-checked":!1,disabled:""})]),_:2},1032,["content"])):(u(),U(G,{key:1,size:"small","checked-color":"#10b981",type:"round","unchecked-color":"#556581","model-value":i.enabled,onChange:n=>{var A;o(y)((A=o(m).params)==null?void 0:A.dataset_id,i.id,n,()=>{o(d)[M].enabled=n})}},null,8,["model-value","onChange"])),e(Z,{position:"br"},{content:t(()=>[e(I,{onClick:()=>{w.value=!0,p.value=i.id}},{default:t(()=>r[7]||(r[7]=[g("重命名")])),_:2},1032,["onClick"]),e(I,{class:"!text-red-700",onClick:()=>{var n;return o(h)((n=o(m).params)==null?void 0:n.dataset_id,i.id,async()=>{var A;await o(V)(),await o(k)((A=o(m).params)==null?void 0:A.dataset_id)})}},{default:t(()=>r[8]||(r[8]=[g("删除")])),_:2},1032,["onClick"])]),default:t(()=>[e(j,{type:"text",size:"small",class:"!text-gray-700"},{icon:t(()=>[e(X)]),_:1})]),_:2},1024)]),_:2},1024)]),_:1})]),_:1},8,["pagination","loading","data"])]),e(he,{document_id:p.value,dataset_id:(B=o(m).params)==null?void 0:B.dataset_id,visible:w.value,"onUpdate:visible":r[3]||(r[3]=i=>w.value=i),"on-after-update":()=>o(V)()},null,8,["document_id","dataset_id","visible","on-after-update"]),e(Qe,{visible:D.value,"onUpdate:visible":r[4]||(r[4]=i=>D.value=i),dataset_id:(O=o(m).params)==null?void 0:O.dataset_id},null,8,["visible","dataset_id"])])}}});export{pt as default};
