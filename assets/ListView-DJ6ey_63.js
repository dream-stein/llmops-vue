import{m as G}from"./moment-Cj5kFoXT.js";import{u as O,a as P,b as J,c as K,d as Q}from"./use-workflow-4mXdWJIm.js";import{d as E,r as F,y as A,q as o,t as p,z as w,w as t,b as d,x as k,a as e,i as V,e as r,C as X,u as Y,o as Z,A as ee,c as te,j as oe,f as I,F as ae}from"./index-B9yvxFn-.js";const le={class:"flex items-center justify-between"},se={class:"text-lg font-bold text-gray-700"},ne={class:"pt-6"},ie={class:"flex items-center justify-between"},re=E({__name:"CreateOrUpdateWorkflowModal",props:{workflow_id:{type:String,default:"",required:!1},visible:{type:Boolean,required:!0},callback:{type:Function,required:!1}},emits:["update:visible","update:workflow_id"],setup(T,{emit:B}){const i=T,C=B,{loading:D,handleCreateWorkflow:b}=O(),{loading:x,handleUpdateWorkflow:R}=P(),{workflow:f,loadWorkflow:z}=J(),h={fileList:[],icon:"",name:"",tool_call_name:"",description:""},l=F({...h}),L=F(),U=()=>C("update:visible",!1),c=async({errors:s})=>{s||(i.workflow_id?await R(i.workflow_id,l.value):await b(l.value),C("update:visible",!1),i.callback&&i.callback())};return A(()=>i.visible,async s=>{var a,v,u,W,m,g,q;(a=L.value)==null||a.resetFields(),s?i.workflow_id&&(await z(i.workflow_id),l.value={fileList:[{uid:"1",name:"应用图标",url:String((v=f.value)==null?void 0:v.icon)}],icon:String((u=f.value)==null?void 0:u.icon),name:String((W=f.value)==null?void 0:W.name),tool_call_name:String((m=f.value)==null?void 0:m.tool_call_name),description:String((g=f.value)==null?void 0:g.description)}):(l.value=h,(q=L.value)==null||q.resetFields(),C("update:workflow_id",""))}),(s,a)=>{const v=o("icon-close"),u=o("a-button"),W=o("a-upload"),m=o("a-form-item"),g=o("a-input"),q=o("a-textarea"),$=o("a-space"),H=o("a-form"),S=o("a-modal");return p(),w(S,{width:520,visible:i.visible,"hide-title":"",footer:!1,"modal-class":"rounded-xl",onCancel:U},{default:t(()=>[d("div",le,[d("div",se,k(i.workflow_id===""?"创建工作流":"编辑工作流"),1),e(u,{type:"text",class:"!text-gray-700",size:"small",onClick:U},{icon:t(()=>[e(v)]),_:1})]),d("div",ne,[e(H,{ref_key:"formRef",ref:L,model:l.value,layout:"vertical",onSubmit:c},{default:t(()=>[e(m,{field:"fileList","hide-label":"",rules:[{required:!0,message:"工作流图标不能为空"}]},{default:t(()=>[e(W,{limit:1,"list-type":"picture-card",accept:"image/png, image/jpeg",class:"!w-auto mx-auto","file-list":l.value.fileList,"onUpdate:fileList":a[0]||(a[0]=_=>l.value.fileList=_),"image-preview":"","custom-request":_=>{const{fileItem:M,onSuccess:j,onError:N}=_;return(async()=>{try{const y=await r(X)(M.file);l.value.icon=y.data.image_url,j(y)}catch(y){N(y)}})(),{abort:()=>{}}},"on-before-remove":async()=>(l.value.icon="",!0)},null,8,["file-list","custom-request","on-before-remove"])]),_:1}),e(m,{field:"name",label:"工作流名称","asterisk-position":"end",rules:[{required:!0,message:"工作流名称不能为空"}]},{default:t(()=>[e(g,{"show-word-limit":"","max-length":50,"model-value":l.value.name,"onUpdate:modelValue":a[1]||(a[1]=_=>l.value.name=_),placeholder:"请输入工作流名称"},null,8,["model-value"])]),_:1}),e(m,{field:"tool_call_name",label:"英文名称","asterisk-position":"end",rules:[{required:!0,message:"英文名称不能为空"}]},{default:t(()=>[e(g,{"show-word-limit":"","max-length":50,"model-value":l.value.tool_call_name,"onUpdate:modelValue":a[2]||(a[2]=_=>l.value.tool_call_name=_),placeholder:"英文名称将用于被大模型识别及调用"},null,8,["model-value"])]),_:1}),e(m,{field:"description",label:"工作流描述","asterisk-position":"end",rules:[{required:!0,message:"工作流描述不能为空"}]},{default:t(()=>[e(q,{"model-value":l.value.description,"onUpdate:modelValue":a[3]||(a[3]=_=>l.value.description=_),"auto-size":{minRows:8,maxRows:8},"max-length":1024,"show-word-limit":"",placeholder:"请输入关于该工作流的描述信息，以便LLM能准确识别工作流的用途。"},null,8,["model-value"])]),_:1}),d("div",ie,[a[6]||(a[6]=d("div",{class:""},null,-1)),e($,{size:16},{default:t(()=>[e(u,{class:"rounded-lg",onClick:U},{default:t(()=>a[4]||(a[4]=[V("取消")])),_:1}),e(u,{loading:r(D)||r(x),type:"primary","html-type":"submit",class:"rounded-lg"},{default:t(()=>a[5]||(a[5]=[V(" 保存 ")])),_:1},8,["loading"])]),_:1})])]),_:1},8,["model"])])]),_:1},8,["visible"])}}}),ce={class:"flex items-center gap-3 mb-3"},de={class:"flex flex-1 justify-between"},ue={class:"flex flex-col"},_e={class:"text-xs text-gray-500 line-clamp-1"},me={class:"leading-[18px] text-gray-500 h-[72px] line-clamp-4 mb-2 break-all"},pe={class:"flex items-center gap-1.5"},fe={class:"text-xs text-gray-400"},ye=E({__name:"ListView",props:{createType:{type:String,default:"",required:!0}},emits:["update-create-type"],setup(T,{emit:B}){const i=ee(),C=T,D=B,b=F(!1),x=F(""),R=Y(),{loading:f,workflows:z,paginator:h,loadWorkflows:l}=K(),{handleDeleteWorkflow:L}=Q(),U=async c=>{var u;const{scrollTop:s,scrollHeight:a,clientHeight:v}=c.target;if(s+v>=a-10){if(f.value)return;await l(String(((u=i.query)==null?void 0:u.search_word)??""),"")}};return Z(async()=>{var c;await l(((c=i.query)==null?void 0:c.search_word)??"","",!0)}),A(()=>C.createType,c=>{c==="workflow"&&(x.value="",b.value=!0,D("update-create-type",""))}),A(()=>{var c;return(c=i.query)==null?void 0:c.search_word},async()=>{var c;return await l(((c=i.query)==null?void 0:c.search_word)??"","",!0)}),(c,s)=>{const a=o("a-avatar"),v=o("icon-check-circle-fill"),u=o("router-link"),W=o("icon-more"),m=o("a-button"),g=o("a-doption"),q=o("a-dropdown"),$=o("icon-user"),H=o("a-card"),S=o("a-col"),_=o("a-empty"),M=o("a-row"),j=o("a-spin"),N=o("a-space");return p(),w(j,{loading:r(f),class:"block h-full w-full scrollbar-w-none overflow-scroll",onScroll:U},{default:t(()=>[e(M,{gutter:[20,20],class:"flex-1"},{default:t(()=>[(p(!0),te(ae,null,oe(r(z),n=>(p(),w(S,{key:n.id,span:6},{default:t(()=>[e(H,{hoverable:"",class:"cursor-pointer rounded-lg"},{default:t(()=>[d("div",ce,[e(a,{size:40,shape:"square","image-url":n.icon},null,8,["image-url"]),d("div",de,[d("div",ue,[e(u,{to:{name:"space-workflows-detail",params:{workflow_id:n.id}},class:"text-base text-gray-900 font-bold"},{default:t(()=>[V(k(n.name)+" ",1),n.status==="published"?(p(),w(v,{key:0,class:"text-green-700"})):I("",!0)]),_:2},1032,["to"]),d("div",_e,k(n.tool_call_name)+" · "+k(n.node_count)+" 节点数 ",1)]),e(q,{position:"br"},{content:t(()=>[e(g,{onClick:()=>{x.value=n.id,b.value=!0}},{default:t(()=>s[2]||(s[2]=[V(" 编辑工作流 ")])),_:2},1032,["onClick"]),e(g,{class:"text-red-700",onClick:async()=>await r(L)(n.id,async()=>{var y;await r(l)(String(((y=r(i).query)==null?void 0:y.search_word)??""),"",!0)})},{default:t(()=>s[3]||(s[3]=[V(" 删除 ")])),_:2},1032,["onClick"])]),default:t(()=>[e(m,{type:"text",size:"small",class:"rounded-lg !text-gray-700"},{icon:t(()=>[e(W)]),_:1})]),_:2},1024)])]),d("div",me,k(n.description),1),d("div",pe,[e(a,{size:18,class:"bg-blue-700"},{default:t(()=>[e($)]),_:1}),d("div",fe,k(r(R).account.name)+" · 最近编辑 "+k(r(G)(n.created_at).format("MM-DD HH:mm")),1)])]),_:2},1024)]),_:2},1024))),128)),r(z).length===0?(p(),w(S,{key:0,span:24},{default:t(()=>[e(_,{description:"没有可用的工作流",class:"h-[400px] flex flex-col items-center justify-center"})]),_:1})):I("",!0)]),_:1}),r(h).total_page>=2?(p(),w(M,{key:0},{default:t(()=>[r(h).current_page<=r(h).total_page?(p(),w(S,{key:0,span:24,align:"center"},{default:t(()=>[e(N,{class:"my-4"},{default:t(()=>[e(j),s[4]||(s[4]=d("div",{class:"text-gray-400"},"加载中",-1))]),_:1})]),_:1})):(p(),w(S,{key:1,span:24,align:"center"},{default:t(()=>s[5]||(s[5]=[d("div",{class:"text-gray-400 my-4"},"数据已加载完成",-1)])),_:1}))]),_:1})):I("",!0),e(re,{visible:b.value,"onUpdate:visible":s[0]||(s[0]=n=>b.value=n),workflow_id:x.value,"onUpdate:workflow_id":s[1]||(s[1]=n=>x.value=n),callback:async()=>{var n;return await r(l)(((n=r(i).query)==null?void 0:n.search_word)??"","",!0)}},null,8,["visible","workflow_id","callback"])]),_:1},8,["loading"])}}});export{ye as default};
