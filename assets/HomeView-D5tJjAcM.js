import{s as K,p as D,g as J,r as d,M as H,d as R,u as X,o as Y,n as Z,c as w,a,b as r,e as u,w as h,f as ee,h as te,i as L,F as se,j as ne,k as ae,v as oe,l as le,m as ie,Q as q,q as y,t as k,x as re}from"./index-B-lOf3Wb.js";import{u as ue,s as ce,_ as ge,a as de,b as ve}from"./AiMessage.vue_vue_type_script_setup_true_lang-BjzCD0Wk.js";const pe=(s,l)=>K("/assistant-agent/chat",{body:{query:s}},l),_e=s=>D(`/assistant-agent/chat/${s}/stop`),fe=s=>J("/assistant-agent/messages",{params:s}),he=()=>D("/assistant-agent/delete-conversation"),ye=()=>{const s=d(!1);return{loading:s,handleAssistantAgentChat:async(i,c)=>{try{s.value=!0,await pe(i,c)}finally{s.value=!1}}}},xe=()=>{const s=d(!1);return{loading:s,handleStopAssistantAgentChat:async i=>{try{s.value=!0,await _e(i)}finally{s.value=!1}}}},Ae=()=>{const s=d(!1),l=d([]),i=d(0),c={current_page:1,page_size:5,total_page:0,total_record:0},n=d({...c});return{loading:s,messages:l,paginator:n,loadAssistantAgentMessages:async(C=!1)=>{var S;if(C)n.value={...c},i.value=0;else if(n.value.current_page>n.value.total_page)return;try{s.value=!0;const x=(await fe({current_page:n.value.current_page,page_size:n.value.page_size,created_at:i.value})).data;n.value=x.paginator,n.value.current_page<=n.value.total_page&&(n.value.current_page+=1),C?l.value=x.list:(l.value.push(...x.list),i.value=((S=x.list[0])==null?void 0:S.created_at)??0)}finally{s.value=!1}}}},me=()=>{const s=d(!1);return{loading:s,handleDeleteAssistantAgentConversation:async()=>{try{s.value=!0;const i=await he();H.success(i.message)}finally{s.value=!1}}}},be="/llmops-vue/assets/assistant-agent-background-Jf_uHUnU.png",we={class:"w-[600px] h-full min-h-screen mx-auto"},ke={key:0,class:"flex flex-col px-6 h-[calc(100%-100px)] min-h-[calc(100vh-100px)]"},Ce={class:"flex flex-col gap-6 py-6"},Se={key:0,class:"h-[50px] flex items-center justify-center"},Me={key:1,class:"flex flex-col p-6 gap-2 items-center justify-center overflow-scroll scrollbar-w-none h-[calc(100%-100px)] min-h-[calc(100vh-100px)]"},Le={class:"flex gap-2"},qe={class:"flex flex-col items-start gap-2"},Te={class:"bg-white border border-gray-200 text-gray-700 px-4 py-3 rounded-2xl break-all leading-7"},ze={class:"list-disc pl-6"},Ie={class:"flex flex-col gap-2"},$e=["onClick"],Be={class:"w-full flex flex-col flex-shrink-0"},He={class:"px-6 flex items-center gap-4"},Qe={class:"bg-white h-[50px] flex items-center gap-2 px-4 flex-1 border border-gray-200 rounded-full"},Pe=R({__name:"HomeView",setup(s){const l=d(""),i=d(""),c=d(""),n=d(null),T=d(0),C=X(),S=["什么是LLMOps?","我想创建一个应用","能介绍下什么是RAG吗?"],{suggested_questions:z,handleGenerateSuggestedQuestions:x}=ue(),{loading:m,handleAssistantAgentChat:P}=ye(),{loading:N,handleStopAssistantAgentChat:O}=xe(),{loading:G,messages:g,loadAssistantAgentMessages:I}=Ae(),{loading:j,handleDeleteAssistantAgentConversation:U}=me(),W=()=>{T.value=n.value.$el.scrollHeight},E=()=>{n.value.$el.scrollTop=n.value.$el.scrollHeight-T.value},F=async v=>{const{scrollTop:t}=v.target;t<=0&&!G.value&&(W(),await I(!1),E())},$=async()=>{if(l.value.trim()===""){H.warning("用户提问不能为空");return}if(m.value){H.warning("上一次提问还未结束，请稍等");return}z.value=[],c.value="",i.value="",g.value.unshift({id:"",conversation_id:"",query:l.value,answer:"",total_token_count:0,latency:0,agent_thoughts:[],created_at:0});let v=0;const t=l.value;l.value="",await P(t,_=>{var M;const f=_==null?void 0:_.event,e=_==null?void 0:_.data,b=e==null?void 0:e.id,p=g.value[0].agent_thoughts;if(c.value===""&&(e!=null&&e.message_id)&&(i.value=e==null?void 0:e.task_id,c.value=e==null?void 0:e.message_id,g.value[0].id=e==null?void 0:e.message_id,g.value[0].conversation_id=e==null?void 0:e.conversation_id),f!==q.ping){if(f===q.agentMessage){const A=p.findIndex(o=>(o==null?void 0:o.id)===b);A===-1?(v+=1,p.push({id:b,position:v,event:e==null?void 0:e.event,thought:e==null?void 0:e.thought,observation:e==null?void 0:e.observation,tool:e==null?void 0:e.tool,tool_input:e==null?void 0:e.tool_input,latency:e==null?void 0:e.latency,created_at:0})):p[A]={...p[A],thought:((M=p[A])==null?void 0:M.thought)+(e==null?void 0:e.thought),latency:e==null?void 0:e.latency},g.value[0].answer+=e==null?void 0:e.thought,g.value[0].latency=e==null?void 0:e.latency,g.value[0].total_token_count=e==null?void 0:e.total_token_count}else f===q.error?g.value[0].answer=e==null?void 0:e.observation:f===q.timeout?g.value[0].answer="当前Agent执行已超时，无法得到答案，请重试":(v+=1,p.push({id:b,position:v,event:e==null?void 0:e.event,thought:e==null?void 0:e.thought,observation:e==null?void 0:e.observation,tool:e==null?void 0:e.tool,tool_input:e==null?void 0:e.tool_input,latency:e==null?void 0:e.latency,created_at:0}));g.value[0].agent_thoughts=p,n.value.scrollToBottom()}}),c.value&&(await x(c.value),setTimeout(()=>n.value&&n.value.scrollToBottom(),100))},Q=async()=>{i.value===""||!m.value||await O(i.value)},V=async v=>{l.value=v,await $()};return Y(async()=>{await I(!0),await Z(()=>{n.value&&n.value.scrollToBottom()})}),(v,t)=>{const _=y("icon-poweroff"),f=y("a-button"),e=y("icon-apps"),b=y("a-avatar"),p=y("router-link"),M=y("icon-empty"),A=y("icon-send");return k(),w("div",{class:"w-full h-full min-h-screen bg-gray-100 bg-cover bg-no-repeat bg-center",style:ie({backgroundImage:`url(${r(be)})`})},[a("div",we,[r(g).length>0?(k(),w("div",ke,[u(r(ve),{ref_key:"scroller",ref:n,items:r(g).slice().reverse(),"min-item-size":1,onScroll:F,class:"h-full scrollbar-w-none"},{default:h(({item:o,active:B})=>[u(r(ce),{item:o,active:B,"data-index":o.id},{default:h(()=>[a("div",Ce,[u(ge,{query:o.query,account:r(C).account},null,8,["query","account"]),u(de,{agent_thoughts:o.agent_thoughts,answer:o.answer,app:{name:"辅助Agent"},suggested_questions:o.id===c.value?r(z):[],loading:o.id===c.value&&r(m),latency:o.latency,total_token_count:o.total_token_count,message_class:"bg-white",onSelectSuggestedQuestion:V},null,8,["agent_thoughts","answer","suggested_questions","loading","latency","total_token_count"])])]),_:2},1032,["item","active","data-index"])]),_:1},8,["items"]),i.value&&r(m)?(k(),w("div",Se,[u(f,{loading:r(N),class:"rounded-lg px-2",onClick:Q},{icon:h(()=>[u(_)]),default:h(()=>[t[2]||(t[2]=L(" 停止响应 "))]),_:1},8,["loading"])])):ee("",!0)])):(k(),w("div",Me,[t[12]||(t[12]=te('<div class="mb-9"><div class="text-[40px] font-bold text-gray-700 mt-[52px] mb-4"> Hi，我是 AI 应用构建器 </div><div class="text-[30px] font-bold text-gray-700 mb-2"> 你的专属 <span class="text-blue-700">AI 原生应用</span> 开发平台 </div><div class="text-base text-gray-700"> 说出你的创意，我可以快速帮你创建专属应用，一键轻松分享给朋友，也可以一键发布到 LLMOps 平台、微信等多个渠道。 </div></div>',1)),a("div",Le,[u(b,{size:30,shape:"circle",class:"flex-shrink-0 bg-blue-700"},{default:h(()=>[u(e)]),_:1}),a("div",qe,[t[11]||(t[11]=a("div",{class:"text-gray-700 font-bold"},"辅助Agent",-1)),a("div",Te,[t[8]||(t[8]=a("div",{class:"font-bold"},"你好，欢迎来到LLMOps🎉",-1)),t[9]||(t[9]=a("div",{class:""}," LLMOps是新一代大模型 AI 应用开发平台。无论你是否有编程基础，都可以快速搭建出各种 AI 应用，并一键发布到各大社交平台，或者轻松部署到自己的网站。 ",-1)),a("ul",ze,[a("li",null,[t[4]||(t[4]=L(" 随时来 ")),u(p,{to:{name:"store-apps-list"},class:"text-blue-700"},{default:h(()=>t[3]||(t[3]=[L("应用广场 ")])),_:1}),t[5]||(t[5]=L(" 逛逛，这里内置了许多超有趣的应用。 "))]),t[6]||(t[6]=a("li",null,"你也可以直接发送“我想做一个应用”，我可以帮你快速创建应用。",-1)),t[7]||(t[7]=a("li",null,"你也可以向我提问有关课程的问题，我可以快速替你解答。",-1))]),t[10]||(t[10]=a("div",{class:""},"如果你还有其他LLMOps使用问题，也欢迎随时问我！",-1))]),a("div",Ie,[(k(),w(se,null,ne(S,(o,B)=>a("div",{key:B,class:"px-4 py-1.5 border rounded-lg text-gray-700 cursor-pointer bg-white hover:bg-gray-50",onClick:async()=>await V(o)},re(o),9,$e)),64))])])])])),a("div",Be,[a("div",He,[u(f,{loading:r(j),class:"flex-shrink-0 !text-gray-700",type:"text",shape:"circle",onClick:t[0]||(t[0]=async()=>{await Q(),await r(U)(),await r(I)(!0)})},{icon:h(()=>[u(M,{size:16})]),_:1},8,["loading"]),a("div",Qe,[ae(a("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>l.value=o),type:"text",class:"flex-1 outline-0",placeholder:"发送消息或创建AI应用...",onKeyup:le($,["enter"])},null,544),[[oe,l.value]]),u(f,{loading:r(m),type:"text",shape:"circle",class:"!text-gray-700",onClick:$},{icon:h(()=>[u(A,{size:16})]),_:1},8,["loading"])])]),t[13]||(t[13]=a("div",{class:"text-center text-gray-500 text-xs py-4"}," 内容由AI生成，无法确保真实准确，仅供参考。 ",-1))])])],4)}}});export{Pe as default};
