import{m as G}from"./moment-Bi1m-TfR.js";import{u as O,a as P,b as W,c as E,d as J,e as K}from"./use-app-DmxLkqO2.js";import{d as T,b as S,e as H,r as a,o as u,c as v,w as t,g as i,t as b,h as e,a as x,u as n,l as Q,m as X,j as Y,f as Z,n as ee,i as $,F as te}from"./index-Cxr0IMAv.js";const ae={class:"flex items-center justify-between"},oe={class:"text-lg font-bold text-gray-700"},se={class:"pt-6"},le={class:"flex items-center justify-between"},ne=T({__name:"CreateOrUpdateAppModal",props:{app_id:{type:String,default:"",required:!1},visible:{type:Boolean,required:!0},callback:{type:Function,required:!1}},emits:["update:visible","update:app_id"],setup(U,{emit:V}){const d=U,_=V,{loading:k,handleCreateApp:z}=O(),{loading:F,handleUpdateApp:L}=P(),{app:g,loadApp:h}=W(),m={fileList:[],icon:"",name:"",description:""},c=S({...m}),C=S(),r=()=>_("update:visible",!1),o=async({errors:p})=>{p||(d.app_id?await L(d.app_id,c.value):await z(c.value),_("update:visible",!1),d.callback&&d.callback())};return H(()=>d.visible,async p=>{var l,y;(l=C.value)==null||l.resetFields(),p?d.app_id&&(await h(d.app_id),c.value={fileList:[{uid:"1",name:"应用图标",url:g.value.icon}],icon:g.value.icon,name:g.value.name,description:g.value.description}):(c.value=m,(y=C.value)==null||y.resetFields(),_("update:app_id",""))}),(p,l)=>{const y=a("icon-close"),q=a("a-button"),M=a("a-upload"),f=a("a-form-item"),j=a("a-input"),B=a("a-textarea"),D=a("a-space"),w=a("a-form"),R=a("a-modal");return u(),v(R,{width:520,visible:d.visible,"hide-title":"",footer:!1,"modal-class":"rounded-xl",onCancel:r},{default:t(()=>[i("div",ae,[i("div",oe,b(d.app_id===""?"创建 AI 应用":"编辑 AI 应用"),1),e(q,{type:"text",class:"!text-gray-700",size:"small",onClick:r},{icon:t(()=>[e(y)]),_:1})]),i("div",se,[e(w,{ref_key:"formRef",ref:C,model:c.value,layout:"vertical",onSubmit:o},{default:t(()=>[e(f,{field:"fileList","hide-label":"",rules:[{required:!0,message:"应用图标不能为空"}]},{default:t(()=>[e(M)]),_:1}),e(f,{field:"name",label:"应用名称","asterisk-position":"end",rules:[{required:!0,message:"应用名称不能为空"}]},{default:t(()=>[e(j,{"model-value":c.value.name,"onUpdate:modelValue":l[0]||(l[0]=A=>c.value.name=A),placeholder:"请输入应用名称"},null,8,["model-value"])]),_:1}),e(f,{field:"content",label:"应用描述"},{default:t(()=>[e(B,{"model-value":c.value.description,"onUpdate:modelValue":l[1]||(l[1]=A=>c.value.description=A),"auto-size":{minRows:8,maxRows:8},"max-length":800,"show-word-limit":"",placeholder:"请输入关于该应用的描述信息"},null,8,["model-value"])]),_:1}),i("div",le,[l[4]||(l[4]=i("div",{class:""},null,-1)),e(D,{size:16},{default:t(()=>[e(q,{class:"rounded-lg",onClick:r},{default:t(()=>l[2]||(l[2]=[x("取消")])),_:1}),e(q,{loading:n(k)||n(F),type:"primary","html-type":"submit",class:"rounded-lg"},{default:t(()=>l[3]||(l[3]=[x(" 保存 ")])),_:1},8,["loading"])]),_:1})])]),_:1},8,["model"])])]),_:1},8,["visible"])}}}),ie={class:"flex items-center gap-3 mb-3"},de={class:"flex flex-1 justify-between"},ce={class:"flex flex-col"},re={class:"text-xs text-gray-500 line-clamp-1"},pe={class:"leading-[18px] text-gray-500 h-[72px] line-clamp-4 mb-2 break-all"},ue={class:"flex items-center gap-1.5"},_e={class:"text-xs text-gray-400"},ge=T({__name:"ListView",props:{createType:{type:String,default:"",required:!0}},setup(U){const V=Y(),d=U,_=S(!1),k=S(""),z=Q(),{handleCopyApp:F}=E(),{loading:L,apps:g,paginator:h,loadApps:m}=J(),{handleDeleteApp:c}=K(),C=async r=>{const{scrollTop:o,scrollHeight:p,clientHeight:l}=r.target;if(o+l>=p-10){if(L.value)return;await m()}};return X(async()=>{await m(!0)}),H(()=>d.createType,r=>{r==="app"&&(k.value="",_.value=!0)}),H(()=>{var r;return(r=V.query)==null?void 0:r.search_word},async()=>await m(!0)),(r,o)=>{const p=a("a-avatar"),l=a("icon-check-circle-fill"),y=a("router-link"),q=a("icon-more"),M=a("a-button"),f=a("a-doption"),j=a("a-dropdown"),B=a("icon-user"),D=a("a-card"),w=a("a-col"),R=a("a-empty"),A=a("a-row"),N=a("a-spin"),I=a("a-space");return u(),v(N,{loading:n(L),class:"block h-full w-full scrollbar-w-none overflow-scroll",onScroll:C},{default:t(()=>[e(A,{gutter:[20,20],class:"flex-1"},{default:t(()=>[(u(!0),Z(te,null,ee(n(g),s=>(u(),v(w,{key:s.id,span:6},{default:t(()=>[e(D,{hoverable:"",class:"cursor-pointer rounded-lg"},{default:t(()=>[i("div",ie,[e(p,{size:40,shape:"square","image-url":s.icon},null,8,["image-url"]),i("div",de,[i("div",ce,[e(y,{to:{name:"space-apps-detail",params:{app_id:s.id}},class:"text-base text-gray-900 font-bold"},{default:t(()=>[x(b(s.name)+" ",1),s.status==="published"?(u(),v(l,{key:0,class:"text-green-700"})):$("",!0)]),_:2},1032,["to"]),i("div",re,b(s.model_config.provider)+" · "+b(s.model_config.model),1)]),e(j,{position:"br"},{content:t(()=>[e(y,{to:{name:"space-apps-analysis",params:{app_id:s.id}}},{default:t(()=>[e(f,null,{default:t(()=>o[2]||(o[2]=[x("分析")])),_:1})]),_:2},1032,["to"]),e(f,{onClick:()=>{k.value=s.id,_.value=!0}},{default:t(()=>o[3]||(o[3]=[x(" 编辑应用 ")])),_:2},1032,["onClick"]),e(f,{onClick:async()=>await n(F)(s.id)},{default:t(()=>o[4]||(o[4]=[x("创建副本")])),_:2},1032,["onClick"]),e(f,{class:"text-red-700",onClick:async()=>await n(c)(s.id,async()=>await n(m)(!0))},{default:t(()=>o[5]||(o[5]=[x(" 删除 ")])),_:2},1032,["onClick"])]),default:t(()=>[e(M,{type:"text",size:"small",class:"rounded-lg !text-gray-700"},{icon:t(()=>[e(q)]),_:1})]),_:2},1024)])]),i("div",pe,b(s.description.trim()===""?s.preset_prompt:s.description),1),i("div",ue,[e(p,{size:18,class:"bg-blue-700"},{default:t(()=>[e(B)]),_:1}),i("div",_e,b(n(z).account.name)+" · 最近编辑 "+b(n(G)(s.created_at*1e3).format("MM-DD HH:mm")),1)])]),_:2},1024)]),_:2},1024))),128)),n(g).length===0?(u(),v(w,{key:0,span:24},{default:t(()=>[e(R,{description:"没有可用的Agent智能体",class:"h-[400px] flex flex-col items-center justify-center"})]),_:1})):$("",!0)]),_:1}),n(h).total_page>=2?(u(),v(A,{key:0},{default:t(()=>[n(h).current_page<=n(h).total_page?(u(),v(w,{key:0,span:24,align:"center"},{default:t(()=>[e(I,{class:"my-4"},{default:t(()=>[e(N),o[6]||(o[6]=i("div",{class:"text-gray-400"},"加载中",-1))]),_:1})]),_:1})):(u(),v(w,{key:1,span:24,align:"center"},{default:t(()=>o[7]||(o[7]=[i("div",{class:"text-gray-400 my-4"},"数据已加载完成",-1)])),_:1}))]),_:1})):$("",!0),e(ne,{visible:_.value,"onUpdate:visible":o[0]||(o[0]=s=>_.value=s),app_id:k.value,"onUpdate:app_id":o[1]||(o[1]=s=>k.value=s),callback:async()=>await n(m)(!0)},null,8,["visible","app_id","callback"])]),_:1},8,["loading"])}}});export{ge as default};
