import{m as P}from"./moment-BalcYcX8.js";import{u as W,a as E,b as J,c as K,d as Q,e as X}from"./use-app-Z236WO0r.js";import{d as I,b as S,e as H,r as o,o as u,c as m,w as a,g as n,t as v,h as t,a as g,u as l,l as Y,m as Z,j as ee,f as te,n as ae,i as $,F as oe}from"./index-B4vV2Uxs.js";const se={class:"flex items-center justify-between"},le={class:"text-lg font-bold text-gray-700"},ne={class:"pt-6"},ie={class:"flex items-center justify-between"},ce=I({__name:"CreateOrUpdateAppModal",props:{app_id:{type:String,default:"",required:!1},visible:{type:Boolean,required:!0},callback:{type:Function,required:!1}},emits:["update:visible","update:app_id"],setup(U,{emit:V}){const d=U,w=V,{loading:z,handleCreateApp:y}=W(),{loading:b,handleUpdateApp:F}=E(),{app:x,loadApp:q}=J(),A={fileList:[],icon:"",name:"",description:""},i=S({...A}),r=S(),h=()=>w("update:visible",!1),M=async({errors:c})=>{c||(d.app_id?await F(d.app_id,i.value):await y(i.value),w("update:visible",!1),d.callback&&d.callback())};return H(()=>d.visible,async c=>{var e,p;(e=r.value)==null||e.resetFields(),c?d.app_id&&(await q(d.app_id),i.value={fileList:[{uid:"1",name:"应用图标",url:x.value.icon}],icon:x.value.icon,name:x.value.name,description:x.value.description}):(i.value=A,(p=r.value)==null||p.resetFields(),w("update:app_id",""))}),(c,e)=>{const p=o("icon-close"),f=o("a-button"),L=o("a-upload"),C=o("a-form-item"),j=o("a-input"),k=o("a-textarea"),B=o("a-space"),D=o("a-form"),R=o("a-modal");return u(),m(R,{width:520,visible:d.visible,"hide-title":"",footer:!1,"modal-class":"rounded-xl",onCancel:h},{default:a(()=>[n("div",se,[n("div",le,v(d.app_id===""?"创建 AI 应用":"编辑 AI 应用"),1),t(f,{type:"text",class:"!text-gray-700",size:"small",onClick:h},{icon:a(()=>[t(p)]),_:1})]),n("div",ne,[t(D,{ref_key:"formRef",ref:r,model:i.value,layout:"vertical",onSubmit:M},{default:a(()=>[t(C,{field:"fileList","hide-label":"",rules:[{required:!0,message:"应用图标不能为空"}]},{default:a(()=>[t(L)]),_:1}),t(C,{field:"name",label:"应用名称","asterisk-position":"end",rules:[{required:!0,message:"应用名称不能为空"}]},{default:a(()=>[t(j,{"model-value":i.value.name,"onUpdate:modelValue":e[0]||(e[0]=_=>i.value.name=_),placeholder:"请输入应用名称"},null,8,["model-value"])]),_:1}),t(C,{field:"content",label:"应用描述"},{default:a(()=>[t(k,{"model-value":i.value.description,"onUpdate:modelValue":e[1]||(e[1]=_=>i.value.description=_),"auto-size":{minRows:8,maxRows:8},"max-length":800,"show-word-limit":"",placeholder:"请输入关于该应用的描述信息"},null,8,["model-value"])]),_:1}),n("div",ie,[e[4]||(e[4]=n("div",{class:""},null,-1)),t(B,{size:16},{default:a(()=>[t(f,{class:"rounded-lg",onClick:h},{default:a(()=>e[2]||(e[2]=[g("取消")])),_:1}),t(f,{loading:l(z)||l(b),type:"primary","html-type":"submit",class:"rounded-lg"},{default:a(()=>e[3]||(e[3]=[g(" 保存 ")])),_:1},8,["loading"])]),_:1})])]),_:1},8,["model"])])]),_:1},8,["visible"])}}}),de={class:"flex items-center gap-3 mb-3"},re={class:"flex flex-1 justify-between"},pe={class:"flex flex-col"},ue={class:"text-xs text-gray-500 line-clamp-1"},_e={class:"leading-[18px] text-gray-500 h-[72px] line-clamp-4 mb-2 break-all"},me={class:"flex items-center gap-1.5"},fe={class:"text-xs text-gray-400"},be=I({__name:"ListView",props:{createType:{type:String,default:"",required:!0}},emits:["update-create-type"],setup(U,{emit:V}){const d=ee(),w=U,z=V,y=S(!1),b=S(""),F=Y(),{handleCopyApp:x}=K(),{loading:q,apps:A,paginator:i,loadApps:r}=Q(),{handleDeleteApp:h}=X(),M=async c=>{const{scrollTop:e,scrollHeight:p,clientHeight:f}=c.target;if(e+f>=p-10){if(q.value)return;await r()}};return Z(async()=>{await r(!0)}),H(()=>w.createType,c=>{c==="app"&&(b.value="",y.value=!0,z("update-create-type",""))}),H(()=>{var c;return(c=d.query)==null?void 0:c.search_word},async()=>await r(!0)),(c,e)=>{const p=o("a-avatar"),f=o("icon-check-circle-fill"),L=o("router-link"),C=o("icon-more"),j=o("a-button"),k=o("a-doption"),B=o("a-dropdown"),D=o("icon-user"),R=o("a-card"),_=o("a-col"),G=o("a-empty"),N=o("a-row"),T=o("a-spin"),O=o("a-space");return u(),m(T,{loading:l(q),class:"block h-full w-full scrollbar-w-none overflow-scroll",onScroll:M},{default:a(()=>[t(N,{gutter:[20,20],class:"flex-1"},{default:a(()=>[(u(!0),te(oe,null,ae(l(A),s=>(u(),m(_,{key:s.id,span:6},{default:a(()=>[t(R,{hoverable:"",class:"cursor-pointer rounded-lg"},{default:a(()=>[n("div",de,[t(p,{size:40,shape:"square","image-url":s.icon},null,8,["image-url"]),n("div",re,[n("div",pe,[t(L,{to:{name:"space-apps-detail",params:{app_id:s.id}},class:"text-base text-gray-900 font-bold"},{default:a(()=>[g(v(s.name)+" ",1),s.status==="published"?(u(),m(f,{key:0,class:"text-green-700"})):$("",!0)]),_:2},1032,["to"]),n("div",ue,v(s.model_config.provider)+" · "+v(s.model_config.model),1)]),t(B,{position:"br"},{content:a(()=>[t(L,{to:{name:"space-apps-analysis",params:{app_id:s.id}}},{default:a(()=>[t(k,null,{default:a(()=>e[2]||(e[2]=[g("分析")])),_:1})]),_:2},1032,["to"]),t(k,{onClick:()=>{b.value=s.id,y.value=!0}},{default:a(()=>e[3]||(e[3]=[g(" 编辑应用 ")])),_:2},1032,["onClick"]),t(k,{onClick:async()=>await l(x)(s.id)},{default:a(()=>e[4]||(e[4]=[g("创建副本")])),_:2},1032,["onClick"]),t(k,{class:"text-red-700",onClick:async()=>await l(h)(s.id,async()=>await l(r)(!0))},{default:a(()=>e[5]||(e[5]=[g(" 删除 ")])),_:2},1032,["onClick"])]),default:a(()=>[t(j,{type:"text",size:"small",class:"rounded-lg !text-gray-700"},{icon:a(()=>[t(C)]),_:1})]),_:2},1024)])]),n("div",_e,v(s.description.trim()===""?s.preset_prompt:s.description),1),n("div",me,[t(p,{size:18,class:"bg-blue-700"},{default:a(()=>[t(D)]),_:1}),n("div",fe,v(l(F).account.name)+" · 最近编辑 "+v(l(P)(s.created_at*1e3).format("MM-DD HH:mm")),1)])]),_:2},1024)]),_:2},1024))),128)),l(A).length===0?(u(),m(_,{key:0,span:24},{default:a(()=>[t(G,{description:"没有可用的Agent智能体",class:"h-[400px] flex flex-col items-center justify-center"})]),_:1})):$("",!0)]),_:1}),l(i).total_page>=2?(u(),m(N,{key:0},{default:a(()=>[l(i).current_page<=l(i).total_page?(u(),m(_,{key:0,span:24,align:"center"},{default:a(()=>[t(O,{class:"my-4"},{default:a(()=>[t(T),e[6]||(e[6]=n("div",{class:"text-gray-400"},"加载中",-1))]),_:1})]),_:1})):(u(),m(_,{key:1,span:24,align:"center"},{default:a(()=>e[7]||(e[7]=[n("div",{class:"text-gray-400 my-4"},"数据已加载完成",-1)])),_:1}))]),_:1})):$("",!0),t(ce,{visible:y.value,"onUpdate:visible":e[0]||(e[0]=s=>y.value=s),app_id:b.value,"onUpdate:app_id":e[1]||(e[1]=s=>b.value=s),callback:async()=>await l(r)(!0)},null,8,["visible","app_id","callback"])]),_:1},8,["loading"])}}});export{be as default};
