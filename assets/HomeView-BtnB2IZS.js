import{s as J,p as Q,g as R,r as d,M as H,d as X,u as Y,o as Z,n as ee,c as w,a as r,w as _,b as a,e as u,f as te,h as se,i as k,F as ne,j as ae,k as oe,v as le,l as ie,m as re,Q as q,q as h,t as C,x as ue}from"./index-C09ZU7FL.js";import{u as ce,s as ge,_ as de,a as ve,b as pe}from"./AiMessage.vue_vue_type_script_setup_true_lang-Dvcr-_xT.js";const fe=(s,l)=>J("/assistant-agent/chat",{body:{query:s}},l),_e=s=>Q(`/assistant-agent/chat/${s}/stop`),he=s=>R("/assistant-agent/messages",{params:s}),ye=()=>Q("/assistant-agent/delete-conversation"),xe=()=>{const s=d(!1);return{loading:s,handleAssistantAgentChat:async(i,c)=>{try{s.value=!0,await fe(i,c)}finally{s.value=!1}}}},Ae=()=>{const s=d(!1);return{loading:s,handleStopAssistantAgentChat:async i=>{try{s.value=!0,await _e(i)}finally{s.value=!1}}}},me=()=>{const s=d(!1),l=d([]),i=d(0),c={current_page:1,page_size:5,total_page:0,total_record:0},n=d({...c});return{loading:s,messages:l,paginator:n,loadAssistantAgentMessages:async(S=!1)=>{var M;if(S)n.value={...c},i.value=0;else if(n.value.current_page>n.value.total_page)return;try{s.value=!0;const y=(await he({current_page:n.value.current_page,page_size:n.value.page_size,created_at:i.value})).data;n.value=y.paginator,n.value.current_page<=n.value.total_page&&(n.value.current_page+=1),S?l.value=y.list:(l.value.push(...y.list),i.value=((M=y.list[0])==null?void 0:M.created_at)??0)}finally{s.value=!1}}}},be=()=>{const s=d(!1);return{loading:s,handleDeleteAssistantAgentConversation:async()=>{try{s.value=!0;const i=await ye();H.success(i.message)}finally{s.value=!1}}}},we="/llmops-vue/assets/assistant-agent-background-Jf_uHUnU.png",ke={class:"w-[600px] h-full min-h-screen mx-auto"},Ce={key:0,class:"flex flex-col px-6 h-[calc(100%-100px)] min-h-[calc(100vh-100px)]"},Se={class:"flex flex-col gap-6 py-6"},Me={key:0,class:"h-[50px] flex items-center justify-center"},Le={key:1,class:"flex flex-col p-6 gap-2 items-center justify-center overflow-scroll scrollbar-w-none h-[calc(100%-100px)] min-h-[calc(100vh-100px)]"},qe={class:"flex gap-2"},Te={class:"flex flex-col items-start gap-2"},ze={class:"bg-white border border-gray-200 text-gray-700 px-4 py-3 rounded-2xl break-all leading-7"},Ie={class:"list-disc pl-6"},$e={class:"flex flex-col gap-2"},Be=["onClick"],He={class:"w-full flex flex-col flex-shrink-0"},Qe={class:"px-6 flex items-center gap-4"},Ve={class:"bg-white h-[50px] flex items-center gap-2 px-4 flex-1 border border-gray-200 rounded-full"},Ne=X({__name:"HomeView",setup(s){const l=d(""),i=d(""),c=d(""),n=d(null),T=d(0),S=Y(),M=["什么是LLMOps?","我想创建一个应用","能介绍下什么是RAG吗?"],{suggested_questions:z,handleGenerateSuggestedQuestions:y}=ce(),{loading:m,handleAssistantAgentChat:P}=xe(),{loading:N,handleStopAssistantAgentChat:O}=Ae(),{loading:G,messages:g,loadAssistantAgentMessages:I}=me(),{loading:j,handleDeleteAssistantAgentConversation:U}=be(),W=()=>{T.value=n.value.$el.scrollHeight},E=()=>{n.value.$el.scrollTop=n.value.$el.scrollHeight-T.value},F=async v=>{const{scrollTop:t}=v.target;t<=0&&!G.value&&(W(),await I(!1),E())},$=async()=>{if(l.value.trim()===""){H.warning("用户提问不能为空");return}if(m.value){H.warning("上一次提问还未结束，请稍等");return}z.value=[],c.value="",i.value="",g.value.unshift({id:"",conversation_id:"",query:l.value,answer:"",total_token_count:0,latency:0,agent_thoughts:[],created_at:0});let v=0;const t=l.value;l.value="",await P(t,p=>{var L;const x=p==null?void 0:p.event,e=p==null?void 0:p.data,b=e==null?void 0:e.id,f=g.value[0].agent_thoughts;if(c.value===""&&(e!=null&&e.message_id)&&(i.value=e==null?void 0:e.task_id,c.value=e==null?void 0:e.message_id,g.value[0].id=e==null?void 0:e.message_id,g.value[0].conversation_id=e==null?void 0:e.conversation_id),x!==q.ping){if(x===q.agentMessage){const A=f.findIndex(o=>(o==null?void 0:o.id)===b);A===-1?(v+=1,f.push({id:b,position:v,event:e==null?void 0:e.event,thought:e==null?void 0:e.thought,observation:e==null?void 0:e.observation,tool:e==null?void 0:e.tool,tool_input:e==null?void 0:e.tool_input,latency:e==null?void 0:e.latency,created_at:0})):f[A]={...f[A],thought:((L=f[A])==null?void 0:L.thought)+(e==null?void 0:e.thought),latency:e==null?void 0:e.latency},g.value[0].answer+=e==null?void 0:e.thought,g.value[0].latency=e==null?void 0:e.latency,g.value[0].total_token_count=e==null?void 0:e.total_token_count}else x===q.error?g.value[0].answer=e==null?void 0:e.observation:x===q.timeout?g.value[0].answer="当前Agent执行已超时，无法得到答案，请重试":(v+=1,f.push({id:b,position:v,event:e==null?void 0:e.event,thought:e==null?void 0:e.thought,observation:e==null?void 0:e.observation,tool:e==null?void 0:e.tool,tool_input:e==null?void 0:e.tool_input,latency:e==null?void 0:e.latency,created_at:0}));g.value[0].agent_thoughts=f,n.value.scrollToBottom()}}),c.value&&(await y(c.value),setTimeout(()=>n.value&&n.value.scrollToBottom(),100))},V=async()=>{i.value===""||!m.value||await O(i.value)},D=async v=>{l.value=v,await $()};Z(async()=>{await I(!0),await ee(()=>{n.value&&n.value.scrollToBottom()})});async function K(){const v=await Q("/apps/7a3e1f8d-4b6c-4a2d-9f1e-3c8a5b7d2e1f/debug",{body:{query:"你好， 你是谁"}});console.log(v)}return(v,t)=>{const p=h("a-button"),x=h("icon-poweroff"),e=h("icon-apps"),b=h("a-avatar"),f=h("router-link"),L=h("icon-empty"),A=h("icon-send");return C(),w("div",{class:"w-full h-full min-h-screen bg-gray-100 bg-cover bg-no-repeat bg-center",style:re({backgroundImage:`url(${u(we)})`})},[r(p,{onClick:K},{default:_(()=>t[2]||(t[2]=[k("发起请求")])),_:1}),a("div",ke,[u(g).length>0?(C(),w("div",Ce,[r(u(pe),{ref_key:"scroller",ref:n,items:u(g).slice().reverse(),"min-item-size":1,onScroll:F,class:"h-full scrollbar-w-none"},{default:_(({item:o,active:B})=>[r(u(ge),{item:o,active:B,"data-index":o.id},{default:_(()=>[a("div",Se,[r(de,{query:o.query,account:u(S).account},null,8,["query","account"]),r(ve,{agent_thoughts:o.agent_thoughts,answer:o.answer,app:{name:"辅助Agent"},suggested_questions:o.id===c.value?u(z):[],loading:o.id===c.value&&u(m),latency:o.latency,total_token_count:o.total_token_count,message_class:"bg-white",onSelectSuggestedQuestion:D},null,8,["agent_thoughts","answer","suggested_questions","loading","latency","total_token_count"])])]),_:2},1032,["item","active","data-index"])]),_:1},8,["items"]),i.value&&u(m)?(C(),w("div",Me,[r(p,{loading:u(N),class:"rounded-lg px-2",onClick:V},{icon:_(()=>[r(x)]),default:_(()=>[t[3]||(t[3]=k(" 停止响应 "))]),_:1},8,["loading"])])):te("",!0)])):(C(),w("div",Le,[t[13]||(t[13]=se('<div class="mb-9"><div class="text-[40px] font-bold text-gray-700 mt-[52px] mb-4"> Hi，我是 AI 应用构建器 </div><div class="text-[30px] font-bold text-gray-700 mb-2"> 你的专属 <span class="text-blue-700">AI 原生应用</span> 开发平台 </div><div class="text-base text-gray-700"> 说出你的创意，我可以快速帮你创建专属应用，一键轻松分享给朋友，也可以一键发布到 LLMOps 平台、微信等多个渠道。 </div></div>',1)),a("div",qe,[r(b,{size:30,shape:"circle",class:"flex-shrink-0 bg-blue-700"},{default:_(()=>[r(e)]),_:1}),a("div",Te,[t[12]||(t[12]=a("div",{class:"text-gray-700 font-bold"},"辅助Agent",-1)),a("div",ze,[t[9]||(t[9]=a("div",{class:"font-bold"},"你好，欢迎来到LLMOps🎉",-1)),t[10]||(t[10]=a("div",{class:""}," LLMOps是新一代大模型 AI 应用开发平台。无论你是否有编程基础，都可以快速搭建出各种 AI 应用，并一键发布到各大社交平台，或者轻松部署到自己的网站。 ",-1)),a("ul",Ie,[a("li",null,[t[5]||(t[5]=k(" 随时来 ")),r(f,{to:{name:"store-apps-list"},class:"text-blue-700"},{default:_(()=>t[4]||(t[4]=[k("应用广场 ")])),_:1}),t[6]||(t[6]=k(" 逛逛，这里内置了许多超有趣的应用。 "))]),t[7]||(t[7]=a("li",null,"你也可以直接发送“我想做一个应用”，我可以帮你快速创建应用。",-1)),t[8]||(t[8]=a("li",null,"你也可以向我提问有关课程的问题，我可以快速替你解答。",-1))]),t[11]||(t[11]=a("div",{class:""},"如果你还有其他LLMOps使用问题，也欢迎随时问我！",-1))]),a("div",$e,[(C(),w(ne,null,ae(M,(o,B)=>a("div",{key:B,class:"px-4 py-1.5 border rounded-lg text-gray-700 cursor-pointer bg-white hover:bg-gray-50",onClick:async()=>await D(o)},ue(o),9,Be)),64))])])])])),a("div",He,[a("div",Qe,[r(p,{loading:u(j),class:"flex-shrink-0 !text-gray-700",type:"text",shape:"circle",onClick:t[0]||(t[0]=async()=>{await V(),await u(U)(),await u(I)(!0)})},{icon:_(()=>[r(L,{size:16})]),_:1},8,["loading"]),a("div",Ve,[oe(a("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>l.value=o),type:"text",class:"flex-1 outline-0",placeholder:"发送消息或创建AI应用...",onKeyup:ie($,["enter"])},null,544),[[le,l.value]]),r(p,{loading:u(m),type:"text",shape:"circle",class:"!text-gray-700",onClick:$},{icon:_(()=>[r(A,{size:16})]),_:1},8,["loading"])])]),t[14]||(t[14]=a("div",{class:"text-center text-gray-500 text-xs py-4"}," 内容由AI生成，无法确保真实准确，仅供参考。 ",-1))])])],4)}}});export{Ne as default};
