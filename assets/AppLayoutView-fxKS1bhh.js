import{h as L}from"./moment-C5S46NFB.js";import{d as T,e as G,o as l,c as D,w as a,h as s,g as n,t as u,u as e,f as x,q as E,F as O,i as N,r as o,a as d,b as R,j as U}from"./index-_WQ45uP5.js";import{u as W,a as I,b as J,c as K,d as Q}from"./use-app-BQYJEbRE.js";const X={class:""},Z={class:"flex items-center gap-3 mb-3"},tt={class:"flex flex-col"},et={class:"text-gray-700 font-bold"},st={class:"text-xs text-gray-500"},at={class:"text-gray-500"},ot={class:"text-gray-500 text-xs mb-[18px]"},nt={class:"flex items-center justify-between"},lt={class:"flex flex-col gap-2"},it={class:"flex items-center gap-2"},dt={class:"text-xs text-gray-500"},rt={key:0,class:"flex items-center justify-center"},ct={key:1,class:"text-gray-400 my-4"},pt=T({__name:"PublishHistoryDrawer",props:{visible:{type:Boolean,required:!0},app:{type:Object,required:!0}},emits:["update:visible","loadDraftAppConfig"],setup(v,{emit:m}){const p=v,_=m,{loading:r,paginator:b,publishHistories:w,loadPublishHistories:H}=W(),{handleFallbackHistoryToDraft:V}=I(),z=async k=>{var c;const{scrollTop:t,scrollHeight:C,clientHeight:f}=k.target;if(t+f>=C-10){if(r.value)return;await H((c=p.app)==null?void 0:c.id)}};return G(()=>p.visible,async k=>{var t;k?await H((t=p.app)==null?void 0:t.id,!0):w.splice(0,w.length)}),(k,t)=>{const C=o("a-avatar"),f=o("a-divider"),c=o("a-tag"),q=o("a-button"),y=o("a-card"),P=o("a-spin"),S=o("a-space"),B=o("a-drawer");return l(),D(B,{visible:p.visible,title:"发布历史",width:394,footer:!1,"drawer-style":{backgroundColor:"#f9fafb"},onCancel:t[0]||(t[0]=()=>_("update:visible",!1))},{default:a(()=>[s(P,{loading:e(r),class:"block h-full w-full scrollbar-w-none overflow-scroll",onScroll:z},{default:a(()=>{var $,Y,j;return[n("div",X,[n("div",Z,[s(C,{size:40,shape:"square",class:"rounded-lg","image-url":($=v.app)==null?void 0:$.icon},null,8,["image-url"]),n("div",tt,[n("div",et,u(v.app.name),1),n("div",st," 最近编辑 · "+u(e(L)(((Y=v.app)==null?void 0:Y.draft_updated_at)*1e3).format("YYYY-MM-DD HH:mm:ss")),1)])]),n("div",at,u((j=v.app)==null?void 0:j.description),1)]),s(f),n("div",ot," 共计 "+u(e(b).total_record)+" 条发布记录 ",1),(l(!0),x(O,null,E(e(w),(h,F)=>(l(),D(y,{key:h.id,hoverable:"",class:"rounded-lg mb-4 cursor-pointer group"},{default:a(()=>[n("div",nt,[n("div",lt,[n("div",it,[t[2]||(t[2]=n("div",{class:"font-bold text-gray-900"},"版本",-1)),s(c,{size:"small",class:"text-gray-700 rounded-lg !border !border-gray-100"},{default:a(()=>[d(" # "+u(String(h.version).padStart(3,"0")),1)]),_:2},1024),F===0?(l(),D(c,{key:0,size:"small",class:"text-gray-700 rounded-lg !border !border-gray-100"},{default:a(()=>t[1]||(t[1]=[d(" 当前版本 ")])),_:1})):N("",!0)]),n("div",dt," 发布时间："+u(e(L)(h.created_at*1e3).format("YYYY-MM-DD HH:mm:ss")),1)]),s(q,{size:"small",class:"rounded-lg hidden group-hover:block",onClick:async()=>{var A;await e(V)((A=p.app)==null?void 0:A.id,h.id,async()=>{_("update:visible",!1),_("loadDraftAppConfig")})}},{default:a(()=>t[3]||(t[3]=[d("回退")])),_:2},1032,["onClick"])])]),_:2},1024))),128)),e(b).total_page>=2?(l(),x("div",rt,[e(b).current_page<=e(b).total_page?(l(),D(S,{key:0,class:"my-4"},{default:a(()=>[s(P),t[4]||(t[4]=n("div",{class:"text-gray-400"},"加载中",-1))]),_:1})):(l(),x("div",ct,"数据已加载完成"))])):N("",!0)]}),_:1},8,["loading"])]),_:1},8,["visible"])}}}),_t={class:"min-h-screen flex flex-col h-full overflow-hidden"},ut={class:"h-[77px] bg-gray-50 p-4 flex items-center justify-between relative border-b"},mt={class:"flex items-center gap-2"},ft={class:"flex items-center gap-3"},gt={class:"flex flex-col justify-between h-[40px]"},bt={key:1,class:"text-gray-700 font-bold"},xt={key:2,class:"flex items-center gap-2"},vt={key:3,class:"flex items-center gap-2"},yt={class:"flex items-center h-[18px] text-xs text-gray-500"},ht={class:"flex items-center h-[18px] text-xs text-gray-500"},wt={class:"absolute left-1/2 -translate-x-1/2"},kt={class:""},Ht=T({__name:"AppLayoutView",setup(v){var z;const m=U(),p=R(!1),{loading:_,app:r,loadApp:b}=J((z=m.params)==null?void 0:z.app_id),{loading:w,handlePublish:H}=K(),{handleCancelPublish:V}=Q();return(k,t)=>{const C=o("icon-left"),f=o("a-button"),c=o("router-link"),q=o("a-avatar"),y=o("a-skeleton-line"),P=o("icon-user"),S=o("icon-schedule"),B=o("a-tag"),$=o("a-space"),Y=o("icon-down"),j=o("a-doption"),h=o("a-dropdown"),F=o("a-button-group"),A=o("router-view");return l(),x("div",_t,[n("div",ut,[n("div",mt,[s(c,{to:{name:"space-apps-list"}},{default:a(()=>[s(f,{size:"mini"},{icon:a(()=>[s(C)]),_:1})]),_:1}),n("div",ft,[s(q,{size:40,shape:"square",class:"rounded-lg","image-url":e(r).icon},null,8,["image-url"]),n("div",gt,[e(_)?(l(),D(y,{key:0,widths:[100]})):(l(),x("div",bt,u(e(r).name),1)),e(_)?(l(),x("div",xt,[s(y,{widths:[60],"line-height":18}),s(y,{widths:[60],"line-height":18}),s(y,{widths:[60],"line-height":18})])):(l(),x("div",vt,[n("div",yt,[s(P),t[4]||(t[4]=d(" 个人空间 "))]),n("div",ht,[s(S),d(" "+u(e(r).status==="draft"?"草稿":"已发布"),1)]),s(B,{size:"small",class:"rounded h-[18px] leading-[18px] bg-gray-200 text-gray-500"},{default:a(()=>[d(" 已自动保存 "+u(e(L)(e(r).draft_updated_at*1e3).format("HH:mm:ss")),1)]),_:1})]))])])]),n("div",wt,[s($,{size:12},{default:a(()=>{var i,g,M;return[s(c,{to:{name:"space-apps-detail",params:{app_id:String((i=e(m).params)==null?void 0:i.app_id)}},class:"text-base font-bold text-gray-500","active-class":"!text-blue-700"},{default:a(()=>t[5]||(t[5]=[d(" 编排 ")])),_:1},8,["to"]),s(c,{to:{name:"space-apps-published",params:{app_id:String((g=e(m).params)==null?void 0:g.app_id)}},class:"text-base font-bold text-gray-500","active-class":"!text-blue-700"},{default:a(()=>t[6]||(t[6]=[d(" 发布配置 ")])),_:1},8,["to"]),s(c,{to:{name:"space-apps-analysis",params:{app_id:String((M=e(m).params)==null?void 0:M.app_id)}},class:"text-base font-bold text-gray-500","active-class":"!text-blue-700"},{default:a(()=>t[7]||(t[7]=[d(" 统计分析 ")])),_:1},8,["to"])]}),_:1})]),n("div",kt,[s($,{size:12},{default:a(()=>[s(f,{disabled:e(_),class:"rounded-lg",onClick:t[0]||(t[0]=i=>p.value=!0)},{icon:a(()=>[s(S)]),_:1},8,["disabled"]),s(F,null,{default:a(()=>[s(f,{disabled:e(_),loading:e(w),type:"primary",class:"!rounded-tl-lg !rounded-bl-lg",onClick:t[1]||(t[1]=async()=>{var g;const i=(g=e(m).params)==null?void 0:g.add_id;await e(H)(i),await e(b)(i)})},{default:a(()=>t[8]||(t[8]=[d(" 更新发布 ")])),_:1},8,["disabled","loading"]),s(h,{position:"br"},{content:a(()=>[s(j,{disabled:e(r).status==="draft",class:"!text-red-700",onClick:t[2]||(t[2]=async()=>{var g;const i=(g=e(m).params)==null?void 0:g.app_id;await e(V)(i,async()=>await e(b)(i))})},{default:a(()=>t[9]||(t[9]=[d(" 取消发布 ")])),_:1},8,["disabled"])]),default:a(()=>[s(f,{disabled:e(_),type:"primary",class:"!rounded-tr-lg !rounded-br-lg !w-5"},{icon:a(()=>[s(Y)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})])]),s(A,{app:e(r)},null,8,["app"]),s(pt,{app:e(r),visible:p.value,"onUpdate:visible":t[3]||(t[3]=i=>p.value=i),onLoadDraftAppConfig:()=>{}},null,8,["app","visible"])])}}});export{Ht as default};
