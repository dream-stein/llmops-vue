import{d as te,r as D,E,y as ae,z as U,w as t,q as a,t as u,a as l,e,i as p,M as se,c as v,x,b as o,F as oe,j as ne,f as ie,A as de,B as re}from"./index-D503A2vZ.js";import{h as le}from"./moment-C5S46NFB.js";import{c as ce,d as ue,e as _e,f as me}from"./use-dataset-CkJoIsbZ.js";import{u as pe,a as ge,h as fe,b as ye}from"./dataset-MFFtwZh4.js";const be={class:"flex items-center justify-between"},ve={class:"pt-6"},xe={class:"flex items-center justify-between"},he=te({__name:"UpdateDocumentNameModal",props:{visible:{type:Boolean,required:!0},dataset_id:{type:String,required:!0},document_id:{type:String,required:!0},onAfterUpdate:{type:Function,required:!1,default:()=>{}}},emits:["update:visible"],setup(T,{emit:m}){const g=T,V=m,w=D(!1),f=E({name:""}),y=D(),k=()=>{var d;V("update:visible",!1),(d=y.value)==null||d.resetFields()},$=async({errors:d})=>{if(!d)try{w.value=!0;const c=await pe(g.dataset_id,g.document_id,f.name);se.success(c.message),k(),g.onAfterUpdate()}finally{w.value=!1}};return ae(()=>g.visible,async d=>{var c;if(d){const h=(await ge(g.dataset_id,g.document_id)).data;(c=y.value)==null||c.resetFields(),f.name=h.name}}),(d,c)=>{const S=a("icon-close"),h=a("a-button"),b=a("a-input"),_=a("a-form-item"),j=a("a-space"),P=a("a-form"),r=a("a-modal");return u(),U(r,{width:520,visible:T.visible,"hide-title":"",footer:!1,"modal-class":"rounded-xl",onCancel:k},{default:t(()=>[l("div",be,[c[1]||(c[1]=l("div",{class:"text-lg font-bold text-gray-700"},"重命名",-1)),e(h,{type:"text",class:"!text-gray-700",size:"small",onClick:k},{icon:t(()=>[e(S)]),_:1})]),l("div",ve,[e(P,{ref_key:"formRef",ref:y,model:f,onSubmit:$,layout:"vertical"},{default:t(()=>[e(_,{field:"name",label:"名称","asterisk-position":"end",rules:[{required:!0,message:"文档名称不能为空"}]},{default:t(()=>[e(b,{modelValue:f.name,"onUpdate:modelValue":c[0]||(c[0]=s=>f.name=s),placeholder:"请输入文档名称","show-word-limit":"","max-length":100},null,8,["modelValue"])]),_:1}),l("div",xe,[c[4]||(c[4]=l("div",{class:""},null,-1)),e(j,{size:16},{default:t(()=>[e(h,{class:"rounded-lg",onClick:k},{default:t(()=>c[2]||(c[2]=[p("取消")])),_:1}),e(h,{loading:w.value,type:"primary","html-type":"submit",class:"rounded-lg"},{default:t(()=>c[3]||(c[3]=[p(" 保存 ")])),_:1},8,["loading"])]),_:1})])]),_:1},8,["model"])])]),_:1},8,["visible"])}}}),we={class:""},ke={class:"flex items-center justify-between"},qe={class:"pt-6"},ze={class:"w-full flex justify-between gap-2"},Ce={class:"flex flex-col w-1/2"},$e={class:"border border-blue-700 bg-blue-100 rounded-lg flex flex-col mb-6"},De={class:"flex items-center justify-between px-4 py-1.5"},Ve={key:0,class:""},Se={key:1,class:""},je={key:2,class:""},Me={class:"bg-white rounded-lg p-2"},Ue={class:"flex items-center justify-between"},Re={class:""},Fe={class:"line-clamp-1"},Te={class:""},Ye={class:"w-1/2"},Be={class:"p-4 bg-gray-50 rounded-lg cursor-pointer"},He={key:0,class:"flex items-center gap-2 mb-1.5"},Ne={class:"text-gray-700 text-xs"},Ae={class:"text-gray-500 line-clamp-4 h-[88px] break-all"},Le={class:"flex items-center gap-2 text-gray-500 text-xs"},Oe={class:"line-clamp-1"},Ee={class:"flex items-center justify-between"},Pe={class:"flex items-center gap-4 w-full pl-3"},Ge={class:"flex items-center gap-4 w-full pl-3"},Ie={class:"flex items-center justify-between"},Qe=te({__name:"HitTestingModal",props:{visible:{type:Boolean,required:!0},dataset_id:{type:String,required:!0}},emits:["update:visible"],setup(T,{emit:m}){const g=T,V=m,w=D(!1),f=E([]),y=async()=>{try{w.value=!0;const s=(await ye(g.dataset_id)).data;f.splice(0,f.length,...s)}finally{w.value=!1}},k=D(!1),$={retrieval_strategy:"semantic",k:5,score:.5},d=E({...$}),c=()=>{Object.assign(d,{..._}),k.value=!1},S=()=>{b.splice(0,b.length),Object.assign(_,{query:_.query,...d}),k.value=!1},h=D(!1),b=E([]),_=E({query:"",...$}),j=()=>V("update:visible",!1),P=async()=>{if(_.query.trim()===""){se.error("检索源文本不能为空");return}try{h.value=!0;const s=(await fe(g.dataset_id,_)).data;b.splice(0,b.length,...s),await y()}finally{b.splice(0,b.length,{id:"1",document:{id:"2",name:"LLMOps项目API文档.md"},dataset_id:"3",position:1,score:.54,content:"推荐技能",keywords:["社交","App","成本","功能","内容分发"],character_count:487,token_count:407,hit_count:1,enabled:!0,disabled_at:0,status:"completed",error:"",updated_at:1726858854,created_at:1726858854},{id:"2",document:{id:"9",name:"天文学基础.md"},dataset_id:"3",position:1,score:.99,content:"由于宇宙暗物质的摩擦而引发的光谱湮灭现象",keywords:["社交","App","成本","功能","内容分发"],character_count:487,token_count:407,hit_count:1,enabled:!0,disabled_at:0,status:"completed",error:"",updated_at:1726858854,created_at:1726858854}),h.value=!1}};return ae(()=>g.visible,async r=>{r?await y():(f.splice(0,f.length),b.splice(0,b.length),Object.assign(_,{query:"",...$}),Object.assign(d,{...$}))}),(r,s)=>{const M=a("icon-close"),q=a("a-button"),W=a("icon-language"),R=a("a-textarea"),Y=a("a-tag"),B=a("a-table-column"),H=a("a-table"),z=a("a-divider"),J=a("icon-pushpin"),G=a("a-progress"),K=a("icon-file"),X=a("a-col"),I=a("a-row"),Z=a("a-empty"),ee=a("a-spin"),N=a("a-modal"),Q=a("a-radio-group"),F=a("a-form-item"),A=a("a-slider"),L=a("a-input-number"),i=a("a-space"),C=a("a-form");return u(),v("div",we,[e(N,{width:1e3,visible:g.visible,"hide-title":"",footer:!1,"modal-class":"rounded-xl h-3/4 overflow-auto scrollbar-w-none",onCancel:j},{default:t(()=>[l("div",ke,[s[8]||(s[8]=l("div",{class:"text-lg font-bold text-gray-700"},"召回测试",-1)),e(q,{type:"text",class:"!text-gray-700",size:"small",onClick:j},{icon:t(()=>[e(M)]),_:1})]),s[12]||(s[12]=l("div",{class:"text-gray-500"},"基于给定的查询文本测试知识库的召回效果",-1)),l("div",qe,[l("div",ze,[l("div",Ce,[l("div",$e,[l("div",De,[s[9]||(s[9]=l("div",{class:"font-bold text-gray-900"},"源文本",-1)),e(q,{size:"small",class:"rounded-lg px-2",onClick:s[0]||(s[0]=n=>k.value=!0)},{icon:t(()=>[e(W)]),default:t(()=>[_.retrieval_strategy==="semantic"?(u(),v("div",Ve," 相似性检索 ")):_.retrieval_strategy==="full_text"?(u(),v("div",Se," 全文检索 ")):(u(),v("div",je,"混合检索"))]),_:1})]),l("div",Me,[e(R,{"model-value":_.query,"onUpdate:modelValue":s[1]||(s[1]=n=>_.query=n),placeholder:"请输入文本，建议使用简短的陈述句","max-length":200,"auto-size":{minRows:6,maxRows:6},class:"!bg-white !border-0 mb-1"},null,8,["model-value"]),l("div",Ue,[e(Y,{size:"small",class:"rounded text-gray-700"},{default:t(()=>[p(x(_.query.length)+"/200 ",1)]),_:1}),e(q,{loading:h.value,type:"primary",size:"small",class:"rounded-lg",onClick:P},{default:t(()=>s[10]||(s[10]=[p("召回测试")])),_:1},8,["loading"])])])]),l("div",Re,[s[11]||(s[11]=l("div",{class:"text-gray-700 font-bold mb-4"},"最近查询",-1)),e(H,{loading:w.value,pagination:!1,size:"small",bordered:{wrapper:!1},data:f,onRowClick:s[2]||(s[2]=n=>_.query=n.query)},{columns:t(()=>[e(B,{title:"数据源","data-index":"source","header-cell-class":"text-gray-500 bg-transparent border-b font-bold","cell-class":"text-gray-500",width:110}),e(B,{title:"文本","data-index":"query","header-cell-class":"text-gray-500 bg-transparent border-b font-bold","cell-class":"text-gray-500"},{cell:t(({record:n})=>[l("div",Fe,x(n.query),1)]),_:1}),e(B,{title:"时间","data-index":"created_at","header-cell-class":"text-gray-500 bg-transparent border-b font-bold","cell-class":"text-gray-500",width:160},{cell:t(({record:n})=>[l("div",Te,x(o(le)(n.created_at).format("YYYY-MM-DD HH:mm")),1)]),_:1})]),_:1},8,["loading","data"])])]),e(z,{direction:"vertical"}),l("div",Ye,[e(ee,{loading:h.value,class:"w-full"},{default:t(()=>[b.length>0?(u(),U(I,{key:0,gutter:[16,16]},{default:t(()=>[(u(!0),v(oe,null,ne(b,n=>(u(),U(X,{key:n.id,span:12},{default:t(()=>[l("div",Be,[_.retrieval_strategy==="semantic"?(u(),v("div",He,[e(J),e(G,{"stroke-width":6,"show-text":!1,percent:n.score},null,8,["percent"]),l("div",Ne,x(n.score.toFixed(2)),1)])):ie("",!0),l("div",Ae,x(n.content),1),e(z,{class:"my-2"}),l("div",Le,[e(K,{class:"flex-shrink-0"}),l("div",Oe,x(n.document.name),1)])])]),_:2},1024))),128))]),_:1})):(u(),U(Z,{key:1}))]),_:1},8,["loading"])])])])]),_:1},8,["visible"]),e(N,{visible:k.value,"hide-title":"",footer:!1,"modal-class":"rounded-xl"},{default:t(()=>[l("div",Ee,[s[13]||(s[13]=l("div",{class:"text-lg font-bold text-gray-700"},"检索设置",-1)),e(q,{type:"text",class:"!text-gray-700",size:"small",onClick:c},{icon:t(()=>[e(M)]),_:1})]),e(C,{model:d,onSubmit:S,class:"pt-6"},{default:t(()=>[e(F,{field:"retrieval_strategy",label:"检索策略","label-align":"left"},{default:t(()=>[e(Q,{"model-value":d.retrieval_strategy,"onUpdate:modelValue":s[3]||(s[3]=n=>d.retrieval_strategy=n),"default-value":"semantic",options:[{label:"混合检索",value:"hybrid"},{label:"文本检索",value:"full_text"},{label:"相似度检索",value:"semantic"}]},null,8,["model-value"])]),_:1}),e(F,{field:"k",label:"最大召回数量"},{default:t(()=>[l("div",Pe,[e(A,{"model-value":d.k,"onUpdate:modelValue":s[4]||(s[4]=n=>d.k=n),step:1,min:1,max:10},null,8,["model-value"]),e(L,{"model-value":d.k,"onUpdate:modelValue":s[5]||(s[5]=n=>d.k=n),class:"w-[80px]","default-value":4},null,8,["model-value"])])]),_:1}),e(F,{field:"k",label:"最小匹配度"},{default:t(()=>[l("div",Ge,[e(A,{"model-value":d.score,"onUpdate:modelValue":s[6]||(s[6]=n=>d.score=n),step:.01,min:0,max:.99},null,8,["model-value"]),e(L,{"model-value":d.score,"onUpdate:modelValue":s[7]||(s[7]=n=>d.score=n),class:"w-[80px]",min:0,max:.99,step:.01,precision:2,"default-value":.5},null,8,["model-value"])])]),_:1}),l("div",Ie,[s[16]||(s[16]=l("div",{class:""},null,-1)),e(i,{size:16},{default:t(()=>[e(q,{class:"rounded-lg",onClick:c},{default:t(()=>s[14]||(s[14]=[p("取消")])),_:1}),e(q,{type:"primary","html-type":"submit",class:"rounded-lg"},{default:t(()=>s[15]||(s[15]=[p(" 保存 ")])),_:1})]),_:1})])]),_:1},8,["model"])]),_:1},8,["visible"])])}}}),We={class:"p-6"},Je={class:"flex items-center w-full gap-2 mb-6"},Ke={class:"flex items-center gap-3"},Xe={class:"flex flex-col justify-between h-[40px]"},Ze={key:1,class:"text-gray-700"},et={key:2,class:"flex items-center gap-2"},tt={key:3,class:"flex items-center gap-2"},at={class:"flex items-center justify-between mb-6"},st={class:""},lt={key:0,class:"w-2 h-2 bg-green-500 rounded-sm border border-green-700"},ot={key:1,class:"w-2 h-2 bg-gray-500 rounded-sm border border-gray-700"},nt={key:2,class:"text-gray-700"},it={key:3,class:"text-gray-700"},_t=te({__name:"ListView",setup(T){var _,j;const m=de(),g=re(),V=D(!1),w=D(!1),f=D(""),{dataset:y,loadDataset:k}=ce((_=m.params)==null?void 0:_.dataset_id),{loading:$,documents:d,paginator:c,loadDocuments:S}=ue((j=m.params)==null?void 0:j.dataset_id),{handleDelete:h}=_e(),{handleUpdate:b}=me();return(P,r)=>{var N,Q,F,A,L;const s=a("icon-left"),M=a("a-button"),q=a("router-link"),W=a("a-avatar"),R=a("a-skeleton-line"),Y=a("a-tag"),B=a("a-input-search"),H=a("a-space"),z=a("a-table-column"),J=a("a-divider"),G=a("a-switch"),K=a("a-tooltip"),X=a("icon-more"),I=a("a-doption"),Z=a("a-dropdown"),ee=a("a-table");return u(),v("div",We,[l("div",Je,[e(q,{to:{name:"space-datasets-list"}},{default:t(()=>[e(M,{size:"mini",type:"text",class:"!text-gray-700"},{icon:t(()=>[e(s)]),_:1})]),_:1}),l("div",Ke,[e(W,{size:40,shape:"square",class:"rounded-lg","image-url":o(y).icon},null,8,["image-url"]),l("div",Xe,[(N=o(y))!=null&&N.name?(u(),v("div",Ze,"知识库 / "+x(o(y).name),1)):(u(),U(R,{key:0,widths:[100]})),(Q=o(y))!=null&&Q.name?(u(),v("div",tt,[e(Y,{size:"small",class:"rounded h-[18px] leading-[18px] bg-gray-200 text-gray-500"},{default:t(()=>[p(x(o(y).document_count)+" 文档",1)]),_:1}),e(Y,{size:"small",class:"rounded h-[18px] leading-[18px] bg-gray-200 text-gray-500"},{default:t(()=>[p(x(o(y).hit_count)+" 命中",1)]),_:1}),e(Y,{size:"small",class:"rounded h-[18px] leading-[18px] bg-gray-200 text-gray-500"},{default:t(()=>[p(x(o(y).related_app_count)+" 关联应用",1)]),_:1})])):(u(),v("div",et,[e(R,{widths:[60],"line-height":18}),e(R,{widths:[60],"line-height":18}),e(R,{widths:[60],"line-height":18})]))])])]),l("div",at,[e(B,{"default-value":((F=o(m).query)==null?void 0:F.search_word)||"",placeholder:"请输入关键词搜素文档",class:"w-[240px] bg-white rounded-lg border-gray-200",onSearch:r[0]||(r[0]=i=>{o(g).push({path:o(m).path,query:{search_word:i,current_page:1}})})},null,8,["default-value"]),e(H,{size:12},{default:t(()=>{var i;return[e(M,{class:"rounded-lg",onClick:r[1]||(r[1]=C=>V.value=!0)},{default:t(()=>r[5]||(r[5]=[p("召回测试")])),_:1}),e(q,{to:{name:"space-datasets-documents-create",params:{dataset_id:(i=o(m).params)==null?void 0:i.dataset_id}}},{default:t(()=>[e(M,{type:"primary",class:"rounded-lg"},{default:t(()=>r[6]||(r[6]=[p("添加文件")])),_:1})]),_:1},8,["to"])]}),_:1})]),l("div",st,[e(ee,{hoverable:"",pagination:{total:o(c).total_record,current:o(c).current_page,defaultCurrent:1,pageSize:o(c).page_size,defaultPageSize:20,showTotal:!0},loading:o($),data:o(d),bordered:{wrapper:!1},onPageChange:r[2]||(r[2]=i=>{var C;o(g).push({path:o(m).path,query:{current_page:i,search_word:((C=o(m).query)==null?void 0:C.search_word)||""}})})},{columns:t(()=>[e(z,{title:"#","data-index":"position",align:"center",width:80,"header-cell-class":"rounded-tl-lg !bg-gray-200 text-gray-700","cell-class":"bg-transparent text-gray-700"}),e(z,{title:"文档名","data-index":"name",width:400,"header-cell-class":"!bg-gray-200 text-gray-700","cell-class":"bg-transparent text-gray-700"},{cell:t(({record:i})=>{var C;return[e(q,{to:{name:"space-datasets-documents-segments-list",params:{dataset_id:(C=o(m).params)==null?void 0:C.dataset_id,document_id:i.id}}},{default:t(()=>[p(x(i.name),1)]),_:2},1032,["to"])]}),_:1}),e(z,{title:"字符数","data-index":"character_count","header-cell-class":"!bg-gray-200 text-gray-700","cell-class":"bg-transparent text-gray-700"},{cell:t(({record:i})=>[p(x((i.character_count/1e3).toFixed(1))+"k ",1)]),_:1}),e(z,{title:"召回次数","data-index":"hit_count","header-cell-class":"!bg-gray-200 text-gray-700","cell-class":"bg-transparent text-gray-700"}),e(z,{title:"上传时间","data-index":"created_at","header-cell-class":"!bg-gray-200 text-gray-700","cell-class":"bg-transparent text-gray-700"},{cell:t(({record:i})=>[p(x(o(le)(i.created_at).format("YYYY-MM-DD HH:mm:ss")),1)]),_:1}),e(z,{title:"状态","data-index":"enabled","header-cell-class":"!bg-gray-200 text-gray-700","cell-class":"bg-transparent text-gray-700"},{cell:t(({record:i})=>[e(H,null,{default:t(()=>[i.enabled?(u(),v("div",lt)):(u(),v("div",ot)),i.enabled?(u(),v("div",nt,"可用")):(u(),v("div",it,"已禁用"))]),_:2},1024)]),_:1}),e(z,{title:"操作","data-index":"operator","header-cell-class":"rounded-tr-lg !bg-gray-200 text-gray-700","cell-class":"bg-transparent text-gray-700 !h-[40px]",width:100},{cell:t(({record:i,rowIndex:C})=>[e(H,{size:0},{split:t(()=>[e(J,{direction:"vertical"})]),default:t(()=>[i.status==="error"?(u(),U(K,{key:0,content:`错误信息:${i.error}`},{default:t(()=>[e(G,{size:"small",type:"round","default-checked":!1,disabled:""})]),_:2},1032,["content"])):(u(),U(G,{key:1,size:"small","checked-color":"#10b981",type:"round","unchecked-color":"#556581","model-value":i.enabled,onChange:n=>{var O;o(b)((O=o(m).params)==null?void 0:O.dataset_id,i.id,n,()=>{o(d)[C].enabled=n})}},null,8,["model-value","onChange"])),e(Z,{position:"br"},{content:t(()=>[e(I,{onClick:()=>{w.value=!0,f.value=i.id}},{default:t(()=>r[7]||(r[7]=[p("重命名")])),_:2},1032,["onClick"]),e(I,{class:"!text-red-700",onClick:()=>{var n;return o(h)((n=o(m).params)==null?void 0:n.dataset_id,i.id,async()=>{var O;await o(S)(),await o(k)((O=o(m).params)==null?void 0:O.dataset_id)})}},{default:t(()=>r[8]||(r[8]=[p("删除")])),_:2},1032,["onClick"])]),default:t(()=>[e(M,{type:"text",size:"small",class:"!text-gray-700"},{icon:t(()=>[e(X)]),_:1})]),_:2},1024)]),_:2},1024)]),_:1})]),_:1},8,["pagination","loading","data"])]),e(he,{document_id:f.value,dataset_id:(A=o(m).params)==null?void 0:A.dataset_id,visible:w.value,"onUpdate:visible":r[3]||(r[3]=i=>w.value=i),"on-after-update":()=>o(S)()},null,8,["document_id","dataset_id","visible","on-after-update"]),e(Qe,{visible:V.value,"onUpdate:visible":r[4]||(r[4]=i=>V.value=i),dataset_id:(L=o(m).params)==null?void 0:L.dataset_id},null,8,["visible","dataset_id"])])}}});export{_t as default};
