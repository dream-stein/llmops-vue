import{p as I,g as F,A as R,r as u,M as U,L as G,d as O,y as D,z as H,w as l,q as c,t as C,a as k,x as S,e as t,i as q,b as p,o as J,c as B,B as Q}from"./index-BJog29LW.js";import{h as X}from"./moment-C5S46NFB.js";const Z=e=>I("/openapi/api-keys",{body:e}),ee=e=>I(`/openapi/api-keys/${e}/delete`),ae=(e,d)=>I(`/openapi/api-keys/${e}`,{body:d}),te=(e,d)=>I(`/openapi/api-keys/${e}/is-active`,{body:{is_active:d}}),se=e=>F("/openapi/api-keys",{params:e}),ie=()=>{const e=R(),d=u(!1),i=u([]),o=u({...{current_page:1,page_size:20,total_page:0,total_record:0}});return{loading:d,api_keys:i,paginator:o,loadApiKeys:async(z=!1)=>{var g,b;if(!(!z&&o.value.current_page>o.value.total_page))try{d.value=!0;const h=(await se({current_page:((g=e.query)==null?void 0:g.current_page)||1,page_size:((b=e.query)==null?void 0:b.page_size)||20})).data;console.log(h),o.value=h.paginator,i.value=h.list}finally{d.value=!1}}}},le=()=>({handleDeleteApiKey:(d,i)=>{G.warning({title:"要删除该API秘钥吗?",content:"删除秘钥后，无法使用该秘钥访问 LLMOps 个人空间中的所有 Agent，并且无法恢复，如果临时关闭请使用禁用功能。",hideCancel:!1,onOk:async()=>{try{const r=await ee(d);U.success(r.message)}finally{i&&i()}}})}}),oe=()=>{const e=u(!1);return{loading:e,handleUpdateApiKey:async(i,r)=>{try{e.value=!0;const o=await ae(i,r);U.success(o.message)}finally{e.value=!1}}}},ne=()=>{const e=u(!1);return{loading:e,handleUpdateApiKeyIsActive:async(i,r,o)=>{try{e.value=!0;const w=await te(i,r);U.success(w.message)}finally{e.value=!1,o&&o()}}}},re=()=>{const e=u(!1);return{loading:e,handleCreateApiKey:async i=>{try{e.value=!0;const r=await Z(i);U.success(r.message)}finally{e.value=!1}}}},ce={class:"flex items-center justify-between"},de={class:"text-lg font-bold text-gray-700"},pe={class:"pt-6"},ue={class:"flex items-center justify-between"},_e=O({__name:"CreateOrUpdateApiKeyModal",props:{visible:{type:Boolean,default:!1,required:!0},api_key_id:{type:String,default:"",required:!0},is_active:{type:Boolean,default:!1,required:!0},remark:{type:String,default:"",required:!0},callback:{type:Function,required:!1}},emits:["update:visible","update:api_key_id","update:is_active","update:remark"],setup(e,{emit:d}){const i=e,r=d,o=u({}),w=u(null),{loading:z,handleUpdateApiKey:g}=oe(),{loading:b,handleCreateApiKey:A}=re(),h=()=>{r("update:visible",!1)},P=async({errors:y})=>{var s,m,_,K;y||(i.api_key_id?await g(i.api_key_id,{is_active:!!((s=o.value)!=null&&s.is_active),remark:String((m=o.value)==null?void 0:m.remark)}):await A({is_active:!!((_=o.value)!=null&&_.is_active),remark:String((K=o.value)==null?void 0:K.remark)}),h(),i.callback&&i.callback())};return D(()=>i.visible,y=>{y?o.value={is_active:i.is_active,remark:i.remark}:(r("update:api_key_id",""),r("update:is_active",!1),r("update:remark",""))}),(y,s)=>{const m=c("icon-close"),_=c("a-button"),K=c("a-switch"),v=c("a-form-item"),n=c("a-textarea"),$=c("a-space"),M=c("a-form"),x=c("a-modal");return C(),H(x,{visible:i.visible,"onUpdate:visible":s[4]||(s[4]=f=>r("update:visible",f)),"hide-title":"",footer:!1},{default:l(()=>[k("div",ce,[k("div",de,S(e.api_key_id?"更新":"新增")+"秘钥",1),t(_,{type:"text",class:"!text-gray-700",size:"small",onClick:s[0]||(s[0]=()=>r("update:visible",!1))},{icon:l(()=>[t(m)]),_:1})]),k("div",pe,[t(M,{ref_key:"formRef",ref:w,model:o.value,layout:"vertical",onSubmit:P},{default:l(()=>[t(v,{field:"is_active",label:"秘钥状态"},{default:l(()=>[t(K,{"model-value":o.value.is_active,"onUpdate:modelValue":s[1]||(s[1]=f=>o.value.is_active=f),"checked-color":"#10b981","unchecked-color":"#556581"},null,8,["model-value"])]),_:1}),t(v,{field:"remark",label:"秘钥备注"},{default:l(()=>[t(n,{"model-value":o.value.remark,"onUpdate:modelValue":s[2]||(s[2]=f=>o.value.remark=f),"max-length":100,"show-word-limit":"",placeholder:"请输入秘钥备注，用于描述秘钥基础信息"},null,8,["model-value"])]),_:1}),k("div",ue,[s[7]||(s[7]=k("div",{class:""},null,-1)),t($,{size:16},{default:l(()=>[t(_,{class:"rounded-lg",onClick:s[3]||(s[3]=()=>r("update:visible",!1))},{default:l(()=>s[5]||(s[5]=[q(" 取消 ")])),_:1}),t(_,{loading:p(z)||p(b),type:"primary","html-type":"submit",class:"rounded-lg"},{default:l(()=>s[6]||(s[6]=[q(" 保存 ")])),_:1},8,["loading"])]),_:1})])]),_:1},8,["model"])])]),_:1},8,["visible"])}}}),ye={class:"h-[calc(100vh-160px)] overflow-scroll scrollbar-w-none"},ve={class:"flex items-center"},ge={class:"line-clamp-1"},me={key:0,class:"w-2 h-2 bg-green-500 rounded-sm border border-green-700"},fe={key:1,class:"w-2 h-2 bg-gray-500 rounded-sm border border-gray-700"},ke={key:2,class:"text-gray-700"},be={key:3,class:"text-gray-700"},Ae={class:"line-clamp-1"},we=O({__name:"ListView",props:{create_api_key:{type:Boolean,default:!1,required:!0}},emits:["update:create_api_key"],setup(e,{emit:d}){const i=R(),r=Q(),o=e,w=d,{loading:z,paginator:g,api_keys:b,loadApiKeys:A}=ie(),{handleUpdateApiKeyIsActive:h}=ne(),{handleDeleteApiKey:P}=le(),y=u(!1),s=u(""),m=u(!1),_=u(""),K=async v=>{try{await navigator.clipboard.writeText(v),U.success("复制成功")}catch(n){U.error(String(n))}};return J(async()=>{await A(!0)}),D(()=>o.create_api_key,v=>{s.value="",y.value=!!v}),D(()=>i.query,async(v,n)=>{v.current_page!=n.current_page&&await A()}),(v,n)=>{const $=c("icon-copy"),M=c("a-button"),x=c("a-table-column"),f=c("a-space"),T=c("a-divider"),Y=c("a-switch"),N=c("icon-more"),L=c("a-doption"),W=c("a-dropdown"),j=c("a-table");return C(),B("div",ye,[t(j,{hoverable:"",pagination:{total:p(g).total_record,current:p(g).current_page,defaultCurrent:1,pageSize:p(g).page_size,defaultPageSize:20,showTotal:!0},loading:p(z),bordered:{wrapper:!1},data:p(b),onPageChange:n[0]||(n[0]=a=>{p(r).push({path:p(i).path,query:{current_page:a}})})},{columns:l(()=>[t(x,{title:"秘钥","data-index":"api_key",width:400,"header-cell-class":"rounded-tl-lg !bg-gray-200 text-gray-700","cell-class":"bg-transparent text-gray-700"},{cell:l(({record:a})=>[k("div",ve,[k("div",ge,S(a.api_key),1),t(M,{size:"mini",class:"flex-shrink-0 rounded",onClick:async()=>K(a.api_key)},{icon:l(()=>[t($)]),_:2},1032,["onClick"])])]),_:1}),t(x,{title:"状态","data-index":"is_active","header-cell-class":"!bg-gray-200 text-gray-700","cell-class":"bg-transparent text-gray-700"},{cell:l(({record:a})=>[t(f,null,{default:l(()=>[a.is_active?(C(),B("div",me)):(C(),B("div",fe)),a.is_active?(C(),B("div",ke,"可用")):(C(),B("div",be,"已禁用"))]),_:2},1024)]),_:1}),t(x,{title:"创建时间","data-index":"created_at","header-cell-class":"!bg-gray-200 text-gray-700","cell-class":"bg-transparent text-gray-700"},{cell:l(({record:a})=>[q(S(p(X)(a.created_at).format("YYYY-MM-DD hh:mm:ss")),1)]),_:1}),t(x,{title:"备注",width:400,"data-index":"remark","header-cell-class":"!bg-gray-200 text-gray-700","cell-class":"bg-transparent text-gray-700"},{cell:l(({record:a})=>[k("div",Ae,S(a.remark),1)]),_:1}),t(x,{title:"操作","data-index":"operator","header-cell-class":"rounded-tr-lg !bg-gray-200 text-gray-700","cell-class":"bg-transparent text-gray-700 !h-[40px]",width:100},{cell:l(({record:a,rowIndex:E})=>[t(f,{size:0},{split:l(()=>[t(T,{direction:"vertical"})]),default:l(()=>[t(Y,{size:"small",type:"round","checked-color":"#10b981","unchecked-color":"#556581","model-value":a.is_active,onChange:V=>{p(h)(a.id,V,()=>{p(b)[E].is_active=!!V})}},null,8,["model-value","onChange"]),t(W,{position:"br"},{content:l(()=>[t(L,{onClick:()=>{s.value=a.id,m.value=a.is_active,_.value=a.remark,y.value=!0}},{default:l(()=>n[6]||(n[6]=[q(" 重命名 ")])),_:2},1032,["onClick"]),t(L,{class:"!text-red-700",onClick:()=>p(P)(a.id,async()=>{await p(A)()})},{default:l(()=>n[7]||(n[7]=[q(" 删除 ")])),_:2},1032,["onClick"])]),default:l(()=>[t(M,{type:"text",size:"mini",class:"!text-gray-700"},{icon:l(()=>[t(N)]),_:1})]),_:2},1024)]),_:2},1024)]),_:1})]),_:1},8,["pagination","loading","data"]),t(_e,{visible:y.value,"onUpdate:visible":[n[1]||(n[1]=a=>y.value=a),n[5]||(n[5]=a=>w("update:create_api_key",a))],api_key_id:s.value,"onUpdate:api_key_id":n[2]||(n[2]=a=>s.value=a),is_active:m.value,"onUpdate:is_active":n[3]||(n[3]=a=>m.value=a),remark:_.value,"onUpdate:remark":n[4]||(n[4]=a=>_.value=a),callback:async()=>await p(A)()},null,8,["visible","api_key_id","is_active","remark","callback"])])}}});export{we as default};
