import{m as O}from"./moment-Cdflw7-y.js";import{u as P,a as W,b as J,c as K,d as Q,e as X}from"./use-app-dbDCnJnL.js";import{d as G,r as V,y as N,t as s,a as m,z as _,w as a,b as i,x as v,f as t,j as g,e as n,u as Y,o as Z,A as ee,c as te,k as ae,h as H,F as oe}from"./index-BgoldPQy.js";import{u as se}from"./upload-file-BiF099-T.js";const le={class:"flex items-center justify-between"},ne={class:"text-lg font-bold text-gray-700"},ie={class:"pt-6"},re={class:"flex items-center justify-between"},ce=G({__name:"CreateOrUpdateAppModal",props:{app_id:{type:String,default:"",required:!1},visible:{type:Boolean,required:!0},callback:{type:Function,required:!1}},emits:["update:visible","update:app_id"],setup(z,{emit:j}){const d=z,w=j,{loading:F,handleCreateApp:y}=P(),{loading:b,handleUpdateApp:M}=W(),{app:x,loadApp:L}=J(),A={fileList:[],icon:"",name:"",description:""},l=V({...A}),p=V(),C=()=>w("update:visible",!1),T=async({errors:r})=>{r||(d.app_id?await M(d.app_id,l.value):await y(l.value),w("update:visible",!1),d.callback&&d.callback())};return N(()=>d.visible,async r=>{var e,u;(e=p.value)==null||e.resetFields(),r?d.app_id&&(await L(d.app_id),l.value={fileList:[{uid:"1",name:"应用图标",url:x.value.icon}],icon:x.value.icon,name:x.value.name,description:x.value.description}):(l.value=A,(u=p.value)==null||u.resetFields(),w("update:app_id",""))}),(r,e)=>{const u=s("icon-close"),f=s("a-button"),q=s("a-upload"),h=s("a-form-item"),B=s("a-input"),k=s("a-textarea"),D=s("a-space"),I=s("a-form"),R=s("a-modal");return m(),_(R,{width:520,visible:d.visible,"hide-title":"",footer:!1,"modal-class":"rounded-xl",onCancel:C},{default:a(()=>[i("div",le,[i("div",ne,v(d.app_id===""?"创建 AI 应用":"编辑 AI 应用"),1),t(f,{type:"text",class:"!text-gray-700",size:"small",onClick:C},{icon:a(()=>[t(u)]),_:1})]),i("div",ie,[t(I,{ref_key:"formRef",ref:p,model:l.value,layout:"vertical",onSubmit:T},{default:a(()=>[t(h,{field:"fileList","hide-label":"",rules:[{required:!0,message:"应用图标不能为空"}]},{default:a(()=>[t(q,{limit:1,"list-type":"picture-card",accept:"image/png, image/jpeg",class:"!w-auto mx-auto","file-list":l.value.fileList,"onUpdate:fileList":e[0]||(e[0]=c=>l.value.fileList=c),"image-preview":"","custom-request":c=>{const{fileItem:$,onSuccess:S,onError:U}=c;return(async()=>{try{const o=await n(se)($.file);l.value.icon=o.data.image_url,S(o)}catch(o){U(o)}})(),{abort:()=>{}}},"on-before-remove":async()=>(l.value.icon="",!0)},null,8,["file-list","custom-request","on-before-remove"])]),_:1}),t(h,{field:"name",label:"应用名称","asterisk-position":"end",rules:[{required:!0,message:"应用名称不能为空"}]},{default:a(()=>[t(B,{"model-value":l.value.name,"onUpdate:modelValue":e[1]||(e[1]=c=>l.value.name=c),placeholder:"请输入应用名称"},null,8,["model-value"])]),_:1}),t(h,{field:"content",label:"应用描述"},{default:a(()=>[t(k,{"model-value":l.value.description,"onUpdate:modelValue":e[2]||(e[2]=c=>l.value.description=c),"auto-size":{minRows:8,maxRows:8},"max-length":800,"show-word-limit":"",placeholder:"请输入关于该应用的描述信息"},null,8,["model-value"])]),_:1}),i("div",re,[e[5]||(e[5]=i("div",{class:""},null,-1)),t(D,{size:16},{default:a(()=>[t(f,{class:"rounded-lg",onClick:C},{default:a(()=>e[3]||(e[3]=[g("取消")])),_:1}),t(f,{loading:n(F)||n(b),type:"primary","html-type":"submit",class:"rounded-lg"},{default:a(()=>e[4]||(e[4]=[g(" 保存 ")])),_:1},8,["loading"])]),_:1})])]),_:1},8,["model"])])]),_:1},8,["visible"])}}}),de={class:"flex items-center gap-3 mb-3"},pe={class:"flex flex-1 justify-between"},ue={class:"flex flex-col"},me={class:"text-xs text-gray-500 line-clamp-1"},_e={class:"leading-[18px] text-gray-500 h-[72px] line-clamp-4 mb-2 break-all"},fe={class:"flex items-center gap-1.5"},ve={class:"text-xs text-gray-400"},ke=G({__name:"ListView",props:{createType:{type:String,default:"",required:!0}},emits:["update-create-type"],setup(z,{emit:j}){const d=ee(),w=z,F=j,y=V(!1),b=V(""),M=Y(),{handleCopyApp:x}=K(),{loading:L,apps:A,paginator:l,loadApps:p}=Q(),{handleDeleteApp:C}=X(),T=async r=>{const{scrollTop:e,scrollHeight:u,clientHeight:f}=r.target;if(e+f>=u-10){if(L.value)return;await p()}};return Z(async()=>{await p(!0)}),N(()=>w.createType,r=>{r==="app"&&(b.value="",y.value=!0,F("update-create-type",""))}),N(()=>{var r;return(r=d.query)==null?void 0:r.search_word},async()=>await p(!0)),(r,e)=>{const u=s("a-avatar"),f=s("icon-check-circle-fill"),q=s("router-link"),h=s("icon-more"),B=s("a-button"),k=s("a-doption"),D=s("a-dropdown"),I=s("icon-user"),R=s("a-card"),c=s("a-col"),$=s("a-empty"),S=s("a-row"),U=s("a-spin"),E=s("a-space");return m(),_(U,{loading:n(L),class:"block h-full w-full scrollbar-w-none overflow-scroll",onScroll:T},{default:a(()=>[t(S,{gutter:[20,20],class:"flex-1"},{default:a(()=>[(m(!0),te(oe,null,ae(n(A),o=>(m(),_(c,{key:o.id,span:6},{default:a(()=>[t(R,{hoverable:"",class:"cursor-pointer rounded-lg"},{default:a(()=>[i("div",de,[t(u,{size:40,shape:"square","image-url":o.icon},null,8,["image-url"]),i("div",pe,[i("div",ue,[t(q,{to:{name:"space-apps-detail",params:{app_id:o.id}},class:"text-base text-gray-900 font-bold"},{default:a(()=>[g(v(o.name)+" ",1),o.status==="published"?(m(),_(f,{key:0,class:"text-green-700"})):H("",!0)]),_:2},1032,["to"]),i("div",me,v(o.model_config.provider)+" · "+v(o.model_config.model),1)]),t(D,{position:"br"},{content:a(()=>[t(q,{to:{name:"space-apps-analysis",params:{app_id:o.id}}},{default:a(()=>[t(k,null,{default:a(()=>e[2]||(e[2]=[g("分析")])),_:1})]),_:2},1032,["to"]),t(k,{onClick:()=>{b.value=o.id,y.value=!0}},{default:a(()=>e[3]||(e[3]=[g(" 编辑应用 ")])),_:2},1032,["onClick"]),t(k,{onClick:async()=>await n(x)(o.id)},{default:a(()=>e[4]||(e[4]=[g("创建副本")])),_:2},1032,["onClick"]),t(k,{class:"text-red-700",onClick:async()=>await n(C)(o.id,async()=>await n(p)(!0))},{default:a(()=>e[5]||(e[5]=[g(" 删除 ")])),_:2},1032,["onClick"])]),default:a(()=>[t(B,{type:"text",size:"small",class:"rounded-lg !text-gray-700"},{icon:a(()=>[t(h)]),_:1})]),_:2},1024)])]),i("div",_e,v(o.description.trim()===""?o.preset_prompt:o.description),1),i("div",fe,[t(u,{size:18,class:"bg-blue-700"},{default:a(()=>[t(I)]),_:1}),i("div",ve,v(n(M).account.name)+" · 最近编辑 "+v(n(O)(o.created_at*1e3).format("MM-DD HH:mm")),1)])]),_:2},1024)]),_:2},1024))),128)),n(A).length===0?(m(),_(c,{key:0,span:24},{default:a(()=>[t($,{description:"没有可用的Agent智能体",class:"h-[400px] flex flex-col items-center justify-center"})]),_:1})):H("",!0)]),_:1}),n(l).total_page>=2?(m(),_(S,{key:0},{default:a(()=>[n(l).current_page<=n(l).total_page?(m(),_(c,{key:0,span:24,align:"center"},{default:a(()=>[t(E,{class:"my-4"},{default:a(()=>[t(U),e[6]||(e[6]=i("div",{class:"text-gray-400"},"加载中",-1))]),_:1})]),_:1})):(m(),_(c,{key:1,span:24,align:"center"},{default:a(()=>e[7]||(e[7]=[i("div",{class:"text-gray-400 my-4"},"数据已加载完成",-1)])),_:1}))]),_:1})):H("",!0),t(ce,{visible:y.value,"onUpdate:visible":e[0]||(e[0]=o=>y.value=o),app_id:b.value,"onUpdate:app_id":e[1]||(e[1]=o=>b.value=o),callback:async()=>await n(p)(!0)},null,8,["visible","app_id","callback"])]),_:1},8,["loading"])}}});export{ke as default};
