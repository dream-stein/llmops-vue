import{v as m}from"./index-CWSYUkW0.js";const u="http://127.0.0.1:8080",b={success:0,fail:1,notFound:2,unauthorized:3,forbidden:4,validateError:5},P={str:"字符串",int:"整型",float:"浮点型",bool:"布尔值"},y=1e5,p={method:"GET",mode:"cors",credentials:"include",headers:new Headers({"Content-Type":"application/json"}),redirect:"follow"},T=(t,e)=>{const a=Object.assign({},p,e);let r=`${u}${t.startsWith("/")?t:`/${t}`}`;const{method:i,params:n,body:s}=a;if(i==="GET"&&n){const o=[];Object.keys(n).forEach(c=>{o.push(`${c}=${encodeURIComponent(n[c])}`)}),r.search(/\?/)===-1?r+=`?${o.join("&")}`:r+=`&${o.join("&")}`,delete a.params}return s&&(a.body=JSON.stringify(s)),Promise.race([new Promise((o,c)=>{setTimeout(()=>{c("接口已超时")},y)}),new Promise((o,c)=>{globalThis.fetch(r,a).then(async f=>{const d=await f.json();d.code===b.success?o(d):(m.error(d.message),c(new Error(d.message)))}).catch(f=>{m.error(f.message),c(f)})})])},$=async(t,e,a)=>{const r=Object.assign({},p,{method:"POST"},e),i=`${u}${t.startsWith("/")?t:`/${t}`}`,{body:n}=e;n&&(r.body=JSON.stringify(n));const s=await globalThis.fetch(i,r);return w(s,a)},w=(t,e)=>{var s;if(!t.ok)throw new Error("网络请求失败");const a=(s=t.body)==null?void 0:s.getReader(),r=new TextDecoder("utf-8");let i="";const n=()=>{let o=!1;a==null||a.read().then(c=>{if(c.done)return;i+=r.decode(c.value,{stream:!0});const f=i.split(`
`);let d="",l="";try{f.forEach(h=>{h=h.trim(),h.startsWith("event:")?d=h.slice(6).trim():h.startsWith("data:")&&(l=h.slice(5).trim()),h===""&&d!==""&&l!==""&&(e({event:d,data:JSON.parse(l)}),d="",l="")}),i=f.pop()||""}catch{o=!0}o||n()})};n()},j=(t,e={})=>{const r={method:"POST",url:`${u}${t.startsWith("/")?t:`/${t}`}`,headers:{},data:{}};return e={...r,...e,headers:{...r.headers,...e.headers}},new Promise((i,n)=>{const s=new XMLHttpRequest;s.open(e.methd,e.url);for(const o in e.headers)s.setRequestHeader(o,e.headers[o]);s.withCredentials=!0,s.responseType="json",s.onreadystatechange=()=>{s.readyState===4&&(s.status===200?i(s.response):n(s))},s.upload.onprogress=e.onprogress,s.send(e.data)})},g=(t,e={})=>T(t,e),E=(t,e={})=>g(t,Object.assign({},e,{method:"GET"})),W=(t,e={})=>g(t,Object.assign({},e,{method:"POST"}));export{E as g,W as p,$ as s,P as t,j as u};
