import{m as J}from"./moment-nLSn3b_r.js";import{x as E,y as A,b as w,k as K,v as O,M as Q,d as G,e as I,r as s,o as y,c as C,w as o,g as f,t as L,h as t,a as F,u as d,l as X,m as Y,j as Z,f as ee,n as te,i as H,F as ae}from"./index-DMjyc82X.js";import{u as oe}from"./upload-file-CuqIBz8a.js";const le=e=>E("/workflows",{params:e}),se=e=>A("/workflows",{body:e}),ne=(e,u)=>A(`/workflows/${e}`,{body:u}),re=e=>E(`/workflows/${e}`),ie=e=>A(`/workflows/${e}/delete`),ce=()=>{const e=w(!1),u=w([]),a={current_page:1,page_size:20,total_page:0,total_record:0},l=w({...a});return{loading:e,workflows:u,paginator:l,loadWorkflows:async(b="",x="",U=!1)=>{if(U)l.value=a;else if(l.value.current_page>l.value.total_page)return;try{e.value=!0;const h=(await le({current_page:l.value.current_page,page_size:l.value.page_size,search_word:b,status:x})).data;l.value=h.paginator,l.value.current_page<=l.value.total_page&&(l.value.current_page+=1),U?u.value=h.list:u.value.push(...h.list)}finally{u.value=[{id:"11",name:"小红书文案生成",tool_call_name:"WorkflowName",icon:"https://www.yimiaotui.com/d/image/20230427/98ed757ec1b322e69fb9e5afcfb275c2.jpg",description:"这是一个可以根据特定主体生成小红书文案的工作流，传递对应的query即可。",status:"published",is_debug_passed:!0,node_count:1,published_at:1742704861,updated_at:1742704861,created_at:1742704861}],e.value=!1}}}},ue=()=>{const e=w(!1),u=K();return{loading:e,handleCreateWorkflow:async l=>{try{e.value=!0;const g=await se(l);O.success("创建工作流成功"),await u.push({name:"space-workflows-detail",params:{workflow_id:g.data.id}})}finally{e.value=!1}}}},de=()=>{const e=w(!1);return{loading:e,handleUpdateWorkflow:async(a,l)=>{try{e.value=!0;const g=await ne(a,l);O.success(g.message)}finally{e.value=!1}}}},pe=()=>{const e=w(!1),u=w({});return{loading:e,workflow:u,loadWorkflow:async l=>{try{e.value=!0;const g=await re(l);u.value=g.data}finally{e.value=!1}}}},fe=()=>({handleDeleteWorkflow:(u,a)=>{Q.warning({title:"要删除该工作流吗?",content:"删除工作流后，发布的WebApp、开放API以及关联的社交媒体平台均无法使用该工作流，如果需要暂停工作流，可使用取消发布功能。",hideCancel:!1,onOk:async()=>{try{const l=await ie(u);O.success(l.message)}finally{a&&a()}}})}}),_e={class:"flex items-center justify-between"},me={class:"text-lg font-bold text-gray-700"},we={class:"pt-6"},ge={class:"flex items-center justify-between"},ve=G({__name:"CreateOrUpdateWorkflowModal",props:{workflow_id:{type:String,default:"",required:!1},visible:{type:Boolean,required:!0},callback:{type:Function,required:!1}},emits:["update:visible","update:workflow_id"],setup(e,{emit:u}){const a=e,l=u,{loading:g,handleCreateWorkflow:b}=ue(),{loading:x,handleUpdateWorkflow:U}=de(),{workflow:v,loadWorkflow:h}=pe(),M={fileList:[],icon:"",name:"",tool_call_name:"",description:""},r=w({...M}),j=w(),D=()=>l("update:visible",!1),p=async({errors:i})=>{i||(a.workflow_id?await U(a.workflow_id,r.value):await b(r.value),l("update:visible",!1),a.callback&&a.callback())};return I(()=>a.visible,async i=>{var n,W,_,z,k,q,V;(n=j.value)==null||n.resetFields(),i?a.workflow_id&&(await h(a.workflow_id),r.value={fileList:[{uid:"1",name:"应用图标",url:String((W=v.value)==null?void 0:W.icon)}],icon:String((_=v.value)==null?void 0:_.icon),name:String((z=v.value)==null?void 0:z.name),tool_call_name:String((k=v.value)==null?void 0:k.tool_call_name),description:String((q=v.value)==null?void 0:q.description)}):(r.value=M,(V=j.value)==null||V.resetFields(),l("update:workflow_id",""))}),(i,n)=>{const W=s("icon-close"),_=s("a-button"),z=s("a-upload"),k=s("a-form-item"),q=s("a-input"),V=s("a-textarea"),B=s("a-space"),N=s("a-form"),$=s("a-modal");return y(),C($,{width:520,visible:a.visible,"hide-title":"",footer:!1,"modal-class":"rounded-xl",onCancel:D},{default:o(()=>[f("div",_e,[f("div",me,L(a.workflow_id===""?"创建工作流":"编辑工作流"),1),t(_,{type:"text",class:"!text-gray-700",size:"small",onClick:D},{icon:o(()=>[t(W)]),_:1})]),f("div",we,[t(N,{ref_key:"formRef",ref:j,model:r.value,layout:"vertical",onSubmit:p},{default:o(()=>[t(k,{field:"fileList","hide-label":"",rules:[{required:!0,message:"工作流图标不能为空"}]},{default:o(()=>[t(z,{limit:1,"list-type":"picture-card",accept:"image/png, image/jpeg",class:"!w-auto mx-auto","file-list":r.value.fileList,"onUpdate:fileList":n[0]||(n[0]=m=>r.value.fileList=m),"image-preview":"","custom-request":m=>{const{fileItem:R,onSuccess:T,onError:P}=m;return(async()=>{try{const S=await d(oe)(R.file);r.value.icon=S.data.image_url,T(S)}catch(S){P(S)}})(),{abort:()=>{}}},"on-before-remove":async()=>(r.value.icon="",!0)},null,8,["file-list","custom-request","on-before-remove"])]),_:1}),t(k,{field:"name",label:"工作流名称","asterisk-position":"end",rules:[{required:!0,message:"工作流名称不能为空"}]},{default:o(()=>[t(q,{"show-word-limit":"","max-length":50,"model-value":r.value.name,"onUpdate:modelValue":n[1]||(n[1]=m=>r.value.name=m),placeholder:"请输入工作流名称"},null,8,["model-value"])]),_:1}),t(k,{field:"tool_call_name",label:"英文名称","asterisk-position":"end",rules:[{required:!0,message:"英文名称不能为空"}]},{default:o(()=>[t(q,{"show-word-limit":"","max-length":50,"model-value":r.value.tool_call_name,"onUpdate:modelValue":n[2]||(n[2]=m=>r.value.tool_call_name=m),placeholder:"英文名称将用于被大模型识别及调用"},null,8,["model-value"])]),_:1}),t(k,{field:"description",label:"工作流描述","asterisk-position":"end",rules:[{required:!0,message:"工作流描述不能为空"}]},{default:o(()=>[t(V,{"model-value":r.value.description,"onUpdate:modelValue":n[3]||(n[3]=m=>r.value.description=m),"auto-size":{minRows:8,maxRows:8},"max-length":1024,"show-word-limit":"",placeholder:"请输入关于该工作流的描述信息，以便LLM能准确识别工作流的用途。"},null,8,["model-value"])]),_:1}),f("div",ge,[n[6]||(n[6]=f("div",{class:""},null,-1)),t(B,{size:16},{default:o(()=>[t(_,{class:"rounded-lg",onClick:D},{default:o(()=>n[4]||(n[4]=[F("取消")])),_:1}),t(_,{loading:d(g)||d(x),type:"primary","html-type":"submit",class:"rounded-lg"},{default:o(()=>n[5]||(n[5]=[F(" 保存 ")])),_:1},8,["loading"])]),_:1})])]),_:1},8,["model"])])]),_:1},8,["visible"])}}}),ke={class:"flex items-center gap-3 mb-3"},ye={class:"flex flex-1 justify-between"},be={class:"flex flex-col"},xe={class:"text-xs text-gray-500 line-clamp-1"},he={class:"leading-[18px] text-gray-500 h-[72px] line-clamp-4 mb-2 break-all"},We={class:"flex items-center gap-1.5"},qe={class:"text-xs text-gray-400"},Ue=G({__name:"ListView",props:{createType:{type:String,default:"",required:!0}},emits:["update-create-type"],setup(e,{emit:u}){const a=Z(),l=e,g=u,b=w(!1),x=w(""),U=X(),{loading:v,workflows:h,paginator:M,loadWorkflows:r}=ce(),{handleDeleteWorkflow:j}=fe(),D=async p=>{var _;const{scrollTop:i,scrollHeight:n,clientHeight:W}=p.target;if(i+W>=n-10){if(v.value)return;await r(String(((_=a.query)==null?void 0:_.search_word)??""),"")}};return Y(async()=>{var p;await r(((p=a.query)==null?void 0:p.search_word)??"","",!0)}),I(()=>l.createType,p=>{p==="workflow"&&(x.value="",b.value=!0,g("update-create-type",""))}),I(()=>{var p;return(p=a.query)==null?void 0:p.search_word},async()=>{var p;return await r(((p=a.query)==null?void 0:p.search_word)??"","",!0)}),(p,i)=>{const n=s("a-avatar"),W=s("icon-check-circle-fill"),_=s("router-link"),z=s("icon-more"),k=s("a-button"),q=s("a-doption"),V=s("a-dropdown"),B=s("icon-user"),N=s("a-card"),$=s("a-col"),m=s("a-empty"),R=s("a-row"),T=s("a-spin"),P=s("a-space");return y(),C(T,{loading:d(v),class:"block h-full w-full scrollbar-w-none overflow-scroll",onScroll:D},{default:o(()=>[t(R,{gutter:[20,20],class:"flex-1"},{default:o(()=>[(y(!0),ee(ae,null,te(d(h),c=>(y(),C($,{key:c.id,span:6},{default:o(()=>[t(N,{hoverable:"",class:"cursor-pointer rounded-lg"},{default:o(()=>[f("div",ke,[t(n,{size:40,shape:"square","image-url":c.icon},null,8,["image-url"]),f("div",ye,[f("div",be,[t(_,{to:{name:"space-workflows-detail",params:{workflow_id:c.id}},class:"text-base text-gray-900 font-bold"},{default:o(()=>[F(L(c.name)+" ",1),c.status==="published"?(y(),C(W,{key:0,class:"text-green-700"})):H("",!0)]),_:2},1032,["to"]),f("div",xe,L(c.tool_call_name)+" · "+L(c.node_count)+" 节点数 ",1)]),t(V,{position:"br"},{content:o(()=>[t(q,{onClick:()=>{x.value=c.id,b.value=!0}},{default:o(()=>i[2]||(i[2]=[F(" 编辑工作流 ")])),_:2},1032,["onClick"]),t(q,{class:"text-red-700",onClick:async()=>await d(j)(c.id,async()=>{var S;await d(r)(String(((S=d(a).query)==null?void 0:S.search_word)??""),"",!0)})},{default:o(()=>i[3]||(i[3]=[F(" 删除 ")])),_:2},1032,["onClick"])]),default:o(()=>[t(k,{type:"text",size:"small",class:"rounded-lg !text-gray-700"},{icon:o(()=>[t(z)]),_:1})]),_:2},1024)])]),f("div",he,L(c.description),1),f("div",We,[t(n,{size:18,class:"bg-blue-700"},{default:o(()=>[t(B)]),_:1}),f("div",qe,L(d(U).account.name)+" · 最近编辑 "+L(d(J)(c.created_at*1e3).format("MM-DD HH:mm")),1)])]),_:2},1024)]),_:2},1024))),128)),d(h).length===0?(y(),C($,{key:0,span:24},{default:o(()=>[t(m,{description:"没有可用的工作流",class:"h-[400px] flex flex-col items-center justify-center"})]),_:1})):H("",!0)]),_:1}),d(M).total_page>=2?(y(),C(R,{key:0},{default:o(()=>[d(M).current_page<=d(M).total_page?(y(),C($,{key:0,span:24,align:"center"},{default:o(()=>[t(P,{class:"my-4"},{default:o(()=>[t(T),i[4]||(i[4]=f("div",{class:"text-gray-400"},"加载中",-1))]),_:1})]),_:1})):(y(),C($,{key:1,span:24,align:"center"},{default:o(()=>i[5]||(i[5]=[f("div",{class:"text-gray-400 my-4"},"数据已加载完成",-1)])),_:1}))]),_:1})):H("",!0),t(ve,{visible:b.value,"onUpdate:visible":i[0]||(i[0]=c=>b.value=c),workflow_id:x.value,"onUpdate:workflow_id":i[1]||(i[1]=c=>x.value=c),callback:async()=>{var c;return await d(r)(((c=d(a).query)==null?void 0:c.search_word)??"","",!0)}},null,8,["visible","workflow_id","callback"])]),_:1},8,["loading"])}}});export{Ue as default};
