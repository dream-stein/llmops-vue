import{s as le,p as U,g as oe,r as c,M as $,d as ie,u as ue,o as ce,n as re,c as m,a as n,b as g,e as D,f as i,w as _,h as N,i as ge,j as T,F as O,k as G,l as ve,v as de,m as pe,q as he,Q as B,t as fe,x as y,y as A,z as _e}from"./index-CN7x7Znw.js";import{u as ye,s as xe,_ as me,a as Ae,b as we}from"./AiMessage.vue_vue_type_script_setup_true_lang-DRNtL79O.js";const be=(a,u=[],s)=>le("/assistant-agent/chat",{body:{query:a,image_urls:u}},s),ke=a=>U(`/assistant-agent/chat/${a}/stop`),Ce=a=>oe("/assistant-agent/messages",{params:a}),Se=()=>U("/assistant-agent/delete-conversation"),Le=()=>{const a=c(!1);return{loading:a,handleAssistantAgentChat:async(s,w=[],o)=>{try{a.value=!0,await be(s,w,o)}finally{a.value=!1}}}},Me=()=>{const a=c(!1);return{loading:a,handleStopAssistantAgentChat:async s=>{try{a.value=!0,await ke(s)}finally{a.value=!1}}}},Ie=()=>{const a=c(!1),u=c([]),s=c(0),w={current_page:1,page_size:5,total_page:0,total_record:0},o=c({...w});return{loading:a,messages:u,paginator:o,loadAssistantAgentMessages:async(h=!1)=>{var v;if(h)o.value={...w},s.value=0;else if(o.value.current_page>o.value.total_page)return;try{a.value=!0;const k=(await Ce({current_page:o.value.current_page,page_size:o.value.page_size,created_at:s.value})).data;o.value=k.paginator,o.value.current_page<=o.value.total_page&&(o.value.current_page+=1),h?u.value=k.list:(u.value.push(...k.list),s.value=((v=k.list[0])==null?void 0:v.created_at)??0)}finally{a.value=!1}}}},ze=()=>{const a=c(!1);return{loading:a,handleDeleteAssistantAgentConversation:async()=>{try{a.value=!0;const s=await Se();$.success(s.message)}finally{a.value=!1}}}},$e="/llmops-vue/assets/assistant-agent-background-Jf_uHUnU.png",qe={class:"w-[600px] h-full min-h-screen mx-auto"},Te={class:"flex flex-col gap-6 py-6"},Be={key:0,class:"h-[50px] flex items-center justify-center"},He={class:"flex gap-2"},Qe={class:"flex flex-col items-start gap-2"},Ve={class:"bg-white border border-gray-200 text-gray-700 px-4 py-3 rounded-2xl break-all leading-7"},De={class:"list-disc pl-6"},Fe={class:"flex flex-col gap-2"},Pe=["onClick"],je={class:"w-full flex flex-col flex-shrink-0"},Ne={class:"px-6 flex items-center gap-4"},Oe={key:0,class:"flex items-center gap-2"},Ge={class:"hidden group-hover:flex items-center justify-center bg-gray-700/50 w-10 h-10 absolute top-0"},Ue={class:"flex items-center gap-2"},Ke=ie({__name:"HomeView",setup(a){const u=c(""),s=c([]),w=c(null),o=c(!1),b=c(""),h=c(""),v=c(null),H=c(0),k=ue(),W=["什么是LLMOps?","我想创建一个应用","能介绍下什么是RAG吗?"],{suggested_questions:F,handleGenerateSuggestedQuestions:E}=ye(),{loading:L,handleAssistantAgentChat:K}=Le(),{loading:J,handleStopAssistantAgentChat:R}=Me(),{loading:X,messages:d,loadAssistantAgentMessages:Q}=Ie(),{loading:Y,handleDeleteAssistantAgentConversation:Z}=ze(),ee=()=>{H.value=v.value.$el.scrollHeight},te=()=>{v.value.$el.scrollTop=v.value.$el.scrollHeight-H.value},se=async p=>{const{scrollTop:t}=p.target;t<=0&&!X.value&&(ee(),await Q(!1),te())},V=async()=>{if(u.value.trim()===""){$.warning("用户提问不能为空");return}if(L.value){$.warning("上一次提问还未结束，请稍等");return}F.value=[],h.value="",b.value="",d.value.unshift({id:"",conversation_id:"",query:u.value,image_urls:s.value,answer:"",total_token_count:0,latency:0,agent_thoughts:[],created_at:0});let p=0;const t=u.value,C=s.value;u.value="",s.value=[],await K(t,C,r=>{var q;const x=r==null?void 0:r.event,e=r==null?void 0:r.data,M=e==null?void 0:e.id,f=d.value[0].agent_thoughts;if(h.value===""&&(e!=null&&e.message_id)&&(b.value=e==null?void 0:e.task_id,h.value=e==null?void 0:e.message_id,d.value[0].id=e==null?void 0:e.message_id,d.value[0].conversation_id=e==null?void 0:e.conversation_id),x!==B.ping){if(x===B.agentMessage){const S=f.findIndex(I=>(I==null?void 0:I.id)===M);S===-1?(p+=1,f.push({id:M,position:p,event:e==null?void 0:e.event,thought:e==null?void 0:e.thought,observation:e==null?void 0:e.observation,tool:e==null?void 0:e.tool,tool_input:e==null?void 0:e.tool_input,latency:e==null?void 0:e.latency,created_at:0})):f[S]={...f[S],thought:((q=f[S])==null?void 0:q.thought)+(e==null?void 0:e.thought),latency:e==null?void 0:e.latency},d.value[0].answer+=e==null?void 0:e.thought,d.value[0].latency=e==null?void 0:e.latency,d.value[0].total_token_count=e==null?void 0:e.total_token_count}else x===B.error?d.value[0].answer=e==null?void 0:e.observation:x===B.timeout?d.value[0].answer="当前Agent执行已超时，无法得到答案，请重试":(p+=1,f.push({id:M,position:p,event:e==null?void 0:e.event,thought:e==null?void 0:e.thought,observation:e==null?void 0:e.observation,tool:e==null?void 0:e.tool,tool_input:e==null?void 0:e.tool_input,latency:e==null?void 0:e.latency,created_at:0}));d.value[0].agent_thoughts=f,v.value.scrollToBottom()}}),h.value&&(await E(h.value),setTimeout(()=>v.value&&v.value.scrollToBottom(),100))},P=async()=>{b.value===""||!L.value||await R(b.value)},j=async p=>{u.value=p,await V()},ne=()=>{if(s.value.length>5){$.error("对话上传图片数量不能超过5张");return}w.value.click()},ae=async p=>{var r;if(o.value)return;const C=(r=p.target.files)==null?void 0:r[0];if(C)try{o.value=!0;const x=await fe(C);s.value.push(x.data.image_url),$.success("上传图片成功")}finally{o.value=!1}};return ce(async()=>{await Q(!0),await re(()=>{v.value&&v.value.scrollToBottom()})}),(p,t)=>{const C=y("icon-poweroff"),r=y("a-button"),x=y("icon-apps"),e=y("a-avatar"),M=y("router-link"),f=y("icon-empty"),q=y("icon-close"),S=y("icon-plus"),I=y("icon-send");return A(),m("div",{class:"w-full h-full min-h-screen bg-gray-100 bg-cover bg-no-repeat bg-center",style:he({backgroundImage:`url(${g($e)})`})},[n("div",qe,[g(d).length>0?(A(),m("div",{key:0,class:D(`flex flex-col px-6 ${s.value.length>0?"h-[calc(100%-150px)] min-h-[calc(100vh-150px)]":"h-[calc(100%-100px)] min-h-[calc(100vh-100px)]"}`)},[i(g(we),{ref_key:"scroller",ref:v,items:g(d).slice().reverse(),"min-item-size":1,onScroll:se,class:"h-full scrollbar-w-none"},{default:_(({item:l,active:z})=>[i(g(xe),{item:l,active:z,"data-index":l.id},{default:_(()=>[n("div",Te,[i(me,{query:l.query,image_urls:l.image_urls,account:g(k).account},null,8,["query","image_urls","account"]),i(Ae,{message_id:l.id,agent_thoughts:l.agent_thoughts,answer:l.answer,app:{name:"辅助Agent"},suggested_questions:l.id===h.value?g(F):[],loading:l.id===h.value&&g(L),latency:l.latency,total_token_count:l.total_token_count,message_class:"bg-white",onSelectSuggestedQuestion:j},null,8,["message_id","agent_thoughts","answer","suggested_questions","loading","latency","total_token_count"])])]),_:2},1032,["item","active","data-index"])]),_:1},8,["items"]),b.value&&g(L)?(A(),m("div",Be,[i(r,{loading:g(J),class:"rounded-lg px-2",onClick:P},{icon:_(()=>[i(C)]),default:_(()=>[t[2]||(t[2]=T(" 停止响应 "))]),_:1},8,["loading"])])):N("",!0)],2)):(A(),m("div",{key:1,class:D(`flex flex-col p-6 gap-2 items-center justify-center overflow-scroll scrollbar-w-none ${s.value.length>0?"h-[calc(100%-150px)] min-h-[calc(100vh-150px)]":"h-[calc(100%-100px)] min-h-[calc(100vh-100px)]"}`)},[t[12]||(t[12]=ge('<div class="mb-9"><div class="text-[40px] font-bold text-gray-700 mt-[52px] mb-4"> Hi，我是 AI 应用构建器 </div><div class="text-[30px] font-bold text-gray-700 mb-2"> 你的专属 <span class="text-blue-700">AI 原生应用</span> 开发平台 </div><div class="text-base text-gray-700"> 说出你的创意，我可以快速帮你创建专属应用，一键轻松分享给朋友，也可以一键发布到 LLMOps 平台、微信等多个渠道。 </div></div>',1)),n("div",He,[i(e,{size:30,shape:"circle",class:"flex-shrink-0 bg-blue-700"},{default:_(()=>[i(x)]),_:1}),n("div",Qe,[t[11]||(t[11]=n("div",{class:"text-gray-700 font-bold"},"辅助Agent",-1)),n("div",Ve,[t[8]||(t[8]=n("div",{class:"font-bold"},"你好，欢迎来到LLMOps🎉",-1)),t[9]||(t[9]=n("div",{class:""}," LLMOps是新一代大模型 AI 应用开发平台。无论你是否有编程基础，都可以快速搭建出各种 AI 应用，并一键发布到各大社交平台，或者轻松部署到自己的网站。 ",-1)),n("ul",De,[n("li",null,[t[4]||(t[4]=T(" 随时来 ")),i(M,{to:{name:"store-apps-list"},class:"text-blue-700"},{default:_(()=>t[3]||(t[3]=[T("应用广场 ")])),_:1}),t[5]||(t[5]=T(" 逛逛，这里内置了许多超有趣的应用。 "))]),t[6]||(t[6]=n("li",null,"你也可以直接发送“我想做一个应用”，我可以帮你快速创建应用。",-1)),t[7]||(t[7]=n("li",null,"你也可以向我提问有关课程的问题，我可以快速替你解答。",-1))]),t[10]||(t[10]=n("div",{class:""},"如果你还有其他LLMOps使用问题，也欢迎随时问我！",-1))]),n("div",Fe,[(A(),m(O,null,G(W,(l,z)=>n("div",{key:z,class:"px-4 py-1.5 border rounded-lg text-gray-700 cursor-pointer bg-white hover:bg-gray-50",onClick:async()=>await j(l)},_e(l),9,Pe)),64))])])])],2)),n("div",je,[n("div",Ne,[i(r,{loading:g(Y),class:"flex-shrink-0 !text-gray-700",type:"text",shape:"circle",onClick:t[0]||(t[0]=async()=>{await P(),await g(Z)(),await g(Q)(!0)})},{icon:_(()=>[i(f,{size:16})]),_:1},8,["loading"]),n("div",{class:D(`bg-white ${s.value.length>0?"h-[100px]":"h-[50px]"} flex flex-col justify-center gap-2 px-4 flex-1 border border-gray-200 rounded-[24px]`)},[s.value.length>0?(A(),m("div",Oe,[(A(!0),m(O,null,G(s.value,(l,z)=>(A(),m("div",{key:l,class:"w-10 h-10 relative rounded-lg overflow-hidden group cursor-pointer"},[i(e,{shape:"square","image-url":l},null,8,["image-url"]),n("div",Ge,[i(q,{class:"text-white",onClick:()=>s.value.splice(z,1)},null,8,["onClick"])])]))),128))])):N("",!0),n("div",Ue,[ve(n("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>u.value=l),type:"text",class:"flex-1 outline-0",placeholder:"发送消息或创建AI应用...",onKeyup:pe(V,["enter"])},null,544),[[de,u.value]]),n("input",{type:"file",ref_key:"fileInput",ref:w,accept:"image/*",onChange:ae,class:"hidden"},null,544),i(r,{loading:o.value,size:"mini",type:"text",shape:"circle",class:"!text-gray-700",onClick:ne},{icon:_(()=>[i(S)]),_:1},8,["loading"]),i(r,{loading:g(L),size:"mini",type:"text",shape:"circle",class:"!text-gray-700",onClick:V},{icon:_(()=>[i(I,{size:16})]),_:1},8,["loading"])])],2)]),t[13]||(t[13]=n("div",{class:"text-center text-gray-500 text-xs py-4"}," 内容由AI生成，无法确保真实准确，仅供参考。 ",-1))])])],4)}}});export{Ke as default};
