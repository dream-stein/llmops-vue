import{d as de,p as F,b as w,q as ce,m as pe,e as ue,o as n,c as y,w as o,j as _e,r,h as a,f as g,n as z,g as e,t as i,u as j,F as A,i as b,a as S,s as me,M as fe,v as D}from"./index-6IK5CKk4.js";import{v as ge,g as he,a as ye,d as ve,c as xe,u as be}from"./api-tools-D0ArQvgi.js";import{m as we}from"./moment-BCTLnUIF.js";const ke={class:"flex items-center gap-3 mb-3"},Ve={class:"flex flex-col"},Ce={class:"text-base text-gray-900 font-bold"},ze={class:"text-xs text-gray-500 line-clamp-1"},Ae={class:"leading-[18px] text-gray-500 h-[72px] line-clamp-4 mb-2"},Se={class:"flex items-center gap-1.5"},qe={class:"text-xs text-gray-400"},Te={key:0,class:""},Pe={class:"flex items-center gap-3 mb-3"},Me={class:"flex flex-col"},Ue={class:"text-base text-gray-900 font-bold"},Ie={class:"text-xs text-gray-500 line-clamp-1"},Oe={class:"leading-[18px] text-gray-500 mb-4"},Be={class:"flex flex-col gap-2"},Fe={class:"text-xs text-gray-500"},je={class:"font-bold text-gray-900 mb-2"},De={class:"text-gray-500 text-xs"},Re={key:0,class:""},$e={class:"flex flex-col gap-4"},He={class:"flex items-center gap-2 text-xs"},Ne={class:"text-gray-900 font-bold"},Le={class:"text-gray-500"},Ee={key:0,class:"text-red-700"},Je={class:"text-xs text-gray-500"},Qe={class:"flex items-center justify-between"},We={class:"text-lg font-bold text-gray-700"},Ge={class:"pt-6"},Ke={class:"rounded-lg border border-gray-200 w-full overflow-x-auto"},Ye={class:"w-full leading-[18px] text-xs text-gray-700 font-normal"},Xe={class:"p-2 pl-3"},Ze={class:"p-2 pl-3 w-[236px]"},et={class:"p-2 pl-3"},tt={class:"p-2 pl-3 w-[62px]"},at={class:"rounded-lg border border-gray-200 w-full overflow-x-auto"},st={class:"w-full leading-[18px] text-xs text-gray-700 font-normal mb-3"},ot={key:0,class:"border-b border-gray-200"},lt={class:"p-2 pl-3"},nt={class:"p-2 pl-3"},rt={class:"p-2 pl-3"},it={class:"flex items-center justify-between"},dt={class:""},_t=de({__name:"ListView",props:{createType:{type:String,required:!0}},emits:["update-create-type"],setup(E,{emit:J}){const R=_e(),M=E,Q=J,u=F([]),c=F({current_page:1,page_size:20,total_page:0,total_record:0}),p=F({icon:"https://picsum.photos/400",name:"",openapi_schema:"",headers:[]}),U=w(),_=w(-1),q=w(!1),k=w(!1),I=w(!1),O=w(!1),W=ce(()=>{try{const l=[],t=JSON.parse(p.openapi_schema);if("paths"in t){for(const m in t.paths)for(const d in t.paths[m])if(["get","post"].includes(d)){const h=t.paths[m][d];"operationId"in h&&"description"in h&&l.push({name:h==null?void 0:h.operationId,description:h==null?void 0:h.description,method:d,path:m})}}return l}catch(l){console.log("解析openapi_schema出错"+l)}return[]}),$=async(l=!1)=>{var t;if(!(!l&&c.current_page>c.total_page))try{q.value=!0;const d=(await he(c.current_page,c.page_size,String(((t=R.query)==null?void 0:t.search_word)??""))).data;c.current_page=d.paginator.current_page,c.page_size=d.paginator.page_size,c.total_page=d.paginator.total_page,c.total_record=d.paginator.total_record,c.current_page<=c.total_page&&(c.current_page+=1),l?u.splice(0,u.length,...d.list):u.push(...d.list)}finally{Object.assign(u,[{id:"46db30d1-3199-4e79-a0cd-abf12fa6858f",name:"高德地图",icon:"https://cdn.imooc.com/gaode.png",description:"查询ip所在地、天气预报、路线规划等搞得工具包",tools:[{id:"d400cec0-892f-49ab-8f72-821b88c1aaa9",description:"根据传递的城市名获取制定城市的天气预报、例如：广州",name:"GetCurrentWeather",inputs:[{type:"str",required:!0,name:"query",description:"需要搜素的查询语句"}]}],headers:[{key:"Authorization",value:"Bearer QQYnRerJTSEcrf889fw8prOaOberch8"}],created_at:1721460914}]),q.value=!1}},T=()=>{c.current_page=1,c.page_size=20,c.total_page=0,c.total_record=0,$(!0)},G=l=>{const{scrollTop:t,scrollHeight:m,clientHeight:d}=l.target;if(t+d>=m-10){if(q.value)return;$()}},K=async()=>{var l;try{I.value=!0;const t=u[_.value].id,d=(await ye(t)).data;(l=U.value)==null||l.resetFields(),p.icon=d.icon,p.name=d.name,p.openapi_schema=d.openapi_schema,p.headers=d.headers}finally{I.value=!1}k.value=!0},Y=()=>{fe.warning({title:"删除这个工具?",content:"删除工具是不可逆的。AI应用将无法再访问您的工具",hideCancel:!1,onOk:async()=>{try{const l=u[_.value].id,t=await ve(l);D.success(t.message)}finally{V(),_.value=-1,await T()}}})},X=async({values:l,errors:t})=>{if(!t){try{if(O.value=!0,M.createType==="tool"){const m=await xe(l);D.success(m.message)}else if(k.value){const m=await be(u[_.value].id,l);D.success(m.message)}V(),_.value=-1}finally{O.value=!1}await T()}},V=()=>{var l;(l=U.value)==null||l.resetFields(),Q("update-create-type",""),k.value=!1};return pe(async()=>{await T()}),ue(()=>{var l;return(l=R.query)==null?void 0:l.search_word},async()=>{await T()}),(l,t)=>{const m=r("a-avatar"),d=r("icon-user"),h=r("a-card"),P=r("a-col"),Z=r("a-empty"),H=r("a-row"),N=r("a-spin"),L=r("a-space"),ee=r("icon-settings"),v=r("a-button"),te=r("a-drawer"),ae=r("icon-close"),se=r("a-upload"),x=r("a-form-item"),B=r("a-input"),oe=r("a-textarea"),le=r("icon-delete"),ne=r("icon-plus"),re=r("a-form"),ie=r("a-modal");return n(),y(N,{loading:q.value,class:"block h-full w-full scrollbar-w-none overflow-scroll",onScroll:G},{default:o(()=>[a(H,{gutter:[20,20],class:"flex-1"},{default:o(()=>[(n(!0),g(A,null,z(u,(s,f)=>(n(),y(P,{key:s.name,span:6},{default:o(()=>[a(h,{hoverable:"",class:"cursor-pointer rounded-lg",onClick:C=>_.value=f},{default:o(()=>[e("div",ke,[a(m,{size:40,shape:"square","image-url":s.icon},null,8,["image-url"]),e("div",Ve,[e("div",Ce,i(s.name),1),e("div",ze," 提供商 "+i(s.name)+" · "+i(s.tools.length)+" 插件 ",1)])]),e("div",Ae,i(s.description),1),e("div",Se,[a(m,{size:18,class:"bg-blue-700"},{default:o(()=>[a(d)]),_:1}),e("div",qe," 慕小课 · 编辑时间 "+i(j(we)(s.created_at).format("MM-DD HH:mm")),1)])]),_:2},1032,["onClick"])]),_:2},1024))),128)),u.length===0?(n(),y(P,{key:0,span:24},{default:o(()=>[a(Z,{description:"没有可用的API插件",class:"h-[400px] flex flex-col items-center justify-center"})]),_:1})):b("",!0)]),_:1}),c.total_page>2?(n(),y(H,{key:0},{default:o(()=>[c.current_page<=c.total_page?(n(),y(P,{key:0,span:24,align:"center"},{default:o(()=>[a(L,{class:"my-4"},{default:o(()=>[a(N),t[6]||(t[6]=e("div",{class:"text-gray-400"},"加载中",-1))]),_:1})]),_:1})):(n(),y(P,{key:1,span:24,align:"center"},{default:o(()=>t[7]||(t[7]=[e("div",{class:"text-gray-400 my-4"},"数据已加载完成",-1)])),_:1}))]),_:1})):b("",!0),a(te,{visible:_.value!=-1,width:350,footer:!1,title:"工具详情","drawer-style":{background:"#F9FAFB"},onCancel:t[0]||(t[0]=s=>_.value=-1)},{default:o(()=>[_.value!=-1?(n(),g("div",Te,[e("div",Pe,[a(m,{size:40,shape:"square","image-url":u[_.value].icon},null,8,["image-url"]),e("div",Me,[e("div",Ue,i(u[_.value].name),1),e("div",Ie," 提供商 "+i(u[_.value].name)+" · "+i(u[_.value].tools.length)+" 插件 ",1)])]),e("div",Oe,i(u[_.value].description),1),a(v,{loading:I.value,type:"dashed",long:"",class:"mb-2 rounded-lg",onClick:K},{icon:o(()=>[a(ee)]),default:o(()=>[t[8]||(t[8]=S(" 编辑工具 "))]),_:1},8,["loading"]),t[10]||(t[10]=e("hr",{class:"my-4"},null,-1)),e("div",Be,[e("div",Fe,"包含 "+i(u[_.value].tools.length)+" 个工具",1),(n(!0),g(A,null,z(u[_.value].tools,s=>(n(),y(h,{key:s.name,class:"cursor-pointer flex flex-col rounded-xl"},{default:o(()=>[e("div",je,i(s.name),1),e("div",De,i(s.description),1),s.inputs.length>0?(n(),g("div",Re,[t[9]||(t[9]=e("div",{class:"flex items-center gap-2 my-4"},[e("div",{class:"text-xs font-bold text-gray-500"},"参数"),e("hr",{class:"flex-1"})],-1)),e("div",$e,[(n(!0),g(A,null,z(s.inputs,f=>(n(),g("div",{key:f.name,class:"flex flex-col gap-2"},[e("div",He,[e("div",Ne,i(f.name),1),e("div",Le,i(j(me)[f.type]),1),f.required?(n(),g("div",Ee,"必填")):b("",!0)]),e("div",Je,i(f.description),1)]))),128))])])):b("",!0)]),_:2},1024))),128))])])):b("",!0)]),_:1},8,["visible"]),a(ie,{width:630,visible:M.createType==="tool"||k.value,"hide-title":"",footer:!1,"modal-class":"rounded-xl",onCancel:V},{default:o(()=>[e("div",Qe,[e("div",We,i(M.createType==="tool"?"新建":"更新")+"插件 ",1),a(v,{type:"text",class:"!text-gray-700",size:"small",onClick:V},{icon:o(()=>[a(ae)]),_:1})]),e("div",Ge,[a(re,{ref_key:"formRef",ref:U,model:p,onSubmit:X,layout:"vertical"},{default:o(()=>[a(x,{field:"icon","hide-label":"",rules:[{required:!0,message:"插件图标不能为空"}]},{default:o(()=>[a(se,{modelValue:p.icon,"onUpdate:modelValue":t[1]||(t[1]=s=>p.icon=s),limit:1,"list-type":"picture-card",accept:"image/png, image/jpeg",class:"!w-auto mx-auto"},null,8,["modelValue"])]),_:1}),a(x,{field:"name",label:"插件名称","asterisk-position":"end",rules:[{required:!0,message:"插件名称不能为空"}]},{default:o(()=>[a(B,{modelValue:p.name,"onUpdate:modelValue":t[2]||(t[2]=s=>p.name=s),placeholder:"请输入插件名称，确保名称含义清晰","show-word-limit":"","max-length":60},null,8,["modelValue"])]),_:1}),a(x,{field:"openapi_schema",label:"OpenAPI Schema","asterisk-position":"end",rules:[{required:!0,message:"OpenAPI Schema不能为空"}]},{default:o(()=>[a(oe,{modelValue:p.openapi_schema,"onUpdate:modelValue":t[3]||(t[3]=s=>p.openapi_schema=s),"auto-size":{minRows:4,maxRows:6},placeholder:"在此处输入您的 OpenAPI Schema",onBlur:t[4]||(t[4]=async()=>{p.openapi_schema.trim()!==""&&await j(ge)(p.openapi_schema)})},null,8,["modelValue"])]),_:1}),a(x,{label:"可用工具"},{default:o(()=>[e("div",Ke,[e("table",Ye,[t[11]||(t[11]=e("thead",{class:"text-gray-500"},[e("tr",{class:"border-b border-gray-200"},[e("th",{class:"p-2 pl-3 font-medium"},"名称"),e("th",{class:"p-2 pl-3 font-medium w-[236px]"},"描述"),e("th",{class:"p-2 pl-3 font-medium"},"方法"),e("th",{class:"p-2 pl-3 font-medium"},"路径")])],-1)),e("tbody",null,[(n(!0),g(A,null,z(W.value,(s,f)=>(n(),g("tr",{key:f,class:"border-b last:border-0 border-gray-200 text-gray-700"},[e("td",Xe,i(s.name),1),e("td",Ze,i(s.description),1),e("td",et,i(s.method),1),e("td",tt,i(s.path),1)]))),128))])])])]),_:1}),a(x,{label:"Headers"},{default:o(()=>[e("div",at,[e("table",st,[t[12]||(t[12]=e("thead",{class:"text-gray-500"},[e("tr",{class:"border-b border-gray-200"},[e("th",{class:"p-2 pl-3 font-medium"},"Key"),e("th",{class:"p-2 pl-3 font-medium"},"Value"),e("th",{class:"p-2 pl-3 font-medium w-[50px]"},"操作")])],-1)),p.headers.length>0?(n(),g("tbody",ot,[(n(!0),g(A,null,z(p.headers,(s,f)=>(n(),g("tr",{key:f,class:"border-b last:border-0 border-gray-200"},[e("td",lt,[a(x,{field:`headers[${f}].key`,"hide-label":"",class:"m-0"},{default:o(()=>[a(B,{modelValue:s.key,"onUpdate:modelValue":C=>s.key=C,placeholder:"请输入请求头键名"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["field"])]),e("td",nt,[a(x,{field:`headers[${f}].value`,"hide-label":"",class:"m-0"},{default:o(()=>[a(B,{modelValue:s.value,"onUpdate:modelValue":C=>s.value=C,placeholder:"请输入请求头键值内容"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["field"])]),e("td",rt,[a(v,{size:"mini",type:"text",class:"!text-gray-700",onClick:C=>p.headers.splice(f,1)},{icon:o(()=>[a(le)]),_:2},1032,["onClick"])])]))),128))])):b("",!0)]),a(v,{size:"mini",class:"rounded ml-3 mb-3 !text-gray-700",onClick:t[5]||(t[5]=s=>p.headers.push({key:"",value:""}))},{icon:o(()=>[a(ne)]),default:o(()=>[t[13]||(t[13]=S(" 增加参数 "))]),_:1})])]),_:1}),e("div",it,[e("div",dt,[k.value?(n(),y(v,{key:0,class:"rounded-lg !text-red-700",onClick:Y},{default:o(()=>t[14]||(t[14]=[S(" 删除 ")])),_:1})):b("",!0)]),a(L,{size:16},{default:o(()=>[a(v,{class:"rounded-lg",onClick:V},{default:o(()=>t[15]||(t[15]=[S("取消")])),_:1}),a(v,{loading:O.value,type:"primary","html-type":"submit",class:"rounded-lg"},{default:o(()=>t[16]||(t[16]=[S(" 保存 ")])),_:1},8,["loading"])]),_:1})])]),_:1},8,["model"])])]),_:1},8,["visible"])]),_:1},8,["loading"])}}});export{_t as default};
