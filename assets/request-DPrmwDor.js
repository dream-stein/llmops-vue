import{v as p}from"./index-BvuoEs5u.js";const l="http://127.0.0.1:8080",g={success:0,fail:1,notFound:2,unauthorized:3,forbidden:4,validateError:5},E={str:"字符串",int:"整型",float:"浮点型",bool:"布尔值"},y=1e5,b={method:"GET",mode:"cors",credentials:"include",headers:new Headers({"Content-Type":"application/json"}),redirect:"follow"},T=(t,e)=>{const s=Object.assign({},b,e);let r=`${l}${t.startsWith("/")?t:`/${t}`}`;const{method:d,params:a,body:h}=s;if(d==="GET"&&a){const n=[];Object.keys(a).forEach(o=>{n.push(`${o}=${encodeURIComponent(a[o])}`)}),r.search(/\?/)===-1?r+=`?${n.join("&")}`:r+=`&${n.join("&")}`,delete s.params}return h&&(s.body=JSON.stringify(h)),Promise.race([new Promise((n,o)=>{setTimeout(()=>{o("接口已超时")},y)}),new Promise((n,o)=>{globalThis.fetch(r,s).then(async f=>{const c=await f.json();c.code===g.success?n(c):(p.error(c.message),o(new Error(c.message)))}).catch(f=>{p.error(f.message),o(f)})})])},$=async(t,e,s)=>{const r=Object.assign({},b,{method:"POST"},e),d=`${l}${t.startsWith("/")?t:`/${t}`}`,{body:a}=e;a&&(r.body=JSON.stringify(a));const h=await globalThis.fetch(d,r);return O(h,s)},O=(t,e)=>{var h;if(!t.ok)throw new Error("网络请求失败");const s=(h=t.body)==null?void 0:h.getReader(),r=new TextDecoder("utf-8");let d="";const a=()=>{let n=!1;s==null||s.read().then(o=>{if(o.done)return;d+=r.decode(o.value,{stream:!0});const f=d.split(`
`);let c="",m="";try{f.forEach(i=>{i=i.trim(),i.startsWith("event:")?c=i.slice(6).trim():i.startsWith("data:")&&(m=i.slice(5).trim()),i===""&&c!==""&&m!==""&&(e({event:c,data:JSON.parse(m)}),c="",m="")}),d=f.pop()||""}catch{n=!0}n||a()})};a()},u=(t,e={})=>T(t,e),j=(t,e={})=>u(t,Object.assign({},e,{method:"GET"})),P=(t,e={})=>u(t,Object.assign({},e,{method:"POST"}));export{j as g,P as p,$ as s,E as t};
