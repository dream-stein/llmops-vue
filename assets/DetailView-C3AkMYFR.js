import{d as ae,r as D,c as f,a as t,e,w as o,b as g,q as l,t as n,x as T,z as J,i as U,f as Q,k as Qe,v as Ne,M as ce,O as at,P as be,C as Ce,F as te,j as oe,n as we,y as ge,H as ue,o as qe,D as it,R as Ee,u as rt,l as dt,A as Ke,Q as Fe,g as Je}from"./index-D503A2vZ.js";import{j as pe,k as ut,l as ct,m as pt,n as _t,o as gt,p as mt,q as ft}from"./use-app-BR4DAObj.js";import{c as vt,u as xt,s as yt,_ as bt,a as ht,b as wt}from"./AiMessage.vue_vue_type_script_setup_true_lang-Xy1pNqcx.js";import{l as ne}from"./lodash-CxrCcN65.js";import{u as kt}from"./use-dataset-CkJoIsbZ.js";import{f as $t,a as Ct}from"./use-tools-4nU8EBE2.js";import{g as qt,b as zt,a as Dt}from"./builtin-tool-CQd8FWKo.js";import{c as St}from"./use-workflow-DghrOElW.js";import"./dataset-MFFtwZh4.js";const Ut={class:"flex flex-col h-[calc(100vh-173px)]"},Tt={class:"flex items-center justify-between px-4 mb-4"},At={class:"flex flex-col"},Mt={key:0,class:"mb-4 flex flex-col"},jt={class:"max-h-[321px] overflow-scroll scrollbar-w-none mb-2 text-gray-700 whitespace-pre-line"},Bt={class:""},Lt={class:"h-[50px] flex items-center gap-2 px-4 flex-1 border border-gray-200 rounded-full"},Pt={class:"flex-1"},It=ae({__name:"PresetPromptTextarea",props:{app_id:{type:String,required:!0},preset_prompt:{type:String,default:"",required:!0}},emits:["update:preset_prompt"],setup(_,{emit:h}){const i=_,y=h,d=D(!1),q=D(""),{handleUpdateDraftAppConfig:a}=pe(),{loading:C,optimize_prompt:v,handleOptimizePrompt:k}=vt(),M=()=>{if(v.value.trim()===""){ce.warning("优化prompt为空，请重新生成");return}y("update:preset_prompt",v.value),a(i.app_id,{preset_prompt:v.value}),d.value=!1},A=async()=>{if(q.value.trim()===""){ce.warning("原始prompt不能为空");return}await k(q.value)};return(b,w)=>{const m=l("icon-sync"),x=l("a-button"),B=l("a-space"),H=l("icon-send"),V=l("a-card"),R=l("a-trigger"),$=l("a-textarea");return n(),f("div",Ut,[t("div",Tt,[w[8]||(w[8]=t("div",{class:"text-gray-700 font-bold"},"人设与回复逻辑",-1)),e(R,{"popup-visible":d.value,"onUpdate:popupVisible":w[2]||(w[2]=u=>d.value=u),trigger:["click"],position:"bl","popup-translate":[0,8]},{content:o(()=>[e(V,{class:"rounded-lg w-[422px]"},{default:o(()=>[t("div",At,[g(v)?(n(),f("div",Mt,[t("div",jt,T(g(v)),1),g(C)?Q("",!0):(n(),J(B,{key:0},{default:o(()=>[e(x,{size:"small",type:"primary",class:"rounded-lg",onClick:M},{default:o(()=>w[6]||(w[6]=[U(" 替换 ")])),_:1}),e(x,{size:"small",class:"rounded-lg",onClick:w[0]||(w[0]=u=>d.value=!1)},{default:o(()=>w[7]||(w[7]=[U(" 退出 ")])),_:1})]),_:1}))])):Q("",!0),t("div",Bt,[t("div",Lt,[Qe(t("input",{"onUpdate:modelValue":w[1]||(w[1]=u=>q.value=u),type:"text",class:"flex-1 outline-0",placeholder:"你希望如何编写或优化提示词"},null,512),[[Ne,q.value]]),e(x,{loading:g(C),type:"text",shape:"circle",onClick:A},{icon:o(()=>[e(H,{size:16,class:"!text-blue-700"})]),_:1},8,["loading"])])])])]),_:1})]),default:o(()=>[e(x,{size:"mini",class:"rounded-lg px-2"},{icon:o(()=>[e(m)]),default:o(()=>[w[5]||(w[5]=U(" 优化 "))]),_:1})]),_:1},8,["popup-visible"])]),t("div",Pt,[e($,{class:"h-full resize-none !bg-transparent !border-0 text-gray-700 px-1 preset-prompt-textarea",placeholder:"请在这里输入Agent的人设与回复逻辑(预设prompt)","max-length":2e3,"show-word-limit":"","model-value":i.preset_prompt,"onUpdate:modelValue":w[3]||(w[3]=u=>y("update:preset_prompt",u)),onBlur:w[4]||(w[4]=async()=>{await g(a)(i.app_id,{preset_prompt:i.preset_prompt})})},null,8,["model-value"])])])}}}),Rt={class:""},Gt={class:"flex items-center justify-between border-b h-[64px] px-4"},Ot={class:"flex items-center justify-between"},Wt={class:"pt-6"},Ht={class:"flex items-center justify-between"},Et=ae({__name:"PreviewDebugHeader",props:{app_id:{type:String,required:!0},long_term_memory:{type:Object,required:!0}},setup(_){const h=_,{debug_conversation_summary:i,loadDebugConversationSummary:y}=ut(),{loading:d,handleUpdateDebugConversationSummary:q}=ct(),a=D(!1),C=async()=>{await y(h.app_id),a.value=!0};return(v,k)=>{var B;const M=l("icon-save"),A=l("a-button"),b=l("icon-close"),w=l("a-textarea"),m=l("a-space"),x=l("a-modal");return n(),f("div",Rt,[t("div",Gt,[k[6]||(k[6]=t("div",{class:"text-lg text-gray-700"},"预览与调试",-1)),e(A,{disabled:!((B=h.long_term_memory)!=null&&B.enable),size:"mini",type:"text",class:"rounded-lg px-1 !text-blue-700",onClick:C},{icon:o(()=>[e(M)]),default:o(()=>[k[5]||(k[5]=U(" 长期记忆 "))]),_:1},8,["disabled"])]),e(x,{width:520,visible:a.value,"onUpdate:visible":k[4]||(k[4]=H=>a.value=H),"hide-title":"",footer:!1,"modal-class":"rounded-xl"},{default:o(()=>[t("div",Ot,[k[7]||(k[7]=t("div",{class:"text-lg font-bold text-gray-700"},"长期记忆",-1)),e(A,{type:"text",class:"!text-gray-700",size:"small",onClick:k[0]||(k[0]=H=>a.value=!1)},{icon:o(()=>[e(b)]),_:1})]),t("div",Wt,[e(w,{"model-value":g(i),"onUpdate:modelValue":k[1]||(k[1]=H=>at(i)?i.value=H:null),placeholder:"请输入当前调试会话长期记忆","show-word-limit":"","max-length":2e3,"auto-size":{minRows:8,maxRows:8}},null,8,["model-value"]),t("div",Ht,[k[10]||(k[10]=t("div",{class:""},null,-1)),e(m,{size:16},{default:o(()=>[e(A,{class:"rounded-lg",onClick:k[2]||(k[2]=H=>a.value=!1)},{default:o(()=>k[8]||(k[8]=[U("取消")])),_:1}),e(A,{loading:g(d),type:"primary",class:"rounded-lg",onClick:k[3]||(k[3]=async()=>{await g(q)(h.app_id,g(i)),a.value=!1})},{default:o(()=>k[9]||(k[9]=[U(" 保存 ")])),_:1},8,["loading"])]),_:1})])])]),_:1},8,["visible"])])}}}),Ft={class:""},Qt=ae({__name:"LongTermMemoryAbilityItem",props:{app_id:{type:String,default:"",required:!0},long_term_memory:{type:Object,default:{enable:!1},required:!0}},emits:["update:long_term_memory"],setup(_,{emit:h}){const i=_,y=h,{handleUpdateDraftAppConfig:d}=pe();return(q,a)=>{const C=l("icon-down"),v=l("a-button"),k=l("a-doption"),M=l("a-dropdown"),A=l("a-collapse-item");return n(),f("div",Ft,[e(A,{key:"long_term_memory",class:"app-ability-item"},{header:o(()=>a[2]||(a[2]=[t("div",{class:"text-gray-700 font-bold"},"长期记忆",-1)])),extra:o(()=>[e(M,{onSelect:a[1]||(a[1]=async b=>{var w;!!b!==((w=i.long_term_memory)==null?void 0:w.enable)&&(y("update:long_term_memory",{enable:!!b}),await g(d)(i.app_id,{long_term_memory:{enable:!!b}}))})},{content:o(()=>[e(k,{value:1,class:"text-xs py-1.5 text-gray-700"},{default:o(()=>a[3]||(a[3]=[U("开启")])),_:1}),e(k,{value:0,class:"text-xs py-1.5 text-red-700"},{default:o(()=>a[4]||(a[4]=[U("关闭")])),_:1})]),default:o(()=>[e(v,{size:"mini",class:"rounded-lg flex items-center gap-1 px-1",onClick:a[0]||(a[0]=be(()=>{},["stop"]))},{default:o(()=>{var b;return[U(T((b=i.long_term_memory)!=null&&b.enable?"开启":"关闭")+" ",1),e(C)]}),_:1})]),_:1})]),default:o(()=>[a[5]||(a[5]=t("div",{class:"text-xs text-gray-500 leading-[22px]"}," 总结聊天对话内容，并用于更好的响应用户的信息 ",-1))]),_:1})])}}}),Nt={class:""},Kt={class:"text-xs text-gray-500"},Jt={class:"flex flex-col gap-2 mb-2"},Vt={class:"flex items-center gap-2"},Xt={class:"flex flex-col gap-2 mb-2"},Yt={class:"flex items-center gap-2"},Zt={class:"flex flex-col gap-2"},eo=ae({__name:"OpeningAbilityItem",props:{app_id:{type:String,default:"",required:!0},opening_statement:{type:String,default:"",required:!0},opening_questions:{type:Array,default:[],required:!0}},emits:["update:opening_statement","update:opening_questions"],setup(_,{emit:h}){const i=_,y=h,{handleUpdateDraftAppConfig:d}=pe(),q=Ce({get(){const C=[...i.opening_questions];return C.length<3&&C[C.length-1]!==""&&C.push(""),C},set(C){y("update:opening_questions",C)}}),a=async()=>{await d(i.app_id,{opening_questions:q.value.filter(C=>C.trim()!=="")})};return(C,v)=>{const k=l("icon-exclamation-circle"),M=l("a-tooltip"),A=l("a-textarea"),b=l("a-input"),w=l("icon-delete"),m=l("a-button"),x=l("a-collapse-item");return n(),f("div",Nt,[e(x,{key:"opening",class:"app-ability-item"},{header:o(()=>v[3]||(v[3]=[t("div",{class:"text-gray-700 font-bold"},"对话开场白",-1)])),default:o(()=>[t("div",Kt,[t("div",Jt,[t("div",Vt,[v[4]||(v[4]=t("div",{class:"text-gray-700"},"开场白文案",-1)),e(M,{content:"开场白是与Agent应用对话时，Agent默认展示的对话。"},{default:o(()=>[e(k)]),_:1})]),e(A,{"model-value":i.opening_statement,"onUpdate:modelValue":v[0]||(v[0]=B=>y("update:opening_statement",B)),placeholder:"在此处填写 AI 应用的开场白",class:"bg-white text-gray-700 rounded-lg border border-gray-200","auto-size":{minRows:4,maxRows:4},onBlur:v[1]||(v[1]=async()=>{await g(d)(i.app_id,{opening_statement:i.opening_statement})})},null,8,["model-value"])]),t("div",Xt,[t("div",Yt,[v[5]||(v[5]=t("div",{class:"text-gray-700"},"开场白预设问题",-1)),e(M,{content:"开场白预设问题是与Agent对话时，初始化提供的建议问题，最多不超过3个"},{default:o(()=>[e(k)]),_:1})]),t("div",Zt,[(n(!0),f(te,null,oe(q.value,(B,H)=>(n(),f("div",{key:H,class:"flex items-center gap-2"},[e(b,{"model-value":B,"onUpdate:modelValue":V=>{const R=[...q.value];R[H]=V,q.value=R},class:"rounded-lg bg-white",placeholder:"输入开场白引导问题",onBlur:v[2]||(v[2]=async()=>await a())},null,8,["model-value","onUpdate:modelValue"]),e(m,{class:"rounded-lg",onClick:async()=>{const V=[...q.value];V.splice(H,1),y("update:opening_questions",V),await we(),await a()}},{icon:o(()=>[e(w)]),_:2},1032,["onClick"])]))),128))])])])]),_:1})])}}}),to={class:""},oo=ae({__name:"SuggestedAfterAnswerAbilityItem",props:{app_id:{type:String,default:"",required:!0},suggested_after_answer:{type:Object,default:{enable:!1},required:!0}},emits:["update:suggested_after_answer"],setup(_,{emit:h}){const i=_,y=h,{handleUpdateDraftAppConfig:d}=pe();return(q,a)=>{const C=l("icon-down"),v=l("a-button"),k=l("a-doption"),M=l("a-dropdown"),A=l("a-collapse-item");return n(),f("div",to,[e(A,{key:"suggested_after_answer",class:"app-ability-item"},{header:o(()=>a[2]||(a[2]=[t("div",{class:"text-gray-700 font-bold"},"用户问题建议",-1)])),extra:o(()=>[e(M,{onSelect:a[1]||(a[1]=async b=>{var w;!!b!==((w=i.suggested_after_answer)==null?void 0:w.enable)&&(y("update:suggested_after_answer",{enable:!!b}),await g(d)(i.app_id,{suggested_after_answer:{enable:!!b}}))})},{content:o(()=>[e(k,{value:1,class:"text-xs py-1.5 text-gray-700"},{default:o(()=>a[3]||(a[3]=[U("开启")])),_:1}),e(k,{value:0,class:"text-xs py-1.5 text-red-700"},{default:o(()=>a[4]||(a[4]=[U("关闭")])),_:1})]),default:o(()=>[e(v,{size:"mini",class:"rounded-lg flex items-center gap-1 px-1",onClick:a[0]||(a[0]=be(()=>{},["stop"]))},{default:o(()=>{var b;return[U(T((b=i.suggested_after_answer)!=null&&b.enable?"开启":"关闭")+" ",1),e(C)]}),_:1})]),_:1})]),default:o(()=>[a[5]||(a[5]=t("div",{class:"text-xs text-gray-500 leading-[22px]"}," 在应用回复后，自动根据对话内容提供 3 条用户提问建议 ",-1))]),_:1})])}}}),lo={class:""},so={class:"group py-2"},no={class:"flex items-center justify-between"},ao={class:"py-4"},io={class:"flex flex-col gap-5"},ro={class:"flex flex-col gap-2"},uo={class:"flex flex-col gap-2 p-3 bg-gray-50 border border-gray-200 rounded-lg"},co={class:"flex items-center justify-between"},po={class:"flex flex-col gap-2"},_o={class:"flex flex-col p-3 bg-gray-50 border border-gray-200 rounded-lg"},go={class:"flex items-center justify-between"},mo={class:"flex items-center justify-between"},fo=ae({__name:"ReviewConfigAbilityItem",props:{app_id:{type:String,default:"",required:!0},review_config:{type:Object,default:{},required:!0}},setup(_){var A,b,w,m,x,B,H,V,R;const h=_,{loading:i,handleUpdateDraftAppConfig:y}=pe(),d=D(!1),q=D(!1),a=D({enable:(A=h.review_config)==null?void 0:A.enable,keywords:(w=(b=h.review_config)==null?void 0:b.keywords)==null?void 0:w.join(`
`),inputs_config:{enable:(x=(m=h.review_config)==null?void 0:m.inputs_config)==null?void 0:x.enable,preset_response:(H=(B=h.review_config)==null?void 0:B.inputs_config)==null?void 0:H.preset_response},outputs_config:{enable:(R=(V=h.review_config)==null?void 0:V.outputs_config)==null?void 0:R.enable}}),C=D({...ne.cloneDeep(a.value)}),v=()=>ne.isEqual(C.value,a.value),k=()=>{q.value=!1,a.value=ne.cloneDeep(C.value)},M=async()=>{try{await y(h.app_id,{review_config:{enable:a.value.enable,keywords:a.value.keywords.split(/\r?\n/).filter($=>$.trim()!==""),inputs_config:a.value.inputs_config,outputs_config:a.value.outputs_config}}),C.value=ne.cloneDeep(a.value),await we(),k()}catch{}};return ge(()=>h.review_config,$=>{(!d.value||!v())&&$&&Object.keys($).length>0&&(a.value=ne.cloneDeep({...$,keywords:$==null?void 0:$.keywords.join(`
`)}),C.value=ne.cloneDeep({...$,keywords:$==null?void 0:$.keywords.join(`
`)}),d.value=!0)},{immediate:!0,deep:!0}),($,u)=>{const I=l("icon-down"),Z=l("a-button"),N=l("a-doption"),le=l("a-dropdown"),S=l("icon-settings"),r=l("a-collapse-item"),p=l("icon-close"),G=l("a-textarea"),E=l("a-switch"),ee=l("a-space"),se=l("a-modal");return n(),f("div",lo,[e(r,{key:"review_config",class:"app-ability-item review-config-ability-item"},{header:o(()=>u[7]||(u[7]=[t("div",{class:"text-gray-700 font-bold"},"内容审查",-1)])),extra:o(()=>[e(le,{onSelect:u[1]||(u[1]=async s=>{if(!!s!==a.value.enable)try{a.value.enable=!!s,await we(),await M()}catch{}})},{content:o(()=>[e(N,{value:1,class:"text-xs py-1.5 text-gray-700"},{default:o(()=>u[8]||(u[8]=[U("开启")])),_:1}),e(N,{value:0,class:"text-xs py-1.5 text-red-700"},{default:o(()=>u[9]||(u[9]=[U("关闭")])),_:1})]),default:o(()=>[e(Z,{size:"mini",class:"rounded-lg flex items-center gap-1 px-1",onClick:u[0]||(u[0]=be(()=>{},["stop"]))},{default:o(()=>[U(T(a.value.enable?"开启":"关闭")+" ",1),e(I)]),_:1})]),_:1})]),default:o(()=>[t("div",so,[u[11]||(u[11]=t("div",{class:"text-xs text-gray-500 leading-[22px] group-hover:hidden"}," 对用户输入以及大语言模型输出内容进行审查。 ",-1)),e(Z,{size:"small",long:"",class:"hidden group-hover:block rounded-lg transition-all",onClick:u[2]||(u[2]=s=>q.value=!0)},{icon:o(()=>[e(S)]),default:o(()=>[u[10]||(u[10]=U(" 设置 "))]),_:1})])]),_:1}),e(se,{visible:q.value,"hide-title":"",footer:!1,"modal-class":"rounded-xl",onCancel:k},{default:o(()=>[t("div",no,[u[12]||(u[12]=t("div",{class:"text-lg font-bold text-gray-700"},"内容审核",-1)),e(Z,{type:"text",class:"!text-gray-700",size:"small",onClick:k},{icon:o(()=>[e(p)]),_:1})]),t("div",ao,[t("div",io,[t("div",ro,[u[13]||(u[13]=t("div",{class:"flex flex-col"},[t("div",{class:"flex items-center gap-1 text-gray-700"},[U(" 关键词 "),t("div",{class:"text-red-700"},"*")]),t("div",{class:"text-gray-500 text-xs"},"每行一个，用换行符分割，最多填写100个关键词")],-1)),e(G,{"model-value":a.value.keywords,"onUpdate:modelValue":u[3]||(u[3]=s=>a.value.keywords=s),class:"bg-white rounded-lg border border-gray-200",placeholder:"每行一个，用换行符分隔。","max-length":100,"show-word-limit":"","auto-size":{minRows:4,maxRows:4},"word-length":s=>s.trim()===""?0:s.split(/\r?\n/).length,"word-slice":(s,Y)=>s.split(/\r?\n/).slice(0,Y).join(`
`)},null,8,["model-value","word-length","word-slice"])]),t("div",uo,[t("div",co,[u[14]||(u[14]=t("div",{class:"text-gray-700"},"输入审查内容",-1)),e(E,{"model-value":a.value.inputs_config.enable,"onUpdate:modelValue":u[4]||(u[4]=s=>a.value.inputs_config.enable=s),size:"small",type:"round","checked-color":"#10b981","unchecked-color":"#556581"},null,8,["model-value"])]),t("div",po,[u[15]||(u[15]=t("div",{class:"text-gray-700 text-xs"},"预设回复",-1)),e(G,{"model-value":a.value.inputs_config.preset_response,"onUpdate:modelValue":u[5]||(u[5]=s=>a.value.inputs_config.preset_response=s),placeholder:"这里是预设回复内容",class:"bg-white rounded-lg border border-gray-200","auto-size":{minRows:3,maxRows:3}},null,8,["model-value"])])]),t("div",_o,[t("div",go,[u[16]||(u[16]=t("div",{class:"text-gray-700"},"输出审查内容",-1)),e(E,{"model-value":a.value.outputs_config.enable,"onUpdate:modelValue":u[6]||(u[6]=s=>a.value.outputs_config.enable=s),size:"small",type:"round","checked-color":"#10b981","unchecked-color":"#556581"},null,8,["model-value"])])])])]),t("div",mo,[u[19]||(u[19]=t("div",{class:""},null,-1)),e(ee,{size:16},{default:o(()=>[e(Z,{class:"rounded-lg",onClick:k},{default:o(()=>u[17]||(u[17]=[U("取消")])),_:1}),e(Z,{loading:g(i),type:"primary",class:"rounded-lg",onClick:M},{default:o(()=>u[18]||(u[18]=[U(" 保存 ")])),_:1},8,["loading"])]),_:1})])]),_:1},8,["visible"])])}}}),vo={class:""},xo={key:0,class:""},yo={key:1,class:""},bo={key:2,class:""},ho={key:0,class:"flex flex-col gap-1"},wo={class:"flex items-center gap-2"},ko={class:"flex flex-col flex-1 gap-1 h-9"},$o={class:"text-gray-700 font-bold leading-[18px] line-clamp-1 break-all"},Co={class:"text-gray-500 text-xs line-clamp-1 break-all"},qo={key:1,class:"text-xs text-gray-500 leading-[22px]"},zo={class:"flex items-center justify-between mb-6"},Do={class:"h-[calc(100vh-180px)] mb-4 overflow-scroll scrollbar-w-none"},So={class:"flex flex-col gap-2"},Uo=["onClick"],To={class:"line-clamp-1 text-gray-500 flex-1"},Ao={class:"flex items-center justify-between"},Mo={class:""},jo={class:"flex items-center justify-between"},Bo={class:"flex items-center gap-4 w-full pl-3"},Lo={class:"flex items-center gap-4 w-full pl-3"},Po={class:"flex items-center justify-between"},Io=ae({__name:"DatasetsAbilityItem",props:{app_id:{type:String,default:"",required:!0},retrieval_config:{type:Object,default:{},required:!0},datasets:{type:Array,default:[],required:!0}},emits:["update:datasets","update:retrieval_config"],setup(_,{emit:h}){const i=_,y=h,{loading:d,handleUpdateDraftAppConfig:q}=pe(),{loading:a,paginator:C,datasets:v,loadDatasets:k}=kt(),M=D(!1),A=D(!1),b=D(!1),w=D([]),m=D([]),x=D({}),B=D({}),H=D(!1),V=async S=>{const{scrollTop:r,scrollHeight:p,clientHeight:G}=S.target;if(r+G>=p-10){if(a.value)return;await k()}},R=()=>ne.isEqual(w.value,m.value),$=()=>ne.isEqual(x.value,B.value),u=()=>{M.value=!1,w.value=m.value,b.value=!1},I=()=>{A.value=!1,x.value=B.value,H.value=!1},Z=S=>{const r=v[S];if(w.value.some(p=>p.id===r.id))w.value=w.value.filter(p=>p.id!==r.id);else{if(w.value.length>=5){ce.warning("关联知识库已超过5个，无法继续关联");return}w.value.push({id:r.id,name:r.name,icon:r.icon,description:r.description})}},N=async()=>{try{await q(i.app_id,{datasets:w.value.map(S=>S.id)}),m.value=w.value,await we(),y("update:datasets",w.value),u()}catch(S){ce.error(S.message)}},le=async()=>{try{await q(i.app_id,{retrieval_config:x.value}),B.value=x.value,y("update:retrieval_config",x.value),I()}catch(S){ce.error(S.message)}};return ge(()=>i.datasets,S=>{if((!b.value||!R())&&S&&S.length>0){const r=i.datasets.map(p=>({id:p.id,name:p.name,icon:p.icon,description:p.description}));w.value=ne.cloneDeep(r),m.value=ne.cloneDeep(r),b.value=!0}},{immediate:!0,deep:!0}),ge(()=>i.retrieval_config,S=>{(!H.value||!$())&&S&&Object.keys(S).length>0&&(x.value={...S},B.value={...S},H.value=!0)},{immediate:!0,deep:!0}),ge(()=>M.value,async S=>{S?await k(!0):v.splice(0,v.length)}),(S,r)=>{const p=l("icon-language"),G=l("a-button"),E=l("icon-plus"),ee=l("a-space"),se=l("a-avatar"),s=l("icon-delete"),Y=l("a-collapse-item"),X=l("icon-close"),j=l("a-empty"),L=l("a-spin"),c=l("a-col"),O=l("a-row"),z=l("a-modal"),W=l("a-radio-group"),me=l("a-form-item"),fe=l("a-slider"),ve=l("a-input-number"),ke=l("a-form");return n(),f("div",vo,[e(Y,{key:"datasets",class:"app-ability-item"},{header:o(()=>r[7]||(r[7]=[t("div",{class:"text-gray-700 font-bold"},"知识库",-1)])),extra:o(()=>[e(ee,null,{default:o(()=>[e(G,{size:"mini",class:"rounded-lg px-2",onClick:r[0]||(r[0]=be(F=>A.value=!0,["stop"]))},{icon:o(()=>[e(p)]),default:o(()=>{var F,_e;return[((F=_.retrieval_config)==null?void 0:F.retrieval_strategy)==="semantic"?(n(),f("div",xo," 相似度检索 ")):((_e=_.retrieval_config)==null?void 0:_e.retrieval_strategy)==="full_text"?(n(),f("div",yo," 全文检索 ")):(n(),f("div",bo,"混合检索"))]}),_:1}),e(G,{size:"mini",type:"text",class:"!text-gray-700",onClick:r[1]||(r[1]=be(F=>M.value=!0,["stop"]))},{icon:o(()=>[e(E)]),_:1})]),_:1})]),default:o(()=>[i.datasets.length>0?(n(),f("div",ho,[(n(!0),f(te,null,oe(i.datasets,(F,_e)=>(n(),f("div",{key:F.id,class:"flex items-center justify-between bg-white p-3 rounded-lg cursor-pointer hover:shadow-sm group"},[t("div",wo,[e(se,{size:36,shape:"square",class:"rounded flex-shrink-0","image-url":F.icon},null,8,["image-url"]),t("div",ko,[t("div",$o,T(F.name),1),t("div",Co,T(F.description),1)])]),e(G,{size:"mini",type:"text",class:"hidden group-hover:block flex-shrink-0 ml-2 !text-red-700 rounded",onClick:async()=>{const xe=[...i.datasets];xe.splice(_e,1),await g(q)(i.app_id,{datasets:xe.map($e=>$e.id)}),b.value=!1,y("update:datasets",xe)}},{icon:o(()=>[e(s)]),_:2},1032,["onClick"])]))),128))])):(n(),f("div",qo," 引用文本类型的数据，实现知识问答，应用最多支持关联 5 个知识库。 "))]),_:1}),e(z,{visible:M.value,"hide-title":"",footer:!1,width:400,class:"datasets-modal","modal-class":"h-[calc(100vh-32px)] right-4",onCancel:u},{default:o(()=>[t("div",zo,[r[8]||(r[8]=t("div",{class:"text-lg font-bold text-gray-700"},"选择引用知识库",-1)),e(G,{type:"text",class:"!text-gray-700",size:"small",onClick:u},{icon:o(()=>[e(X)]),_:1})]),t("div",Do,[e(L,{loading:g(a),class:"block h-full scrollbar-w-none overflow-scroll",onScroll:V},{default:o(()=>[t("div",So,[(n(!0),f(te,null,oe(g(v),(F,_e)=>(n(),f("div",{key:F.id,class:ue(`flex items-center gap-2 border px-3 py-2 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-700 ${w.value.some(xe=>xe.id===F.id)?"bg-blue-50 border-blue-700":""}`),onClick:()=>Z(_e)},[e(se,{size:24,shape:"square",class:"flex-shrink-0 rounded","image-url":F.icon},null,8,["image-url"]),t("div",To,T(F.name),1)],10,Uo))),128)),g(v).length===0?(n(),J(j,{key:0,description:"没有可用知识库",class:"h-[400px] flex flex-col items-center justify-center"})):Q("",!0)]),g(C).total_page>=2?(n(),J(O,{key:0},{default:o(()=>[g(C).current_page<=g(C).total_page?(n(),J(c,{key:0,span:24,class:"!text-center"},{default:o(()=>[e(ee,{class:"my-4"},{default:o(()=>[e(L),r[9]||(r[9]=t("div",{class:"text-gray-400"},"加载中",-1))]),_:1})]),_:1})):(n(),J(c,{key:1,span:24,class:"!text-center"},{default:o(()=>r[10]||(r[10]=[t("div",{class:"text-gray-400 my-4"},"数据已加载完成",-1)])),_:1}))]),_:1})):Q("",!0)]),_:1},8,["loading"])]),t("div",Ao,[t("div",Mo,T(w.value.length)+"个知识库被选中",1),e(ee,{size:12},{default:o(()=>[e(G,{class:"rounded-lg",onClick:u},{default:o(()=>r[11]||(r[11]=[U("取消")])),_:1}),e(G,{loading:g(d),type:"primary",class:"rounded-lg",onClick:N},{default:o(()=>r[12]||(r[12]=[U(" 添加 ")])),_:1},8,["loading"])]),_:1})])]),_:1},8,["visible"]),e(z,{visible:A.value,"hide-title":"",footer:!1,"modal-class":"rounded-xl",onCancel:I},{default:o(()=>[t("div",jo,[r[13]||(r[13]=t("div",{class:"text-lg font-bold text-gray-700"},"检索设置",-1)),e(G,{type:"text",class:"!text-gray-700",size:"small",onClick:I},{icon:o(()=>[e(X)]),_:1})]),e(ke,{model:x.value,onSubmit:le,class:"pt-6"},{default:o(()=>[e(me,{field:"retrieval_strategy",label:"检索策略","label-align":"left"},{default:o(()=>[e(W,{"model-value":x.value.retrieval_strategy,"onUpdate:modelValue":r[2]||(r[2]=F=>x.value.retrieval_strategy=F),"default-value":"semantic",options:[{label:"混合策略",value:"hybrid"},{label:"全文检索",value:"full_text"},{label:"相似性检索",value:"semantic"}]},null,8,["model-value"])]),_:1}),e(me,{field:"k",label:"最大召回数量"},{default:o(()=>[t("div",Bo,[e(fe,{"model-value":x.value.k,"onUpdate:modelValue":r[3]||(r[3]=F=>x.value.k=F),step:1,min:1,max:10},null,8,["model-value"]),e(ve,{"model-value":x.value.k,"onUpdate:modelValue":r[4]||(r[4]=F=>x.value.k=F),class:"w-[80px]","default-value":4},null,8,["model-value"])])]),_:1}),e(me,{field:"score",label:"最小匹配度"},{default:o(()=>[t("div",Lo,[e(fe,{"model-value":x.value.score,"onUpdate:modelValue":r[5]||(r[5]=F=>x.value.score=F),step:.01,min:0,max:.99},null,8,["model-value"]),e(ve,{"model-value":x.value.score,"onUpdate:modelValue":r[6]||(r[6]=F=>x.value.score=F),class:"w-[80px]",min:0,max:.99,step:.01,precision:2,"default-value":.5},null,8,["model-value"])])]),_:1}),t("div",Po,[r[16]||(r[16]=t("div",{class:""},null,-1)),e(ee,{size:16},{default:o(()=>[e(G,{class:"rounded-lg",onClick:I},{default:o(()=>r[14]||(r[14]=[U("取消")])),_:1}),e(G,{loading:g(d),type:"primary","html-type":"submit",class:"rounded-lg"},{default:o(()=>r[15]||(r[15]=[U("保存")])),_:1},8,["loading"])]),_:1})])]),_:1},8,["model"])]),_:1},8,["visible"])])}}}),Ro=()=>{const _=D(!1),h=D([]);return{loading:_,categories:h,loadCategories:async()=>{try{_.value=!0;const y=await qt();h.value=y.data}finally{_.value=!1}}}},Go=()=>{const _=D(!1),h=D({});return{loading:_,builtin_tool:h,loadBuiltinTool:async(y,d)=>{try{_.value=!0;const q=await zt(y,d);h.value=q.data}finally{_.value=!1}}}},Oo=()=>{const _=D(!1),h=D([]);return{loading:_,builtin_tools:h,loadBuiltinTools:async()=>{try{_.value=!0;const y=await Dt();h.value=y.data}finally{_.value=!1}}}},Wo={class:""},Ho={key:0,class:"flex flex-col gap-1"},Eo={class:"flex items-center gap-2"},Fo={class:"flex flex-col gap-1 h-9"},Qo={class:"text-gray-700 font-bold leading-[18px] line-clamp-1 break-all"},No={class:"text-gray-500 text-xs line-clamp-1 break-all"},Ko={class:"hidden group-hover:flex items-center gap-1 flex-shrink-0 ml-2"},Jo={key:1,class:"text-xs text-gray-500 leading-[22px]"},Vo={class:"flex items-center justify-between mb-6"},Xo={class:"flex items-center"},Yo={class:"flex items-center gap-2"},Zo={class:"text-gray-700 font-bold max-w-[200px] line-clamp-1 break-all"},el={class:"mx-4 text-gray-400"},tl={class:"flex items-center gap-6"},ol={key:0,class:"h-[calc(100vh-170px)] pb-4 overflow-scroll scrollbar-w-none"},ll={class:"text-gray-500 text-xs"},sl={key:0,class:""},nl={class:"flex flex-col gap-4"},al={class:"flex items-center gap-2 text-xs"},il={class:"text-gray-900 font-bold"},rl={class:"text-gray-500"},dl={key:0,class:"text-red-700"},ul={class:"text-xs text-gray-500"},cl={key:1,class:"h-[calc(100vh-170px)] pb-4 overflow-scroll scrollbar-w-none"},pl={class:"flex items-center gap-1"},_l={class:"text-gray-700"},gl={key:0,class:"text-red-700"},ml={class:"flex items-center justify-between"},fl={class:"flex w-full h-full"},vl={class:"flex flex-col flex-shrink-0 bg-gray-50 w-[200px] h-full px-3 py-4 overflow-scroll scrollbar-w-none"},xl={class:"flex flex-col gap-1 mb-4"},yl={key:0,class:""},bl={class:"flex flex-col gap-1"},hl=["onClick"],wl=["innerHTML"],kl={class:"flex-1 p-4"},$l={class:"w-full flex items-center justify-between gap-2 mb-7"},Cl={class:"text-lg font-bold text-gray-700"},ql={key:0,class:"h-[calc(100vh-130px)] overflow-scroll scrollbar-w-none"},zl={class:"text-gray-900"},Dl={class:"flex flex-col gap-1"},Sl={class:"flex items-center gap-2"},Ul={class:"text-gray-900"},Tl={key:0,class:""},Al={key:1},Ml={class:"text-gray-900"},jl={class:"flex flex-col gap-1"},Bl={class:"flex items-center gap-2"},Ll={class:"text-gray-900"},Pl={key:0,class:""},Il=ae({__name:"ToolsAbilityItem",props:{app_id:{type:String,default:"",required:!0},tools:{type:Array,default:[],required:!0}},emits:["update:tools"],setup(_,{emit:h}){const i=_,y=h,{loading:d,handleUpdateDraftAppConfig:q}=pe(),{loading:a,api_tool:C,loadApiTool:v}=$t(),{loading:k,paginator:M,api_tool_providers:A,loadApiToolProviders:b}=Ct(),{loading:w,builtin_tool:m,loadBuiltinTool:x}=Go(),{categories:B,loadCategories:H}=Ro(),{builtin_tools:V,loadBuiltinTools:R}=Oo(),$=D(!1),u=D("info"),I=D({}),Z=D(-1),N=D({}),le=D(!1),S=D("api_tool"),r=D("all"),p=Ce(()=>r.value==="all"?V.value:V.value.filter(L=>L.category===r.value)),G=async L=>{if(L===-1)return;Z.value=L;const c=i.tools[L];c.type==="builtin_tool"?(await x(c.provider.name,c.tool.name),I.value={type:"builtin_tool",provider:{id:m.value.provider.name,icon:m.value.provider.icon,name:m.value.provider.name,label:m.value.provider.label,description:m.value.provider.description},tool:{id:m.value.name,name:m.value.name,label:m.value.label,description:m.value.description,inputs:m.value.inputs,params:m.value.params}}):(await v(c.provider.id,c.tool.name),I.value={type:"api_tool",provider:{id:C.value.provider.id,icon:C.value.provider.icon,name:C.value.provider.name,label:C.value.provider.name,description:C.value.provider.description},tool:{id:C.value.name,name:C.value.name,label:C.value.name,description:C.value.description,inputs:m.value.inputs,params:[]}});const O=c.tool.params;I.value.tool.params.forEach(z=>{N.value[z.name]=O[z.name]??z.default}),$.value=!0},E=()=>{Z.value=-1,$.value=!1,u.value="info"},ee=async()=>{if(i.tools[Z.value].type==="api_tool"){E();return}const c=[...i.tools];c[Z.value].tool.params=N.value,await q(i.app_id,{tools:c.map(O=>({type:O.type,params:O.tool.params,provider_id:O.provider.id,tool_id:O.tool.name}))}),y("update:tools",c),E()},se=async L=>{const c=[...i.tools];c.splice(L,1),await q(i.app_id,{tools:c.map(O=>({type:O.type,params:O.tool.params,provider_id:O.provider.id,tool_id:O.tool.name}))}),y("update:tools",c)},s=async()=>{le.value=!0,await b(!0),await R()},Y=async L=>{const{scrollTop:c,scrollHeight:O,clientHeight:z}=L.target;if(c+z>=O-10){if(k.value)return;await b()}},X=async(L,c)=>{let O={};if(S.value==="api_tool"){const z=A.value[L],W=z.tools[c];O={type:"api_tool",provider:{id:z.id,name:z.name,label:z.name,icon:z.icon,description:z.description},tool:{id:W.name,name:W.name,label:W.name,description:W.description,params:{}}}}else{const z=p.value[L],W=z.tools[c],me=W.params;O={type:"builtin_tool",provider:{id:z.name,name:z.name,label:z.label,icon:`${Ee}/builtin-tools/${z.name}/icon`,description:z.description},tool:{id:W.name,name:W.name,label:W.label,description:W.description,params:me.reduce((fe,ve)=>(fe[ve.name]=ve.default,fe),{})}}}if(i.tools.some(z=>z.provider.id===O.provider.id&&z.tool.name===O.tool.name)){const z=[...i.tools].filter(W=>W.provider.id!==O.provider.id&&W.tool.name!==O.tool.name);await q(i.app_id,{tools:z.map(W=>({type:W.type,params:W.tool.params,provider_id:W.provider.id,tool_id:W.tool.name}))}),y("update:tools",z);return}else{if(i.tools.length>=5){ce.warning("一个Agent应用最多关联5个扩展插件");return}const z=[...i.tools];z.push(O),await q(i.app_id,{tools:z.map(W=>({type:W.type,params:W.tool.params,provider_id:W.provider.id,tool_id:W.tool.name}))}),y("update:tools",z)}},j=(L,c)=>i.tools.some(O=>O.provider.name===L.name&&O.tool.name===c.name);return qe(()=>{H()}),(L,c)=>{const O=l("icon-plus"),z=l("a-button"),W=l("a-avatar"),me=l("icon-settings"),fe=l("icon-delete"),ve=l("a-collapse-item"),ke=l("icon-oblique-line"),F=l("icon-close"),_e=l("icon-info-circle"),xe=l("a-tooltip"),$e=l("a-select"),Ve=l("a-input"),Xe=l("a-input-number"),ze=l("a-radio"),Ye=l("a-radio-group"),Ze=l("a-form-item"),et=l("a-form"),De=l("a-space"),Se=l("a-modal"),tt=l("router-link"),ot=l("icon-code"),lt=l("icon-translate"),st=l("icon-apps"),Ue=l("a-empty"),Te=l("a-spin"),Ae=l("a-col"),nt=l("a-row");return n(),f("div",Wo,[e(ve,{key:"tools",class:"app-ability-item"},{header:o(()=>c[7]||(c[7]=[t("div",{class:"text-gray-700 font-bold"},"扩展插件",-1)])),extra:o(()=>[e(z,{size:"mini",type:"text",class:"!text-gray-700",onClick:be(s,["stop"])},{icon:o(()=>[e(O)]),_:1})]),default:o(()=>[i.tools.length>0?(n(),f("div",Ho,[(n(!0),f(te,null,oe(i.tools,(P,de)=>(n(),f("div",{key:de,class:"flex items-center justify-between bg-white p-3 rounded-lg cursor-pointer hover:shadow-sm group"},[t("div",Eo,[e(W,{size:36,shape:"square",class:"rounded flex-shrink-0","image-url":P.provider.icon},null,8,["image-url"]),t("div",Fo,[t("div",Qo,T(P.provider.label)+" / "+T(P.tool.label),1),t("div",No,T(P.tool.description),1)])]),t("div",Ko,[e(z,{loading:g(a)||g(w),size:"mini",type:"text",class:"!text-gray-700 rounded",onClick:async()=>await G(de)},{icon:o(()=>[e(me)]),_:2},1032,["loading","onClick"]),e(z,{loading:g(d),size:"mini",type:"text",class:"!text-red-700 rounded",onClick:async()=>await se(de)},{icon:o(()=>[e(fe)]),_:2},1032,["loading","onClick"])])]))),128))])):(n(),f("div",Jo," 插件能够让智能体调用外部 API，例如搜索信息、浏览网页、生成图片等，扩展智能体的能力和使用场景。 "))]),_:1}),e(Se,{visible:$.value,"hide-title":"",footer:!1,class:"tool-setting-modal","modal-class":"h-[calc(100vh-32px)] right-4",onCancel:E},{default:o(()=>{var P,de,ie,he,Me,je,Be,Le,Pe,Ie,Re,Ge,Oe,We;return[t("div",Vo,[t("div",Xo,[t("div",Yo,[e(W,{size:24,shape:"circle","image-url":(de=(P=I.value)==null?void 0:P.provider)==null?void 0:de.icon},null,8,["image-url"]),t("div",Zo,T((he=(ie=I.value)==null?void 0:ie.tool)==null?void 0:he.label),1)]),t("div",el,[e(ke,{size:12})]),t("div",tl,[t("div",{class:ue(`text-gray-700 pt-1 cursor-pointer border-blue-700 hover:border-b-4 hover:font-bold transition-all ${u.value==="info"?"font-bold border-b-4":""}`),onClick:c[0]||(c[0]=re=>u.value="info")}," 信息 ",2),I.value.type==="builtin_tool"&&((Be=(je=(Me=I.value)==null?void 0:Me.tool)==null?void 0:je.params)==null?void 0:Be.length)>0?(n(),f("div",{key:0,class:ue(`text-gray-700 pt-1 cursor-pointer border-blue-700 hover:border-b-4 hover:font-bold transition-all ${u.value==="setting"?"font-bold border-b-4":""}`),onClick:c[1]||(c[1]=re=>u.value="setting")}," 设置 ",2)):Q("",!0)])]),e(z,{size:"mini",type:"text",class:"!text-gray-700",onClick:E},{icon:o(()=>[e(F)]),_:1})]),u.value==="info"?(n(),f("div",ol,[c[9]||(c[9]=t("div",{class:"text-gray-70 font-bold mb-1"},"工具描述",-1)),t("div",ll,T((Pe=(Le=I.value)==null?void 0:Le.tool)==null?void 0:Pe.description),1),((Ge=(Re=(Ie=I.value)==null?void 0:Ie.tool)==null?void 0:Re.inputs)==null?void 0:Ge.length)>0?(n(),f("div",sl,[c[8]||(c[8]=t("div",{class:"flex items-center gap-2 my-4"},[t("div",{class:"text-xs font-bold text-gray-500"},"参数"),t("hr",{class:"flex-1"})],-1)),t("div",nl,[(n(!0),f(te,null,oe((We=(Oe=I.value)==null?void 0:Oe.tool)==null?void 0:We.inputs,re=>(n(),f("div",{key:re.name,class:"flex flex-col gap-2"},[t("div",al,[t("div",il,T(re.name),1),t("div",rl,T(g(it)[re.type]),1),re.required?(n(),f("div",dl,"必填")):Q("",!0)]),t("div",ul,T(re.description),1)]))),128))])])):Q("",!0)])):Q("",!0),u.value==="setting"?(n(),f("div",cl,[e(et,{model:N.value,"onUpdate:model":c[2]||(c[2]=re=>N.value=re),layout:"vertical",class:""},{default:o(()=>{var re,He;return[(n(!0),f(te,null,oe((He=(re=I.value)==null?void 0:re.tool)==null?void 0:He.params,K=>(n(),J(Ze,{key:K.name,field:K.name},{label:o(()=>[t("div",pl,[t("div",_l,T(K.label),1),K.required?(n(),f("div",gl,"*")):Q("",!0),e(xe,{content:K.label},{default:o(()=>[e(_e)]),_:2},1032,["content"])])]),default:o(()=>[K.type==="select"?(n(),J($e,{key:0,"default-value":K.default,"model-value":N.value[K.name],"onUpdate:modelValue":ye=>N.value[K.name]=ye,placeholder:"请输入参数值",options:K.options},null,8,["default-value","model-value","onUpdate:modelValue","options"])):Q("",!0),K.type==="string"?(n(),J(Ve,{key:1,placeholder:"请输入参数值","model-value":N.value[K.name],"onUpdate:modelValue":ye=>N.value[K.name]=ye,"default-value":K.default},null,8,["model-value","onUpdate:modelValue","default-value"])):Q("",!0),K.type==="number"?(n(),J(Xe,{key:2,placeholder:"请输入参数值","model-value":N.value[K.name],"onUpdate:modelValue":ye=>N.value[K.name]=ye,"default-value":K.default,min:K.min,max:K.max},null,8,["model-value","onUpdate:modelValue","default-value","min","max"])):Q("",!0),K.type==="boolean"?(n(),J(Ye,{key:3,"model-value":N.value[K.name],"onUpdate:modelValue":ye=>N.value[K.name]=ye,"default-value":K.default},{default:o(()=>[e(ze,{value:!0},{default:o(()=>c[10]||(c[10]=[U("开启")])),_:1}),e(ze,{value:!1},{default:o(()=>c[11]||(c[11]=[U("关闭")])),_:1})]),_:2},1032,["model-value","onUpdate:modelValue","default-value"])):Q("",!0)]),_:2},1032,["field"]))),128))]}),_:1},8,["model"])])):Q("",!0),t("div",ml,[c[14]||(c[14]=t("div",{class:""},null,-1)),e(De,{size:12},{default:o(()=>[e(z,{class:"rounded-lg",onClick:E},{default:o(()=>c[12]||(c[12]=[U("取消")])),_:1}),e(z,{loading:g(d),type:"primary",class:"rounded-lg",onClick:ee},{default:o(()=>c[13]||(c[13]=[U(" 保存 ")])),_:1},8,["loading"])]),_:1})])]}),_:1},8,["visible"]),e(Se,{visible:le.value,"onUpdate:visible":c[6]||(c[6]=P=>le.value=P),"hide-title":"",footer:!1,class:"tools-modal","modal-class":"right-4 h-[calc(100vh-32px)]"},{default:o(()=>[t("div",fl,[t("div",vl,[c[20]||(c[20]=t("div",{class:"text-gray-900 font-bold text-lg mb-4"},"关联插件",-1)),e(tt,{to:{name:"space-tools-list",query:{create_type:"tool"}}},{default:o(()=>[e(z,{long:"",type:"primary",class:"rounded-lg mb-5"},{default:o(()=>c[15]||(c[15]=[U("创建自定义插件")])),_:1})]),_:1}),t("div",xl,[t("div",{class:ue(`rounded-lg h-8 leading-8 px-3 flex items-center gap-2 cursor-pointer hover:bg-white hover:text-blue-700 ${S.value==="api_tool"?"text-blue-700 bg-white":"text-gray-700"}`),onClick:c[3]||(c[3]=P=>S.value="api_tool")},[e(ot),c[16]||(c[16]=U(" 自定义插件 "))],2),t("div",{class:ue(`rounded-lg h-8 leading-8 px-3 flex items-center gap-2 cursor-pointer hover:bg-white hover:text-blue-700 ${S.value==="builtin_tool"?"text-blue-700 bg-white":"text-gray-700"}`),onClick:c[4]||(c[4]=P=>S.value="builtin_tool")},[e(lt),c[17]||(c[17]=U(" 内置插件 "))],2)]),S.value==="builtin_tool"?(n(),f("div",yl,[c[19]||(c[19]=t("div",{class:"text-xs text-gray-500 mb-3"},"类别",-1)),t("div",bl,[t("div",{class:ue(`rounded-lg h-8 leading-8 px-3 flex items-center gap-2 cursor-pointer hover:bg-white hover:text-blue-700 ${r.value==="all"?"text-blue-700 bg-white":"text-gray-700"}`),onClick:c[5]||(c[5]=P=>r.value="all")},[e(st),c[18]||(c[18]=U(" 全部 "))],2),(n(!0),f(te,null,oe(g(B),P=>(n(),f("div",{key:P.name,class:ue(`rounded-lg h-8 leading-8 px-3 flex items-center gap-2 cursor-pointer hover:bg-white hover:text-blue-700 ${r.value===P.category?"text-blue-700 bg-white":" text-gray-700"}`),onClick:de=>r.value=P.category},[t("span",{innerHTML:P.icon},null,8,wl),U(" "+T(P.name),1)],10,hl))),128))])])):Q("",!0)]),t("div",kl,[t("div",$l,[t("div",Cl,T(S.value==="api_tool"?"自定义插件":"内置插件"),1),e(z,{size:"mini",type:"text",class:"!text-gray-700 ml-6"},{icon:o(()=>[e(F)]),_:1})]),S.value==="builtin_tool"?(n(),f("div",ql,[(n(!0),f(te,null,oe(p.value,(P,de)=>(n(),f("div",{key:P.name,class:"flex flex-col gap-3 mb-3"},[t("div",zl,T(P.label),1),t("div",Dl,[(n(!0),f(te,null,oe(P.tools,(ie,he)=>(n(),f("div",{key:ie.name,class:ue(`flex items-center justify-between px-2 h-8 rounded-lg cursor-pointer hover:bg-gray-50 group ${j(P,ie)?"bg-blue-50 border border-blue-700":""}`)},[t("div",Sl,[e(W,{size:20,shape:"circle","image-url":`${g(Ee)}/builtin-tools/${P.name}/icon`},null,8,["image-url"]),t("div",Ul,T(ie.label),1)]),e(z,{size:"mini",class:"hidden group-hover:block rounded px-1.5 flex-shrink-0",onClick:async()=>await X(de,he)},{icon:o(()=>[e(O)]),default:o(()=>[U(" "+T(j(P,ie)?"删除":"添加"),1)]),_:2},1032,["onClick"])],2))),128))])]))),128)),p.value.length===0?(n(),f("div",Tl,[e(Ue,{description:"没有可用的内置插件",class:"h-[400px] flex flex-col items-center justify-center"})])):Q("",!0)])):Q("",!0),S.value==="api_tool"?(n(),f("div",Al,[e(Te,{loading:g(k),class:"block h-[calc(100vh-130px)] overflow-scroll scrollbar-w-none",onScroll:Y},{default:o(()=>[(n(!0),f(te,null,oe(g(A),(P,de)=>(n(),f("div",{key:P.id,class:"flex flex-col gap-3 mb-3"},[t("div",Ml,T(P.name),1),t("div",jl,[(n(!0),f(te,null,oe(P.tools,(ie,he)=>(n(),f("div",{key:ie.name,class:ue(`flex items-center justify-between px-2 h-8 rounded-lg cursor-pointer hover:bg-gray-50 group ${j(P,ie)?"bg-blue-50 border border-blue-700":""}`)},[t("div",Bl,[e(W,{size:20,shape:"circle","image-url":P.icon},null,8,["image-url"]),t("div",Ll,T(ie.name),1)]),e(z,{size:"mini",class:"hidden group-hover:block rounded px-1.5 flex-shrink-0",onClick:async()=>await X(Number(de),he)},{icon:o(()=>[e(O)]),default:o(()=>[U(" "+T(j(P,ie)?"删除":"添加"),1)]),_:2},1032,["onClick"])],2))),128))])]))),128)),g(A).length===0?(n(),f("div",Pl,[e(Ue,{description:"没有可用的API插件",class:"h-[400px] flex flex-col items-center justify-center"})])):Q("",!0),g(M).total_page>=2?(n(),J(nt,{key:1},{default:o(()=>[g(M).current_page<=g(M).total_page?(n(),J(Ae,{key:0,span:24,class:"!text-center"},{default:o(()=>[e(De,{class:"my-4"},{default:o(()=>[e(Te),c[21]||(c[21]=t("div",{class:"text-gray-400"},"加载中",-1))]),_:1})]),_:1})):(n(),J(Ae,{key:1,span:24,class:"!text-center"},{default:o(()=>c[22]||(c[22]=[t("div",{class:"text-gray-400 my-4"},"数据已加载完成",-1)])),_:1}))]),_:1})):Q("",!0)]),_:1},8,["loading"])])):Q("",!0)])])]),_:1},8,["visible"])])}}}),Rl={class:""},Gl={key:0,class:"flex flex-col gap-1"},Ol={class:"flex items-center gap-2"},Wl={class:"flex flex-col flex-1 gap-1 h-9"},Hl={class:"text-gray-700 font-bold leading-[18px] line-clamp-1 break-all"},El={class:"text-gray-500 text-xs line-clamp-1 break-all"},Fl={key:1,class:"text-xs text-gray-500 leading-[22px]"},Ql={class:"flex items-center justify-between mb-6"},Nl={class:"h-[calc(100vh-180px)] mb-4 overflow-scroll scrollbar-w-none"},Kl={class:"flex flex-col gap-2"},Jl=["onClick"],Vl={class:"line-clamp-1 text-gray-500 flex-1"},Xl={class:"flex items-center justify-between"},Yl={class:""},Zl=ae({__name:"WorkflowsAbilityItem",props:{app_id:{type:String,default:"",required:!0},workflows:{type:Array,default:()=>[],required:!0}},emits:["update:workflows"],setup(_,{emit:h}){const i=_,y=h,{loading:d,handleUpdateDraftAppConfig:q}=pe(),{loading:a,paginator:C,workflows:v,loadWorkflows:k}=St(),M=D(!1),A=D(!1),b=D([]),w=D([]),m=async R=>{const{scrollTop:$,scrollHeight:u,clientHeight:I}=R.target;if($+I>=u-10){if(a.value)return;await k("","published")}},x=()=>ne.isEqual(b.value,w.value),B=()=>{M.value=!1,b.value=w.value,A.value=!1},H=R=>{const $=v.value[R];if(b.value.some(u=>u.id===$.id))b.value=b.value.filter(u=>u.id!==$.id);else{if(b.value.length>=5){ce.warning("关联工作流已超过5个，无法继续关联");return}b.value.push({id:$.id,name:$.name,icon:$.icon,description:$.description})}},V=async()=>{await q(i.app_id,{workflows:b.value.map(R=>R.id)}),w.value=b.value,await we(),y("update:workflows",b.value),B()};return ge(()=>i.workflows,R=>{if((!A.value||!x())&&R&&R.length>0){const $=i.workflows.map(u=>({id:u.id,name:u.name,icon:u.icon,description:u.description}));b.value=ne.cloneDeep($),w.value=ne.cloneDeep($),A.value=!0}},{immediate:!0,deep:!0}),ge(()=>M.value,async R=>{R?await k("","published",!0):v.value.splice(0,v.value.length)}),(R,$)=>{const u=l("icon-plus"),I=l("a-button"),Z=l("a-avatar"),N=l("icon-delete"),le=l("a-collapse-item"),S=l("icon-close"),r=l("a-empty"),p=l("a-spin"),G=l("a-space"),E=l("a-col"),ee=l("a-row"),se=l("a-modal");return n(),f("div",Rl,[e(le,{key:"workflows",class:"app-ability-item"},{header:o(()=>$[1]||($[1]=[t("div",{class:"text-gray-700 font-bold"},"工作流",-1)])),extra:o(()=>[e(I,{size:"mini",type:"text",class:"!text-gray-700",onClick:$[0]||($[0]=be(s=>M.value=!0,["stop"]))},{icon:o(()=>[e(u)]),_:1})]),default:o(()=>{var s;return[((s=i.workflows)==null?void 0:s.length)>0?(n(),f("div",Gl,[(n(!0),f(te,null,oe(i.workflows,(Y,X)=>(n(),f("div",{key:Y.id,class:"flex items-center justify-between bg-white p-3 rounded-lg cursor-pointer hover:shadow-sm group"},[t("div",Ol,[e(Z,{size:36,shape:"square",class:"rounded flex-shrink-0","image-url":Y.icon},null,8,["image-url"]),t("div",Wl,[t("div",Hl,T(Y.name),1),t("div",El,T(Y.description),1)])]),e(I,{size:"mini",type:"text",class:"hidden group-hover:block flex-shrink-0 ml-2 !text-red-700 rounded",onClick:async()=>{const j=[...i.workflows];j.splice(X,1),await g(q)(i.app_id,{workflows:j.map(L=>L.id)}),A.value=!1,y("update:workflows",j)}},{icon:o(()=>[e(N)]),_:2},1032,["onClick"])]))),128))])):(n(),f("div",Fl," 工作流支持通过可视化的方式，对插件、大语言模型、代码块等功能进行组合，从而实现复杂、稳定的业务流程编排，例如旅行规划、报告分析等。 "))]}),_:1}),e(se,{visible:M.value,"hide-title":"",footer:!1,width:400,class:"workflows-modal","modal-class":"h-[calc(100vh-32px)] right-4",onCancel:B},{default:o(()=>[t("div",Ql,[$[2]||($[2]=t("div",{class:"text-lg font-bold text-gray-700"},"选择关联工作流",-1)),e(I,{type:"text",class:"!text-gray-700",size:"small",onClick:B},{icon:o(()=>[e(S)]),_:1})]),t("div",Nl,[e(p,{loading:g(a),class:"block h-full w-full scrollbar-w-none overflow-scroll",onScroll:m},{default:o(()=>[t("div",Kl,[(n(!0),f(te,null,oe(g(v),(s,Y)=>(n(),f("div",{key:s.id,class:ue(`flex items-center gap-2 border px-3 py-2 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-700 ${b.value.some(X=>X.id===s.id)?"bg-blue-50 border-blue-700":""}`),onClick:()=>H(Y)},[e(Z,{size:24,shape:"square",class:"flex-shrink-0 rounded","image-url":s.icon},null,8,["image-url"]),t("div",Vl,T(s.name),1)],10,Jl))),128)),g(v).length===0?(n(),J(r,{key:0,description:"没有可用的工作流",class:"h-[400px] flex flex-col items-center justify-center"})):Q("",!0)]),g(C).total_page>=2?(n(),J(ee,{key:0},{default:o(()=>[g(C).current_page<=g(C).total_page?(n(),J(E,{key:0,span:24,class:"!text-center"},{default:o(()=>[e(G,{class:"my-4"},{default:o(()=>[e(p),$[3]||($[3]=t("div",{class:"text-gray-400"},"加载中",-1))]),_:1})]),_:1})):(n(),J(E,{key:1,span:24,class:"!text-center"},{default:o(()=>$[4]||($[4]=[t("div",{class:"text-gray-400 my-4"},"数据已加载完成",-1)])),_:1}))]),_:1})):Q("",!0)]),_:1},8,["loading"])]),t("div",Xl,[t("div",Yl,T(b.value.length)+" 个工作流被选中",1),e(G,{size:12},{default:o(()=>[e(I,{class:"rounded-lg",onClick:B},{default:o(()=>$[5]||($[5]=[U("取消")])),_:1}),e(I,{loading:g(d),type:"primary",class:"rounded-lg",onClick:V},{default:o(()=>$[6]||($[6]=[U(" 添加 ")])),_:1},8,["loading"])]),_:1})])]),_:1},8,["visible"])])}}}),es={class:"flex flex-col h-[calc(100vh-141px)]"},ts={class:"flex-1 overflow-scroll scrollbar-w-none"},os=ae({__name:"AgentAppAbility",props:{app_id:{type:String,default:"",required:!0},draft_app_config:{type:Object,required:!0}},emits:["update:draft_app_config"],setup(_,{emit:h}){const i=["tools","workflows","datasets","long_term_memory","opening","suggested_after_answer","review_config"];return(y,d)=>{const q=l("icon-down"),a=l("icon-right"),C=l("a-collapse");return n(),f("div",es,[d[8]||(d[8]=t("div",{class:"p-4 text-gray-700 font-bold"},"应用能力",-1)),t("div",ts,[e(C,{bordered:!1,"default-active-key":i},{"expand-icon":o(({active:v})=>[v?(n(),J(q,{key:0})):(n(),J(a,{key:1}))]),default:o(()=>[e(Il,{tools:_.draft_app_config.tools,"onUpdate:tools":d[0]||(d[0]=v=>_.draft_app_config.tools=v),app_id:_.app_id},null,8,["tools","app_id"]),e(Zl,{workflows:_.draft_app_config.workflows,"onUpdate:workflows":d[1]||(d[1]=v=>_.draft_app_config.workflows=v),app_id:_.app_id},null,8,["workflows","app_id"]),e(Io,{retrieval_config:_.draft_app_config.retrieval_config,"onUpdate:retrieval_config":d[2]||(d[2]=v=>_.draft_app_config.retrieval_config=v),datasets:_.draft_app_config.datasets,"onUpdate:datasets":d[3]||(d[3]=v=>_.draft_app_config.datasets=v),app_id:_.app_id},null,8,["retrieval_config","datasets","app_id"]),e(Qt,{long_term_memory:_.draft_app_config.long_term_memory,"onUpdate:long_term_memory":d[4]||(d[4]=v=>_.draft_app_config.long_term_memory=v),app_id:_.app_id},null,8,["long_term_memory","app_id"]),e(eo,{opening_questions:_.draft_app_config.opening_questions,"onUpdate:opening_questions":d[5]||(d[5]=v=>_.draft_app_config.opening_questions=v),opening_statement:_.draft_app_config.opening_statement,"onUpdate:opening_statement":d[6]||(d[6]=v=>_.draft_app_config.opening_statement=v),app_id:_.app_id},null,8,["opening_questions","opening_statement","app_id"]),e(oo,{suggested_after_answer:_.draft_app_config.suggested_after_answer,"onUpdate:suggested_after_answer":d[7]||(d[7]=v=>_.draft_app_config.suggested_after_answer=v),app_id:_.app_id},null,8,["suggested_after_answer","app_id"]),e(fo,{review_config:_.draft_app_config.review_config,app_id:_.app_id},null,8,["review_config","app_id"])]),_:1})])])}}}),ls={class:""},ss={key:0,class:"flex flex-col px-6 h-[calc(100vh-238px)]"},ns={class:"flex flex-col gap-6 py-6"},as={key:0,class:"h-[50px] flex items-center justify-center"},is={key:1,class:"flex flex-col p-6 gap-2 items-center justify-center h-[calc(100vh-238px)]"},rs={class:"flex flex-col items-center gap-2"},ds={class:"text-lg text-gray-700"},us={key:0,class:"bg-gray-100 w-full px-4 py-3 rounded-lg text-gray-700"},cs={class:"flex items-center flex-wrap gap-2 w-full"},ps=["onClick"],_s={class:"w-full flex flex-col flex-shrink-0"},gs={class:"px-6 flex items-center gap-4"},ms={class:"h-[50px] flex items-center gap-2 px-4 flex-1 border border-gray-200 rounded-full"},fs=ae({__name:"PreviewDebugChat",props:{app:{type:Object,default:{},required:!0},suggested_after_answer:{type:Object,default:{enable:!0},required:!0},opening_statement:{type:String,default:"",required:!0},opening_questions:{type:Array,default:[],required:!0}},setup(_){const h=Ke(),i=_,y=D(""),d=D(""),q=D(""),a=D(null),C=D(0),v=rt(),{loading:k,handleDeleteDebugConversation:M}=pt(),{loading:A,messages:b,paginator:w,loadDebugConversationMessages:m}=_t(),{loading:x,handleDebugChat:B}=gt(),{loading:H,handleStopDebugChat:V}=mt(),{suggested_questions:R,handleGenerateSuggestedQuestions:$}=xt(),u=()=>{C.value=a.value.$el.scrollHeight},I=()=>{a.value.$el.scrollTop=a.value.$el.scrollHeight-C.value},Z=async r=>{var G;const{scrollTop:p}=r.target;p<=0&&!A.value&&(u(),await m((G=h.params)==null?void 0:G.app_id,!1),I())},N=async()=>{var G,E;if(y.value.trim()===""){ce.warning("用户提问不能为空");return}if(x.value){ce.warning("上一次提问还未结束，请稍等");return}R.value=[],d.value="",q.value="",b.value.unshift({id:"",conversation_id:"",query:y.value,answer:"",total_token_count:0,latency:0,agent_thoughts:[],created_at:0});let r=0;const p=y.value;y.value="",await B((G=i.app)==null?void 0:G.id,p,ee=>{var j;const se=ee==null?void 0:ee.event,s=ee==null?void 0:ee.data,Y=s==null?void 0:s.id,X=b.value[0].agent_thoughts;if(d.value===""&&(s!=null&&s.message_id)&&(q.value=s==null?void 0:s.task_id,d.value=s==null?void 0:s.message_id,b.value[0].id=s==null?void 0:s.message_id,b.value[0].conversation_id=s==null?void 0:s.conversation_id),se!==Fe.ping){if(se===Fe.agentMessage){const L=X.findIndex(c=>(c==null?void 0:c.id)===Y);L===-1?(r+=1,X.push({id:Y,position:r,event:s==null?void 0:s.event,thought:s==null?void 0:s.thought,observation:s==null?void 0:s.observation,tool:s==null?void 0:s.tool,tool_input:s==null?void 0:s.tool_input,latency:s==null?void 0:s.latency,created_at:0})):X[L]={...X[L],thought:((j=X[L])==null?void 0:j.thought)+(s==null?void 0:s.thought),latency:s==null?void 0:s.latency},b.value[0].answer+=s==null?void 0:s.thought}else r+=1,X.push({id:Y,position:r,event:s==null?void 0:s.event,thought:s==null?void 0:s.thought,observation:s==null?void 0:s.observation,tool:s==null?void 0:s.tool,tool_input:s==null?void 0:s.tool_input,latency:s==null?void 0:s.latency,created_at:0});b.value[0].agent_thoughts=X,a.value.scrollToBottom()}}),(E=i.suggested_after_answer)!=null&&E.enable&&(await $(d.value),setTimeout(()=>a.value&&a.value.scrollToBottom(),100))},le=async()=>{var r;q.value===""||!x.value||await V((r=i.app)==null?void 0:r.id,q.value)},S=async r=>{y.value=r,await N()};return qe(async()=>{var r;await m(String((r=h.params)==null?void 0:r.app_id),!0),await we(()=>{a.value&&a.value.scrollToBottom()})}),(r,p)=>{var Y,X;const G=l("icon-poweroff"),E=l("a-button"),ee=l("a-avatar"),se=l("icon-empty"),s=l("icon-send");return n(),f("div",ls,[g(b).length>0?(n(),f("div",ss,[e(g(wt),{ref_key:"scroller",ref:a,items:g(b).slice().reverse(),"min-item-size":1,onScroll:Z,class:"h-full scrollbar-w-none"},{default:o(({item:j,active:L})=>[e(g(yt),{item:j,active:L,"data-index":j.id},{default:o(()=>[t("div",ns,[e(bt,{query:j.query,account:g(v).account},null,8,["query","account"]),e(ht,{agent_thoughts:j.agent_thoughts,answer:j.answer,app:i.app,suggested_questions:j.id===d.value?g(R):[],loading:j.id===d.value&&g(x),latency:j.latency,total_token_count:j.total_token_count,onSelectSuggestedQuestion:S,message_class:"max-w-[calc(100%-65px)]"},null,8,["agent_thoughts","answer","app","suggested_questions","loading","latency","total_token_count"])])]),_:2},1032,["item","active","data-index"])]),_:1},8,["items"]),q.value&&g(x)?(n(),f("div",as,[e(E,{loading:g(H),class:"rounded-lg px-2",onClick:le},{icon:o(()=>[e(G)]),default:o(()=>[p[2]||(p[2]=U(" 停止响应 "))]),_:1},8,["loading"])])):Q("",!0)])):(n(),f("div",is,[t("div",rs,[e(ee,{size:48,shape:"square",class:"rounded-lg","image-url":(Y=i.app)==null?void 0:Y.icon},null,8,["image-url"]),t("div",ds,T((X=i.app)==null?void 0:X.name),1)]),i.opening_statement?(n(),f("div",us,T(i.opening_statement),1)):Q("",!0),t("div",cs,[(n(!0),f(te,null,oe(i.opening_questions.filter(j=>j.trim()!==""),(j,L)=>(n(),f("div",{key:L,class:"px-4 py-1.5 border rounded-lg text-gray-700 cursor-pointer hover:bg-gray-50",onClick:async()=>await S(j)},T(j),9,ps))),128))])])),t("div",_s,[t("div",gs,[e(E,{loading:g(k),class:"flex-shrink-0 !text-gray-700",type:"text",shape:"circle",onClick:p[0]||(p[0]=async()=>{var j,L;await le(),await g(M)((j=i.app)==null?void 0:j.id),await g(m)((L=i.app)==null?void 0:L.id,!0)})},{icon:o(()=>[e(se,{size:16})]),_:1},8,["loading"]),t("div",ms,[Qe(t("input",{"onUpdate:modelValue":p[1]||(p[1]=j=>y.value=j),type:"text",class:"flex-1 outline-0",onKeyup:dt(N,["enter"])},null,544),[[Ne,y.value]]),e(E,{loading:g(x),type:"text",shape:"circle",class:"!text-gray-700",onClick:N},{icon:o(()=>[e(s,{size:16})]),_:1},8,["loading"])])]),p[3]||(p[3]=t("div",{class:"text-center text-gray-500 text-xs py-4"}," 内容由AI生成，无法确保真实准确，仅供参考。 ",-1))])])}}}),vs=()=>Je("/language-models"),xs=(_,h)=>Je(`/language-models/${_}/${h}`),ys=()=>{const _=D(!1),h=D([]);return{loading:_,language_models:h,loadLanguageModels:async()=>{try{_.value=!0;const y=await vs();h.value=y.data}finally{h.value=[{name:"openApi",position:1,label:"openApi",icon:"https://img1.baidu.com/it/u=1682812017,3182056438&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500",description:"1221",background:"2121",support_model_types:[],models:[{model_name:"4o",label:"4o",icon:"https://img1.baidu.com/it/u=1682812017,3182056438&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500",model_type:"21211",features:[],context_windows:12,max_output_tokens:13,attributes:[],metadata:[],parameters:[]}]}],_.value=!1}}}},bs=()=>{const _=D(!1),h=D({});return{loading:_,language_model:h,loadLanguageModel:async(y,d)=>{try{_.value=!0;const q=await xs(y,d);h.value=q.data}finally{h.value={parameters:[{name:"温度",label:"温度",type:"float",help:"温度",required:!0,default:1,min:0,max:10,precision:1,options:[]},{name:"Top P",label:"Top P",type:"float",help:"Top P",required:!0,default:.48,min:0,max:1,precision:1,options:[]},{name:"存在惩罚",label:"存在惩罚",type:"float",help:"存在惩罚",required:!0,default:.1,min:0,max:1,precision:1,options:[]}]},_.value=!1}}}},hs={class:"flex items-center gap-1 cursor-pointer hover:bg-gray-100 px-1.5 py-1 rounded-lg"},ws={class:"text-gray-700 text-xs"},ks={class:"bg-white px-6 py-5 shadow rounded-lg w-[460px]"},$s={class:"flex flex-col gap-2 mb-2"},Cs={class:"flex items-center gap-2"},qs={class:"text-xs text-gray-700"},zs={class:"text-xs text-gray-700"},Ds={class:"flex items-center gap-2 text-gray-500 w-[120px] flex-shrink-0"},Ss={class:"text-xs"},Us={class:"flex items-center gap-2 h-8"},Ts={class:"flex items-center gap-2 text-gray-500 w-[120px] flex-shrink-0"},As=ae({__name:"ModelConfig",props:{app_id:{type:String,default:"",required:!0},model_config:{type:Object,default:()=>({}),required:!0},dialog_round:{type:Number,default:3,required:!0}},emits:["update:model_config"],setup(_,{emit:h}){const i=_,y=h,d=D({}),{loading:q,language_model:a,loadLanguageModel:C}=bs(),{language_models:v,loadLanguageModels:k}=ys(),{handleUpdateDraftAppConfig:M}=pe(),A=Ce(()=>v.value.map(m=>({isGroup:!0,label:m.label,options:m.models.map(x=>({label:x.label,value:`${m.name}/${x.model_name}`}))}))),b=m=>{const[x,B]=m.splice("/");C(x,B).then(()=>{d.value.parameters=a.value.parameters.reduce((H,V)=>(H[V.name]=V.default??null,H),{})})},w=()=>{const[m,x]=d.value.selectValue.splice("/"),B={provider:m,model:x,parameters:d.value.parameters};M(i.app_id,{model_config:B,dialog_round:d.value.dialog_round}).then(()=>y("update:model_config",B))};return ge(()=>i.model_config,m=>{d.value.selectValue=`${m==null?void 0:m.provider}/${m.model}`,d.value.provider=m==null?void 0:m.provider,d.value.model=m==null?void 0:m.model,d.value.parameters=m==null?void 0:m.parameters,m!=null&&m.provider&&C(m==null?void 0:m.provider,m==null?void 0:m.model)},{immediate:!0}),ge(()=>i.dialog_round,m=>{d.value.dialog_round=m},{immediate:!0}),qe(()=>{k()}),(m,x)=>{var S;const B=l("a-avatar"),H=l("icon-down"),V=l("a-space"),R=l("a-select"),$=l("icon-question-circle"),u=l("a-tooltip"),I=l("a-slider"),Z=l("a-input"),N=l("a-spin"),le=l("a-trigger");return(S=i.model_config)!=null&&S.provider?(n(),J(le,{key:0,trigger:"click",position:"bl","popup-translate":[0,12],onHide:w},{content:o(()=>[t("div",ks,[x[5]||(x[5]=t("div",{class:"text-gray-700 text-base font-semibold mb-3"},"模型设置",-1)),t("div",$s,[x[3]||(x[3]=t("div",{class:"text-gray-700"},"模型",-1)),e(R,{"model-value":d.value.selectValue,"onUpdate:modelValue":x[0]||(x[0]=r=>d.value.selectValue=r),options:A.value,size:"small",class:"rounded-lg mb-2",placeholder:"请选择Agent使用的大语言模型",onChange:b},{label:o(({data:r})=>[t("div",Cs,[e(B,{size:16,shape:"square","image-url":r.value.icon},null,8,["image-url"]),e(V,{size:4},{default:o(()=>[t("div",qs,T(r.value.split("/")[0]),1),x[2]||(x[2]=t("div",{class:"text-xs text-gray-500"},"·",-1)),t("div",zs,T(r.value.split("/")[1]),1)]),_:2},1024)])]),_:1},8,["model-value","options"])]),x[6]||(x[6]=t("div",{class:"text-gray-700 mb-2"},"参数",-1)),e(N,{loading:g(q),class:"w-full"},{default:o(()=>{var r;return[(n(!0),f(te,null,oe((r=g(a))==null?void 0:r.parameters,p=>{var G;return n(),f("div",{key:p.name,class:"flex items-center gap-2 h-8 mb-4"},[t("div",Ds,[t("div",Ss,T(p==null?void 0:p.label),1),e(u,{content:p==null?void 0:p.help},{default:o(()=>[e($)]),_:2},1032,["content"])]),((G=p==null?void 0:p.options)==null?void 0:G.length)>0?(n(),J(R,{key:0,"model-value":d.value.parameters[p.name],"onUpdate:modelValue":E=>d.value.parameters[p.name]=E,"default-value":p.default,placeholder:"请选择参数值",options:p.options},null,8,["model-value","onUpdate:modelValue","default-value","options"])):p.type==="boolean"?(n(),J(R,{key:1,"model-value":d.value.parameters[p.name],"onUpdate:modelValue":E=>d.value.parameters[p.name]=E,"default-value":p.default,placeholder:"请选择参数值",options:[{label:"是",value:!0},{label:"否",value:!1}]},null,8,["model-value","onUpdate:modelValue","default-value"])):["int","float"].includes(p.type)?(n(),J(I,{key:2,"model-value":d.value.parameters[p.name],"onUpdate:modelValue":E=>d.value.parameters[p.name]=E,"default-value":p.default,min:p==null?void 0:p.min,max:p==null?void 0:p.max,step:(p==null?void 0:p.type)==="float"?.1:1,"show-input":""},null,8,["model-value","onUpdate:modelValue","default-value","min","max","step"])):p.type==="string"?(n(),J(Z,{key:3,"model-value":d.value.parameters[p.name],"onUpdate:modelValue":E=>d.value.parameters[p.name]=E,"default-value":p.default,placeholder:"请输入参数值"},null,8,["model-value","onUpdate:modelValue","default-value"])):Q("",!0)])}),128))]}),_:1},8,["loading"]),x[7]||(x[7]=t("div",{class:"text-gray-700 mb-2"},"输入及输出设置",-1)),t("div",Us,[t("div",Ts,[x[4]||(x[4]=t("div",{class:"text-xs"},"携带上下文轮数",-1)),e(u,{content:"每次向Agent提问时需要携带的最近消息对话轮数，默认为3。"},{default:o(()=>[e($)]),_:1})]),e(I,{"model-value":d.value.dialog_round,"onUpdate:modelValue":x[1]||(x[1]=r=>d.value.dialog_round=r),"default-value":3,"show-input":"",min:0,max:10,step:1},null,8,["model-value"])])])]),default:o(()=>{var r,p;return[t("div",hs,[e(B,{size:16,shape:"square","image-url":(r=i.model_config)==null?void 0:r.icon},null,8,["image-url"]),t("div",ws,T((p=d.value)==null?void 0:p.model),1),e(H)])]}),_:1})):Q("",!0)}}}),Ms={class:"flex-1 w-full min-h-0 bg-white"},js={class:"flex-1 grid grid-cols-[26fr_14fr] h-full w-full"},Bs={class:"bg-gray-50 flex flex-col h-full"},Ls={class:"flex items-center h-16 border-b p-4"},Ps={class:"grid grid-cols-[13fr_13fr] overflow-hidden h-[calc(100vh-141px)]"},Is={class:"border-r py-4"},Rs={class:"min-w-[404px]"},Js=ae({__name:"DetailView",props:{app:{type:Object,default:{},required:!0}},setup(_){var d;const h=Ke(),i=_,{draftAppConfigForm:y}=ft((d=h.params)==null?void 0:d.app_id);return(q,a)=>{var C,v,k,M,A;return n(),f("div",Ms,[t("div",js,[t("div",Bs,[t("div",Ls,[a[2]||(a[2]=t("div",{class:"text-lg text-gray-700"},"应用编排",-1)),e(As,{dialog_round:g(y).dialog_round,model_config:g(y).model_config,"onUpdate:model_config":a[0]||(a[0]=b=>g(y).model_config=b),app_id:(C=g(h).params)==null?void 0:C.app_id},null,8,["dialog_round","model_config","app_id"])]),t("div",Ps,[t("div",Is,[e(It,{preset_prompt:g(y).preset_prompt,"onUpdate:preset_prompt":a[1]||(a[1]=b=>g(y).preset_prompt=b),app_id:(v=g(h).params)==null?void 0:v.app_id},null,8,["preset_prompt","app_id"])]),e(os,{draft_app_config:g(y),app_id:(k=g(h).params)==null?void 0:k.app_id},null,8,["draft_app_config","app_id"])])]),t("div",Rs,[e(Et,{app_id:String((M=g(h).params)==null?void 0:M.app_id),long_term_memory:g(y).long_term_memory},null,8,["app_id","long_term_memory"]),e(fs,{suggested_after_answer:g(y).suggested_after_answer,opening_questions:g(y).opening_questions,opening_statement:g(y).opening_statement,app:i.app,app_id:(A=i.app)==null?void 0:A.id},null,8,["suggested_after_answer","opening_questions","opening_statement","app","app_id"])])])])}}});export{Js as default};
