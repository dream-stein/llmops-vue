import{d as A,b as D,o as f,f as w,g as t,h as e,w as s,v as O,u as m,c as h,a as $,i as B,G as R,H as M,x as j,r as l,I as T,J as N,q as F,F as G,t as I,K as Q,j as H}from"./index-BKPqZ1Av.js";import{e as S,f as L,g as E,h as J,i as K}from"./use-app-C_UCIg7W.js";const W={class:"flex flex-col h-[calc(100vh-173px)]"},X={class:"flex items-center justify-between px-4 mb-4"},Y={class:"flex flex-col"},Z={key:0,class:"mb-4 flex flex-col"},ee={class:"max-h-[321px] overflow-scroll scrollbar-w-none mb-2 text-gray-700 whitespace-pre-line"},te={class:""},oe={class:"h-[50px] flex items-center gap-2 px-4 flex-1 border border-gray-200 rounded-full"},ne={class:"flex-1"},se=A({__name:"PresetPromptTextarea",props:{app_id:{type:String,required:!0},preset_prompt:{type:String,required:!0}},emits:["update:preset_prompt"],setup(_,{emit:g}){const i=_,d=g,u=D(!1),c=D(""),{handleUpdateDraftAppConfig:n}=S(),{loading:a,optimize_prompt:r,handleOptimizePrompt:o}=L(),y=()=>{if(r.value.trim()===""){j.warning("优化prompt为空，请重新生成");return}d("update:preset_prompt",r.value),n(i.app_id,{preset_prompt:r.value}),u.value=!1},b=async()=>{if(c.value.trim()===""){j.warning("原始prompt不能为空");return}await o(r.value)};return(x,p)=>{const V=l("icon-sync"),C=l("a-button"),q=l("a-space"),v=l("icon-send"),k=l("a-card"),z=l("a-trigger"),P=l("a-textarea");return f(),w("div",W,[t("div",X,[p[8]||(p[8]=t("div",{class:"text-gray-700 font-bold"},"人设与回复逻辑",-1)),e(z,{"popup-visible":u.value,"onUpdate:popupVisible":p[2]||(p[2]=U=>u.value=U),trigger:["click"],position:"bl","popup-translate":[0,8]},{content:s(()=>[e(k,{class:"rounded-lg w-[422px]"},{default:s(()=>[t("div",Y,[c.value?(f(),w("div",Z,[t("div",ee,O(m(r)),1),m(a)?B("",!0):(f(),h(q,{key:0},{default:s(()=>[e(C,{size:"small",type:"primary",class:"rounded-lg",onClick:y},{default:s(()=>p[6]||(p[6]=[$(" 替换 ")])),_:1}),e(C,{size:"small",class:"rounded-lg",onClick:p[0]||(p[0]=U=>u.value=!1)},{default:s(()=>p[7]||(p[7]=[$("退出")])),_:1})]),_:1}))])):B("",!0),t("div",te,[t("div",oe,[R(t("input",{"onUpdate:modelValue":p[1]||(p[1]=U=>c.value=U),type:"text",class:"flex-1 outline-0",placeholder:"你希望如何编写或优化提示词"},null,512),[[M,c.value]]),e(C,{loading:m(a),type:"text",shape:"circle",onClick:b},{icon:s(()=>[e(v,{size:16,class:"!text-blue-700"})]),_:1},8,["loading"])])])])]),_:1})]),default:s(()=>[e(C,{size:"mini",class:"rounded-lg px-2"},{icon:s(()=>[e(V)]),default:s(()=>[p[5]||(p[5]=$(" 优化 "))]),_:1})]),_:1},8,["popup-visible"])]),t("div",ne,[e(P,{class:"h-full resize-none !bg-transparent !border-0 text-gray-700 px-1 preset-prompt-textarea",placeholder:"请在这里输入Agent的人设与回复逻辑(预设prompt)","max-length":2e3,"show-word-limit":"","model-value":i.preset_prompt,"onUpdate:modelValue":p[3]||(p[3]=U=>d("update:preset_prompt",U)),onBlur:p[4]||(p[4]=async()=>{await m(n)(i.app_id,{preset_prompt:i.preset_prompt})})},null,8,["model-value"])])])}}}),ae={class:""},le={class:"flex items-center justify-between border-b h-[64px] px-4"},ie={class:"flex items-center justify-between"},pe={class:"pt-6"},re={class:"flex items-center justify-between"},de=A({__name:"PreViewDebugHeader",props:{app_id:{type:String,required:!0},long_term_memory:{type:Object,required:!0}},setup(_){const g=_,{debug_conversation_summary:i,loadDebugConversationSummary:d}=E(),{loading:u,handleUpdateDebugConversationSummary:c}=J(),n=D(!1),a=async()=>{await d(g.app_id),n.value=!0};return(r,o)=>{var q;const y=l("icon-save"),b=l("a-button"),x=l("icon-close"),p=l("a-textarea"),V=l("a-space"),C=l("a-modal");return f(),w("div",ae,[t("div",le,[o[6]||(o[6]=t("div",{class:"text-lg text-gray-700"},"预览与调试",-1)),e(b,{disabled:!((q=g.long_term_memory)!=null&&q.enable),size:"mini",type:"text",class:"rounded-lg px-1 !text-blue-700",onClick:a},{icon:s(()=>[e(y)]),default:s(()=>[o[5]||(o[5]=$(" 长期记忆 "))]),_:1},8,["disabled"])]),e(C,{width:520,visible:n.value,"onUpdate:visible":o[4]||(o[4]=v=>n.value=v),"hide-title":"",footer:!1,"modal-class":"rounded-xl"},{default:s(()=>[t("div",ie,[o[7]||(o[7]=t("div",{class:"text-lg font-bold text-gray-700"},"长期记忆",-1)),e(b,{type:"text",class:"!text-gray-700",size:"small",onClick:o[0]||(o[0]=v=>n.value=!1)},{icon:s(()=>[e(x)]),_:1})]),t("div",pe,[e(p,{"model-value":m(i),"onUpdate:modelValue":o[1]||(o[1]=v=>T(i)?i.value=v:null),placeholder:"请输入当前调试会话长期记忆","show-word-limit":"","max-length":2e3,"auto-size":{minRows:8,maxRows:8}},null,8,["model-value"]),t("div",re,[o[10]||(o[10]=t("div",{class:""},null,-1)),e(V,{size:16},{default:s(()=>[e(b,{class:"rounded-lg",onClick:o[2]||(o[2]=v=>n.value=!1)},{default:s(()=>o[8]||(o[8]=[$("取消")])),_:1}),e(b,{loading:m(u),type:"primary",class:"rounded-lg",onClick:o[3]||(o[3]=async()=>{await m(c)(g.app_id,m(i)),n.value=!1})},{default:s(()=>o[9]||(o[9]=[$(" 保存 ")])),_:1},8,["loading"])]),_:1})])])]),_:1},8,["visible"])])}}}),_e={class:""},me=A({__name:"LongTermMemoryAbilityItem",props:{app_id:{type:String,default:"",required:!0},long_term_memory:{type:Object,default:{enable:!1},required:!0}},emits:["update:long_term_memory"],setup(_,{emit:g}){const i=_,d=g,{handleUpdateDraftAppConfig:u}=S();return(c,n)=>{const a=l("icon-down"),r=l("a-button"),o=l("a-doption"),y=l("a-dropdown"),b=l("a-collapse-item");return f(),w("div",_e,[e(b,{key:"long_term_memory",class:"app-ability-item"},{header:s(()=>n[2]||(n[2]=[t("div",{class:"text-gray-700 font-bold"},"长期记忆",-1)])),extra:s(()=>[e(y,{onSelect:n[1]||(n[1]=async x=>{var p;!!x!==((p=i.long_term_memory)==null?void 0:p.enable)&&(d("update:long_term_memory",{enable:!!x}),await m(u)(i.app_id,{long_term_memory:{enable:!!x}}))})},{content:s(()=>[e(o,{value:1,class:"text-xs py-1.5 text-gray-700"},{default:s(()=>n[3]||(n[3]=[$("开启")])),_:1}),e(o,{value:0,class:"text-xs py-1.5 text-red-700"},{default:s(()=>n[4]||(n[4]=[$("关闭")])),_:1})]),default:s(()=>[e(r,{size:"mini",class:"rounded-lg flex items-center gap-1 px-1",onClick:n[0]||(n[0]=N(()=>{},["stop"]))},{default:s(()=>{var x;return[$(O((x=i.long_term_memory)!=null&&x.enable?"开启":"关闭")+" ",1),e(a)]}),_:1})]),_:1})]),default:s(()=>[n[5]||(n[5]=t("div",{class:"text-xs text-gray-500 leading-[22px]"}," 总结聊天对话内容，并用于更好的响应用户的信息 ",-1))]),_:1})])}}}),ue={class:""},ce={class:"text-xs text-gray-500"},ge={class:"flex flex-col gap-2 mb-2"},fe={class:"flex items-center gap-2"},xe={class:"flex flex-col gap-2 mb-2"},ve={class:"flex items-center gap-2"},ye={class:"flex flex-col gap-2"},be=A({__name:"OpeningAbility",props:{app_id:{type:String,default:"",required:!0},opening_statement:{type:String,default:"",required:!0},opening_questions:{type:Array,default:[],required:!0}},emits:["update:opening_statement","update:opening_questions"],setup(_,{emit:g}){const i=_,d=g,{handleUpdateDraftAppConfig:u}=S(),c=F({get(){const a=[...i.opening_questions];return a.length<3&&a[a.length-1]!==""&&a.push(""),a},set(a){d("update:opening_questions",a)}}),n=async()=>{await u(i.app_id,{opening_questions:c.value.filter(a=>a.trim()!=="")})};return(a,r)=>{const o=l("icon-exclamation-circle"),y=l("a-tooltip"),b=l("a-textarea"),x=l("a-input"),p=l("icon-delete"),V=l("a-button"),C=l("a-collapse-item");return f(),w("div",ue,[e(C,{key:"opening",class:"app-ability-item"},{header:s(()=>r[3]||(r[3]=[t("div",{class:"text-gray-700 font-bold"},"对话开场白",-1)])),default:s(()=>[t("div",ce,[t("div",ge,[t("div",fe,[r[4]||(r[4]=t("div",{class:"text-gray-700"},"开场白文案",-1)),e(y,{content:"开场白是与Agent应用对话时，Agent默认展示的对话。"},{default:s(()=>[e(o)]),_:1})]),e(b,{"model-value":i.opening_statement,"onUpdate:modelValue":r[0]||(r[0]=q=>d("update:opening_statement",q)),placeholder:"在此处填写 AI 应用的开场白",class:"bg-white text-gray-700 rounded-lg border border-gray-200","auto-size":{minRows:4,maxRows:4},onBlur:r[1]||(r[1]=async()=>{await m(u)(i.app_id,{opening_statement:i.opening_statement})})},null,8,["model-value"])]),t("div",xe,[t("div",ve,[r[5]||(r[5]=t("div",{class:"text-gray-700"},"开场白预设问题",-1)),e(y,{content:"开场白预设问题是与Agent对话时，初始化提供的建议问题，最多不超过3个"},{default:s(()=>[e(o)]),_:1})]),t("div",ye,[(f(!0),w(G,null,I(c.value,(q,v)=>(f(),w("div",{key:v,class:"flex items-center gap-2"},[e(x,{"model-value":q,"onUpdate:modelValue":k=>{const z=[...c.value];z[v]=k,c.value=z},class:"rounded-lg bg-white",placeholder:"输入开场白引导问题",onBlur:r[2]||(r[2]=async()=>await n())},null,8,["model-value","onUpdate:modelValue"]),e(V,{class:"rounded-lg",onClick:async()=>{const k=[...c.value];k.splice(v,1),d("update:opening_questions",k),await Q(),await n()}},{icon:s(()=>[e(p)]),_:2},1032,["onClick"])]))),128))])])])]),_:1})])}}}),we={class:"flex flex-col h-[calc(100vh-141px)]"},$e={class:"flex-1 overflow-scroll scrollbar-w-none"},Ce=A({__name:"AgentAppAbility",props:{app_id:{type:String,default:"",required:!0},draft_app_config:{type:Object,required:!0}},emits:["update:draft_app_config"],setup(_,{emit:g}){return(i,d)=>{const u=l("icon-down"),c=l("icon-right"),n=l("a-collapse");return f(),w("div",we,[d[3]||(d[3]=t("div",{class:"p-4 text-gray-700 font-bold"},"应用能力",-1)),t("div",$e,[e(n,{bordered:!1},{"expand-icon":s(({active:a})=>[a?(f(),h(u,{key:0})):(f(),h(c,{key:1}))]),default:s(()=>[e(me,{long_term_memory:_.draft_app_config.long_term_memory,"onUpdate:long_term_memory":d[0]||(d[0]=a=>_.draft_app_config.long_term_memory=a),app_id:_.app_id},null,8,["long_term_memory","app_id"]),e(be,{opening_questions:_.draft_app_config.opening_questions,"onUpdate:opening_questions":d[1]||(d[1]=a=>_.draft_app_config.opening_questions=a),opening_statement:_.draft_app_config.opening_statement,"onUpdate:opening_statement":d[2]||(d[2]=a=>_.draft_app_config.opening_statement=a),app_id:_.app_id},null,8,["opening_questions","opening_statement","app_id"])]),_:1})])])}}}),qe={class:"flex-1 w-full min-h-0 bg-white"},ke={class:"flex-1 grid grid-cols-[26fr_14fr] h-full w-full"},Ue={class:"bg-gray-50 flex flex-col h-full"},Ae={class:"grid grid-cols-[13fr_13fr] overflow-hidden h-[calc(100vh-141px)]"},Ve={class:"border-r py-4"},ze={class:"min-w-[404px]"},he=A({__name:"DetailView",setup(_){var u;const g=H(),{draftAppConfigForm:i,loadDraftAppConfig:d}=K((u=g.params)==null?void 0:u.app_id);return S(),(c,n)=>{var a,r,o;return f(),w("div",qe,[t("div",ke,[t("div",Ue,[n[1]||(n[1]=t("div",{class:"flex items-center h-16 border-b p-4"},[t("div",{class:"text-lg text-gray-700"},"应用编排")],-1)),t("div",Ae,[t("div",Ve,[e(se,{preset_prompt:m(i).preset_prompt,"onUpdate:preset_prompt":n[0]||(n[0]=y=>m(i).preset_prompt=y),app_id:(a=m(g).params)==null?void 0:a.app_id},null,8,["preset_prompt","app_id"])]),e(Ce,{draft_app_config:m(i),app_id:(r=m(g).params)==null?void 0:r.app_id},null,8,["draft_app_config","app_id"])])]),t("div",ze,[e(de,{app_id:(o=m(g).params)==null?void 0:o.app_id,long_term_memory:m(i).long_term_memory},null,8,["app_id","long_term_memory"])])])])}}});export{he as default};
