import{k as oe,r as z,p as j,q as ne,h as le,v as q,M as re,a as ce,o as v,i as b,w as t,u as c,f as n,e,c as ie,s as de,b as d,g as k,t as w,F as pe,j as B}from"./index-Cko0u09Z.js";import{g as H,p as F}from"./request-Cmc-U4C1.js";import{h as ue}from"./moment-C5S46NFB.js";const _e=(l=1,p=10,s="")=>H("/datasets",{params:{current_page:l,page_size:p,search_word:s}}),me=l=>F("/datasets",{body:l}),fe=(l,p)=>F(`/datasets/${l}`,{body:p}),ge=l=>F(`/datasets/${l}/delete`),ye=l=>H(`/datasets/${l}`),xe=()=>{const l=oe(),p=z(!1),s=j([]),f={current_page:1,page_size:20,total_page:0,total_record:0},r=j({...f}),y=async(o=!1)=>{var C;if(o)D();else if(r.current_page>r.total_page)return;try{p.value=!0;const x=(await _e(r.current_page,r.page_size,String(((C=l.query)==null?void 0:C.search_word)??""))).data;u(x),r.current_page<=r.total_page&&(r.current_page+=1),o?s.splice(0,s.length,...x.list):s.push(...x.list)}finally{Object.assign(s,[{id:"46db30d1-3199-4e79-a0cd-abf12fa6858f",name:"慕课LLMOps知识库",icon:"https://cdn.imooc.com/dataset.png",description:"JavaScript是一种高级编程语言，用于创建交互式网页和动态效果，JavaScript在前端开发中扮演着非常重要的角色，因此学习 JavaScript 对于初级前端工程师来说非常必要。JavaScrip...",document_count:10,character_count:14651,related_app_count:2,updated_at:1721460914,created_at:1721460914}]),p.value=!1}},D=()=>{Object.assign(r,{...f})},u=o=>{r.current_page=o.current_page,r.page_size=o.page_size,r.total_page=o.total_page,r.total_record=o.total_record};return ne(async()=>{await y(!0)}),le(()=>{var o;return(o=l.query)==null?void 0:o.search_word},async()=>{await y(!0)}),{loading:p,datasets:s,paginator:r,loadDatasets:y}},ve=()=>({handleDelete:(p,s)=>{re.warning({title:"要删除知识库吗?",content:"删除知识库后，关联该知识库的应用将无法再使用该知识库，所有的提示配置和文档都将被永久删除",hideCancel:!1,onOk:async()=>{try{const f=await ge(p);q.success(f.message)}finally{s&&s()}}})}}),we=()=>{const l=z(!1),s=j({...{fileList:[],icon:"",name:"",description:""}}),f=z(),r=z(!1);return{loading:l,form:s,formRef:f,saveDataset:async u=>{try{if(l.value=!0,u!==void 0&&u!==""){const o=await fe(u,{icon:s.icon,name:s.name,description:s.description});q.success(o.message)}else{const o=await me({icon:s.icon,name:s.name,description:s.description});q.success(o.message)}}finally{l.value=!1}},showUpdateModal:r,updateShowUpdateModal:(u,o)=>{r.value=u,o&&o()}}},he={class:"flex items-center gap-3 mb-3"},be={class:"flex flex-1 justify-between"},De={class:"flex flex-col"},ke={class:"text-xs text-gray-500 line-clamp-1"},Ce={class:"leading-[18px] text-gray-500 h-[72px] line-clamp-4 mb-2"},Se={class:"flex items-center gap-1.5"},Ve={class:"text-xs text-gray-400"},Me={class:"flex items-center justify-between"},ze={class:"text-lg font-bold text-gray-700"},Ue={class:"pt-6"},je={class:"flex items-center justify-between"},Re=ce({__name:"ListView",props:{createType:{type:String,required:!0}},emits:["update-create-type"],setup(l,{emit:p}){let s="";const f=l,r=p,{loading:y,datasets:D,paginator:u,loadDatasets:o}=xe(),{loading:C,form:_,formRef:x,saveDataset:J,showUpdateModal:N,updateShowUpdateModal:L}=we(),{handleDelete:$}=ve(),W=async m=>{const{scrollTop:a,scrollHeight:g,clientHeight:h}=m.target;if(a+h>=g-10){if(y.value)return;await o()}},E=m=>{L(!0,async()=>{var h;const g=(await ye(m)).data;s=m,(h=x.value)==null||h.resetFields(),_.icon=g.icon,_.name=g.name,_.description=g.description})},S=()=>{L(!1,async()=>{var m;s="",(m=x.value)==null||m.resetFields(),r("update-create-type","")})},G=async({errors:m})=>{m||(await J(s),S(),await o(!0))};return(m,a)=>{const g=n("a-avatar"),h=n("router-link"),I=n("icon-more"),V=n("a-button"),R=n("a-doption"),A=n("a-dropdown"),K=n("icon-user"),Q=n("a-card"),M=n("a-col"),X=n("a-empty"),O=n("a-row"),P=n("a-spin"),T=n("a-space"),Y=n("icon-close"),Z=n("a-upload"),U=n("a-form-item"),ee=n("a-input"),te=n("a-textarea"),ae=n("a-form"),se=n("a-modal");return v(),b(P,{loading:c(y),class:"block h-full w-full scrollbar-w-none overflow-scroll",onScroll:W},{default:t(()=>[e(O,{gutter:[20,20],class:"flex-1"},{default:t(()=>[(v(!0),ie(pe,null,de(c(D),i=>(v(),b(M,{key:i.id,span:6},{default:t(()=>[e(Q,{hoverable:"",class:"cursor-pointer rounded-lg"},{default:t(()=>[d("div",he,[e(g,{size:40,shape:"square","image-url":i.icon},null,8,["image-url"]),d("div",be,[d("div",De,[e(h,{to:{name:"space-datasets-documents-list",params:{dataset_id:i.id}},class:"text-base text-gray-900 font-bold"},{default:t(()=>[k(w(i.name),1)]),_:2},1032,["to"]),d("div",ke,w(i.document_count)+" 文档 · "+w(Math.round(i.character_count/1e3))+" 千字符 · "+w(i.related_app_count)+" 关联应用 ",1)]),e(A,{position:"br"},{content:t(()=>[e(R,{onClick:()=>E(i.id)},{default:t(()=>a[3]||(a[3]=[k("设置")])),_:2},1032,["onClick"]),e(R,{class:"!text-red-500",onClick:()=>c($)(i.id,()=>c(o)(!0))},{default:t(()=>a[4]||(a[4]=[k("删除")])),_:2},1032,["onClick"])]),default:t(()=>[e(V,{type:"text",size:"small",class:"rounded-lg !text-gray-700"},{icon:t(()=>[e(I)]),_:1})]),_:2},1024)])]),d("div",Ce,w(i.description),1),d("div",Se,[e(g,{size:18,class:"bg-blue-700"},{default:t(()=>[e(K)]),_:1}),d("div",Ve," 慕小课 · 最近编辑 "+w(c(ue)(i.created_at).format("MM-DD HH:mm")),1)])]),_:2},1024)]),_:2},1024))),128)),c(D).length===0?(v(),b(M,{key:0,span:24},{default:t(()=>[e(X,{description:"没有可用的知识库",class:"h-[400px] flex flex-col items-center justify-center"})]),_:1})):B("",!0)]),_:1}),c(u).total_page>=2?(v(),b(O,{key:0},{default:t(()=>[c(u).current_page<=c(u).total_page?(v(),b(M,{key:0,span:24,align:"center"},{default:t(()=>[e(T,{class:"my-4"},{default:t(()=>[e(P),a[5]||(a[5]=d("div",{class:"text-gray-400"},"加载中",-1))]),_:1})]),_:1})):(v(),b(M,{key:1,span:24,align:"center"},{default:t(()=>a[6]||(a[6]=[d("div",{class:"text-gray-400 my-4"},"数据已加载完成",-1)])),_:1}))]),_:1})):B("",!0),e(se,{width:520,visible:f.createType==="dataset"||c(N),"hide-title":"",footer:!1,"modal-class":"rounded-xl",onCancel:S},{default:t(()=>[d("div",Me,[d("div",ze,w(f.createType==="dataset"?"新建":"更新")+"知识库 ",1),e(V,{type:"text",class:"!text-gray-700",size:"small",onClick:S},{icon:t(()=>[e(Y)]),_:1})]),d("div",Ue,[e(ae,{ref_key:"formRef",ref:x,model:c(_),onSubmit:G,layout:"vertical"},{default:t(()=>[e(U,{field:"icon","hide-label":"",rules:[{required:!0,message:"知识库图标不能为空"}]},{default:t(()=>[e(Z,{modelValue:c(_).icon,"onUpdate:modelValue":a[0]||(a[0]=i=>c(_).icon=i),limit:1,"list-type":"picture-card",accept:"image/png, image/jpeg",class:"!w-auto mx-auto"},null,8,["modelValue"])]),_:1}),e(U,{field:"name",label:"知识库名称","asterisk-position":"end",rules:[{required:!0,message:"知识库名称不能为空"}]},{default:t(()=>[e(ee,{modelValue:c(_).name,"onUpdate:modelValue":a[1]||(a[1]=i=>c(_).name=i),placeholder:"请输入知识库名称","show-word-limit":"","max-length":60},null,8,["modelValue"])]),_:1}),e(U,{field:"description",label:"知识库描述","asterisk-position":"end"},{default:t(()=>[e(te,{modelValue:c(_).description,"onUpdate:modelValue":a[2]||(a[2]=i=>c(_).description=i),"auto-size":{minRows:4,maxRows:6},placeholder:"请输入知识库内容的描述"},null,8,["modelValue"])]),_:1}),d("div",je,[a[9]||(a[9]=d("div",{class:""},null,-1)),e(T,{size:16},{default:t(()=>[e(V,{class:"rounded-lg",onClick:S},{default:t(()=>a[7]||(a[7]=[k("取消")])),_:1}),e(V,{loading:c(C),type:"primary","html-type":"submit",class:"rounded-lg"},{default:t(()=>a[8]||(a[8]=[k(" 保存 ")])),_:1},8,["loading"])]),_:1})])]),_:1},8,["model"])])]),_:1},8,["visible"])]),_:1},8,["loading"])}}});export{Re as default};
