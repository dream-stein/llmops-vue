import{g as i,p as c,s as y,r as l,D as k,M as f,P as h}from"./index-CkVFFWDB.js";const v=e=>i("/workflows",{params:e}),W=e=>c("/workflows",{body:e}),_=(e,s)=>c(`/workflows/${e}`,{body:s}),b=e=>i(`/workflows/${e}`),m=e=>c(`/workflows/${e}/delete`),D=e=>i(`/workflows/${e}/draft-graph`),G=(e,s)=>c(`/workflows/${e}/draft-graph`,{body:s}),P=e=>c(`/workflows/${e}/publish`),$=e=>c(`/workflows/${e}/cancel-publish`),C=(e,s,o)=>y(`/workflows/${e}/debug`,{body:s},o),R=()=>{const e=l(!1),s=l([]),o={current_page:1,page_size:20,total_page:0,total_record:0},a=l({...o});return{loading:e,workflows:s,paginator:a,loadWorkflows:async(t="",n="",u=!1)=>{if(u)a.value=o;else if(a.value.current_page>a.value.total_page)return;try{e.value=!0;const p=(await v({current_page:a.value.current_page,page_size:a.value.page_size,search_word:t,status:n})).data;a.value=p.paginator,a.value.current_page<=a.value.total_page&&(a.value.current_page+=1),u?s.value=p.list:s.value.push(...p.list)}finally{e.value=!1}}}},q=()=>{const e=l(!1),s=k();return{loading:e,handleCreateWorkflow:async a=>{try{e.value=!0;const r=await W(a);f.success("创建工作流成功"),await s.push({name:"space-workflows-detail",params:{workflow_id:r.data.id}})}finally{e.value=!1}}}},T=()=>{const e=l(!1);return{loading:e,handleUpdateWorkflow:async(o,a)=>{try{e.value=!0;const r=await _(o,a);f.success(r.message)}finally{e.value=!1}}}},z=()=>{const e=l(!1),s=l({});return{loading:e,workflow:s,loadWorkflow:async a=>{try{e.value=!0;const r=await b(a);s.value=r.data}finally{e.value=!1}}}},M=()=>({handleDeleteWorkflow:(s,o)=>{h.warning({title:"要删除该工作流吗?",content:"删除工作流后，发布的WebApp、开放API以及关联的社交媒体平台均无法使用该工作流，如果需要暂停工作流，可使用取消发布功能。",hideCancel:!1,onOk:async()=>{try{const a=await m(s);f.success(a.message)}finally{o&&o()}}})}}),A=()=>{const e=l(!1),s=l([]),o=l([]);return{loading:e,nodes:s,edges:o,loadDraftGraph:async r=>{try{e.value=!0;const n=(await D(r)).data;s.value=n.nodes.map(u=>{const{id:d,node_type:p,position:w,...g}=u;return{id:d,type:p,position:w,data:g}}),o.value=n.edges.map(u=>({...u,animated:!0,style:{strokeWidth:2,stroke:"#9ca3af"}}))}finally{e.value=!1}}}},x=()=>{const e=l(!1);return{loading:e,convertGraphToReq:(a,r)=>({nodes:a.map(t=>({id:t.id,node_type:t.type,position:t.position,...t.data})),edges:r.map(t=>({id:t.id,source:t.source,source_type:t.source_type,target:t.target,target_type:t.target_type}))}),handleUpdateDraftGraph:async(a,r,t=!0)=>{try{e.value=!0;const n=await G(a,r);t&&f.success(n.message)}finally{e.value=!1}}}},I=()=>{const e=l(!1);return{loading:e,convertGraphToReq:(a,r)=>({nodes:a.map(t=>({id:t.id,node_type:t.type,position:t.position,...t.data})),edges:r.map(t=>({id:t.id,source:t.source,source_type:t.source_type,target:t.target,target_type:t.target_type}))}),handlePublishWorkflow:async a=>{try{e.value=!0;const r=await P(a);f.success(r.message)}finally{e.value=!1}}}},O=()=>{const e=l(!1);return{loading:e,handleCancelPublish:async o=>{try{e.value=!0;const a=await $(o);f.success(a.message)}finally{e.value=!1}}}},j=()=>{const e=l(!1),s=l("");return{loading:e,error:s,handleDebugWorkflow:async(a,r,t)=>{try{e.value=!0;const n=await C(a,r,t);n!==void 0&&(s.value=n.message)}finally{e.value=!1}}}};export{T as a,z as b,R as c,M as d,j as e,x as f,A as g,I as h,O as i,q as u};
