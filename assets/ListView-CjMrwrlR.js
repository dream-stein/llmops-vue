import{H as I,G as E,s as R,r as u,B as U,M as F,d as O,p as D,a as C,q as H,w as l,m as c,b as k,t as S,e as t,i as q,f as p,o as J,c as B,x as Q}from"./index-BMt2W0U-.js";import{h as X}from"./moment-C5S46NFB.js";const Z=e=>I("/openapi/api-keys",{body:e}),ee=e=>I(`/openapi/api-keys/${e}/delete`),ae=(e,d)=>I(`/openapi/api-keys/${e}`,{body:d}),te=(e,d)=>I(`/openapi/api-keys/${e}/is-active`,{body:{is_active:d}}),se=e=>E("/openapi/api-keys",{params:e}),ie=()=>{const e=R(),d=u(!1),s=u([]),o=u({...{current_page:1,page_size:20,total_page:0,total_record:0}});return{loading:d,api_keys:s,paginator:o,loadApiKeys:async(z=!1)=>{var m,b;if(!(!z&&o.value.current_page>o.value.total_page))try{d.value=!0;const w=(await se({current_page:((m=e.query)==null?void 0:m.current_page)||1,page_size:((b=e.query)==null?void 0:b.page_size)||20})).data;o.value=w.paginator,s.value=w.list}finally{s.value.push({id:"2121",api_key:"2211",is_active:!0,remark:"21212",updated_at:1742704861,created_at:1742704861}),d.value=!1}}}},le=()=>({handleDeleteApiKey:(d,s)=>{F.warning({title:"要删除该API秘钥吗?",content:"删除秘钥后，无法使用该秘钥访问 LLMOps 个人空间中的所有 Agent，并且无法恢复，如果临时关闭请使用禁用功能。",hideCancel:!1,onOk:async()=>{try{const r=await ee(d);U.success(r.message)}finally{s&&s()}}})}}),oe=()=>{const e=u(!1);return{loading:e,handleUpdateApiKey:async(s,r)=>{try{e.value=!0;const o=await ae(s,r);U.success(o.message)}finally{e.value=!1}}}},ne=()=>{const e=u(!1);return{loading:e,handleUpdateApiKeyIsActive:async(s,r,o)=>{try{e.value=!0;const x=await te(s,r);U.success(x.message)}finally{e.value=!1,o&&o()}}}},re=()=>{const e=u(!1);return{loading:e,handleCreateApiKey:async s=>{try{e.value=!0;const r=await Z(s);U.success(r.message)}finally{e.value=!1}}}},ce={class:"flex items-center justify-between"},de={class:"text-lg font-bold text-gray-700"},pe={class:"pt-6"},ue={class:"flex items-center justify-between"},_e=O({__name:"CreateOrUpdateApiKeyModal",props:{visible:{type:Boolean,default:!1,required:!0},api_key_id:{type:String,default:"",required:!0},is_active:{type:Boolean,default:!1,required:!0},remark:{type:String,default:"",required:!0},callback:{type:Function,required:!1}},emits:["update:visible","update:api_key_id","update:is_active","update:remark"],setup(e,{emit:d}){const s=e,r=d,o=u({}),x=u(null),{loading:z,handleUpdateApiKey:m}=oe(),{loading:b,handleCreateApiKey:h}=re(),w=()=>{r("update:visible",!1)},P=async({errors:y})=>{var i,g,_,K;y||(s.api_key_id?await m(s.api_key_id,{is_active:!!((i=o.value)!=null&&i.is_active),remark:String((g=o.value)==null?void 0:g.remark)}):await h({is_active:!!((_=o.value)!=null&&_.is_active),remark:String((K=o.value)==null?void 0:K.remark)}),w(),s.callback&&s.callback())};return D(()=>s.visible,y=>{y?o.value={is_active:s.is_active,remark:s.remark}:(r("update:api_key_id",""),r("update:is_active",!1),r("update:remark",""))}),(y,i)=>{const g=c("icon-close"),_=c("a-button"),K=c("a-switch"),v=c("a-form-item"),n=c("a-textarea"),$=c("a-space"),M=c("a-form"),A=c("a-modal");return C(),H(A,{visible:s.visible,"onUpdate:visible":i[4]||(i[4]=f=>r("update:visible",f)),"hide-title":"",footer:!1},{default:l(()=>[k("div",ce,[k("div",de,S(e.api_key_id?"更新":"新增")+"秘钥",1),t(_,{type:"text",class:"!text-gray-700",size:"small",onClick:i[0]||(i[0]=()=>r("update:visible",!1))},{icon:l(()=>[t(g)]),_:1})]),k("div",pe,[t(M,{ref_key:"formRef",ref:x,model:o.value,layout:"vertical",onSubmit:P},{default:l(()=>[t(v,{field:"is_active",label:"秘钥状态"},{default:l(()=>[t(K,{"model-value":o.value.is_active,"onUpdate:modelValue":i[1]||(i[1]=f=>o.value.is_active=f),"checked-color":"#10b981","unchecked-color":"#556581"},null,8,["model-value"])]),_:1}),t(v,{field:"remark",label:"秘钥备注"},{default:l(()=>[t(n,{"model-value":o.value.remark,"onUpdate:modelValue":i[2]||(i[2]=f=>o.value.remark=f),"max-length":100,"show-word-limit":"",placeholder:"请输入秘钥备注，用于描述秘钥基础信息"},null,8,["model-value"])]),_:1}),k("div",ue,[i[7]||(i[7]=k("div",{class:""},null,-1)),t($,{size:16},{default:l(()=>[t(_,{class:"rounded-lg",onClick:i[3]||(i[3]=()=>r("update:visible",!1))},{default:l(()=>i[5]||(i[5]=[q(" 取消 ")])),_:1}),t(_,{loading:p(z)||p(b),type:"primary","html-type":"submit",class:"rounded-lg"},{default:l(()=>i[6]||(i[6]=[q(" 保存 ")])),_:1},8,["loading"])]),_:1})])]),_:1},8,["model"])])]),_:1},8,["visible"])}}}),ye={class:"h-[calc(100vh-160px)] overflow-scroll scrollbar-w-none"},ve={class:"flex items-center"},me={class:"line-clamp-1"},ge={key:0,class:"w-2 h-2 bg-green-500 rounded-sm border border-green-700"},fe={key:1,class:"w-2 h-2 bg-gray-500 rounded-sm border border-gray-700"},ke={key:2,class:"text-gray-700"},be={key:3,class:"text-gray-700"},he={class:"line-clamp-1"},we=O({__name:"ListView",props:{create_api_key:{type:Boolean,default:!1,required:!0}},emits:["update:create_api_key"],setup(e,{emit:d}){const s=R(),r=Q(),o=e,x=d,{loading:z,paginator:m,api_keys:b,loadApiKeys:h}=ie(),{handleUpdateApiKeyIsActive:w}=ne(),{handleDeleteApiKey:P}=le(),y=u(!1),i=u(""),g=u(!1),_=u(""),K=async v=>{try{await navigator.clipboard.writeText(v),U.success("复制成功")}catch(n){U.error(String(n))}};return J(async()=>{await h(!0)}),D(()=>o.create_api_key,v=>{i.value="",y.value=!!v}),D(()=>s.query,async(v,n)=>{v.current_page!=n.current_page&&await h()}),(v,n)=>{const $=c("icon-copy"),M=c("a-button"),A=c("a-table-column"),f=c("a-space"),T=c("a-divider"),Y=c("a-switch"),N=c("icon-more"),V=c("a-doption"),W=c("a-dropdown"),j=c("a-table");return C(),B("div",ye,[t(j,{hoverable:"",pagination:{total:p(m).total_record,current:p(m).current_page,defaultCurrent:1,pageSize:p(m).page_size,defaultPageSize:20,showTotal:!0},loading:p(z),bordered:{wrapper:!1},data:p(b),onPageChange:n[0]||(n[0]=a=>{p(r).push({path:p(s).path,query:{current_page:a}})})},{columns:l(()=>[t(A,{title:"秘钥","data-index":"api_key",width:400,"header-cell-class":"rounded-tl-lg !bg-gray-200 text-gray-700","cell-class":"bg-transparent text-gray-700"},{cell:l(({record:a})=>[k("div",ve,[k("div",me,S(a.api_key),1),t(M,{size:"mini",class:"flex-shrink-0 rounded",onClick:async()=>K(a.api_key)},{icon:l(()=>[t($)]),_:2},1032,["onClick"])])]),_:1}),t(A,{title:"状态","data-index":"is_active","header-cell-class":"!bg-gray-200 text-gray-700","cell-class":"bg-transparent text-gray-700"},{cell:l(({record:a})=>[t(f,null,{default:l(()=>[a.is_active?(C(),B("div",ge)):(C(),B("div",fe)),a.is_active?(C(),B("div",ke,"可用")):(C(),B("div",be,"已禁用"))]),_:2},1024)]),_:1}),t(A,{title:"创建时间","data-index":"created_at","header-cell-class":"!bg-gray-200 text-gray-700","cell-class":"bg-transparent text-gray-700"},{cell:l(({record:a})=>[q(S(p(X)(a.created_at*1e3).format("YYYY-MM-DD hh:mm:ss")),1)]),_:1}),t(A,{title:"备注",width:400,"data-index":"remark","header-cell-class":"!bg-gray-200 text-gray-700","cell-class":"bg-transparent text-gray-700"},{cell:l(({record:a})=>[k("div",he,S(a.remark),1)]),_:1}),t(A,{title:"操作","data-index":"operator","header-cell-class":"rounded-tr-lg !bg-gray-200 text-gray-700","cell-class":"bg-transparent text-gray-700 !h-[40px]",width:100},{cell:l(({record:a,rowIndex:G})=>[t(f,{size:0},{split:l(()=>[t(T,{direction:"vertical"})]),default:l(()=>[t(Y,{size:"small",type:"round","checked-color":"#10b981","unchecked-color":"#556581","model-value":a.is_active,onChange:L=>{p(w)(a.id,L,()=>{p(b)[G].is_active=!!L})}},null,8,["model-value","onChange"]),t(W,{position:"br"},{content:l(()=>[t(V,{onClick:()=>{i.value=a.id,g.value=a.is_active,_.value=a.remark,y.value=!0}},{default:l(()=>n[6]||(n[6]=[q(" 重命名 ")])),_:2},1032,["onClick"]),t(V,{class:"!text-red-700",onClick:()=>p(P)(a.id,async()=>{await p(h)()})},{default:l(()=>n[7]||(n[7]=[q(" 删除 ")])),_:2},1032,["onClick"])]),default:l(()=>[t(M,{type:"text",size:"mini",class:"!text-gray-700"},{icon:l(()=>[t(N)]),_:1})]),_:2},1024)]),_:2},1024)]),_:1})]),_:1},8,["pagination","loading","data"]),t(_e,{visible:y.value,"onUpdate:visible":[n[1]||(n[1]=a=>y.value=a),n[5]||(n[5]=a=>x("update:create_api_key",a))],api_key_id:i.value,"onUpdate:api_key_id":n[2]||(n[2]=a=>i.value=a),is_active:g.value,"onUpdate:is_active":n[3]||(n[3]=a=>g.value=a),remark:_.value,"onUpdate:remark":n[4]||(n[4]=a=>_.value=a),callback:async()=>await p(h)()},null,8,["visible","api_key_id","is_active","remark","callback"])])}}});export{we as default};
