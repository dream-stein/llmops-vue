import{h as F}from"./moment-C5S46NFB.js";import{d as T,e as G,o as i,c as $,w as a,h as e,g as n,v as _,u as s,f as x,t as E,F as O,i as N,r as o,a as d,b as R,j as U}from"./index-gqefLypC.js";import{u as W,a as I,b as J,c as K,d as Q}from"./use-app-D3bPp9U5.js";const X={class:""},Z={class:"flex items-center gap-3 mb-3"},tt={class:"flex flex-col"},et={class:"text-gray-700 font-bold"},st={class:"text-xs text-gray-500"},at={class:"text-gray-500"},ot={class:"text-gray-500 text-xs mb-[18px]"},nt={class:"flex items-center justify-between"},it={class:"flex flex-col gap-2"},lt={class:"flex items-center gap-2"},dt={class:"text-xs text-gray-500"},rt={key:0,class:"flex items-center justify-center"},ct={key:1,class:"text-gray-400 my-4"},pt=T({__name:"PublishHistoryDrawer",props:{visible:{type:Boolean,required:!0},app:{type:Object,required:!0}},emits:["update:visible","loadDraftAppConfig"],setup(v,{emit:u}){const c=v,m=u,{loading:p,paginator:b,publishHistories:w,loadPublishHistories:H}=W(),{handleFallbackHistoryToDraft:M}=I(),Y=async k=>{var r;const{scrollTop:t,scrollHeight:C,clientHeight:f}=k.target;if(t+f>=C-10){if(p.value)return;await H((r=c.app)==null?void 0:r.id)}};return G(()=>c.visible,async k=>{var t;k?await H((t=c.app)==null?void 0:t.id,!0):w.splice(0,w.length)}),(k,t)=>{const C=o("a-avatar"),f=o("a-divider"),r=o("a-tag"),V=o("a-button"),y=o("a-card"),z=o("a-spin"),P=o("a-space"),B=o("a-drawer");return i(),$(B,{visible:c.visible,title:"发布历史",width:394,footer:!1,"drawer-style":{backgroundColor:"#f9fafb"},onCancel:t[0]||(t[0]=()=>m("update:visible",!1))},{default:a(()=>[e(z,{loading:s(p),class:"block h-full w-full scrollbar-w-none overflow-scroll",onScroll:Y},{default:a(()=>{var D,S,j;return[n("div",X,[n("div",Z,[e(C,{size:40,shape:"square",class:"rounded-lg","image-url":(D=v.app)==null?void 0:D.icon},null,8,["image-url"]),n("div",tt,[n("div",et,_(v.app.name),1),n("div",st," 最近编辑 · "+_(s(F)(((S=v.app)==null?void 0:S.draft_updated_at)*1e3).format("YYYY-MM-DD HH:mm:ss")),1)])]),n("div",at,_((j=v.app)==null?void 0:j.description),1)]),e(f),n("div",ot," 共计 "+_(s(b).total_record)+" 条发布记录 ",1),(i(!0),x(O,null,E(s(w),(h,q)=>(i(),$(y,{key:h.id,hoverable:"",class:"rounded-lg mb-4 cursor-pointer group"},{default:a(()=>[n("div",nt,[n("div",it,[n("div",lt,[t[2]||(t[2]=n("div",{class:"font-bold text-gray-900"},"版本",-1)),e(r,{size:"small",class:"text-gray-700 rounded-lg !border !border-gray-100"},{default:a(()=>[d(" # "+_(String(h.version).padStart(3,"0")),1)]),_:2},1024),q===0?(i(),$(r,{key:0,size:"small",class:"text-gray-700 rounded-lg !border !border-gray-100"},{default:a(()=>t[1]||(t[1]=[d(" 当前版本 ")])),_:1})):N("",!0)]),n("div",dt," 发布时间："+_(s(F)(h.created_at*1e3).format("YYYY-MM-DD HH:mm:ss")),1)]),e(V,{size:"small",class:"rounded-lg hidden group-hover:block",onClick:async()=>{var A;await s(M)((A=c.app)==null?void 0:A.id,h.id,async()=>{m("update:visible",!1),m("loadDraftAppConfig")})}},{default:a(()=>t[3]||(t[3]=[d("回退")])),_:2},1032,["onClick"])])]),_:2},1024))),128)),s(b).total_page>=2?(i(),x("div",rt,[s(b).current_page<=s(b).total_page?(i(),$(P,{key:0,class:"my-4"},{default:a(()=>[e(z),t[4]||(t[4]=n("div",{class:"text-gray-400"},"加载中",-1))]),_:1})):(i(),x("div",ct,"数据已加载完成"))])):N("",!0)]}),_:1},8,["loading"])]),_:1},8,["visible"])}}}),_t={class:"min-h-screen flex flex-col h-full overflow-hidden"},ut={class:"h-[77px] bg-gray-50 p-4 flex items-center justify-between relative border-b"},mt={class:"flex items-center gap-2"},ft={class:"flex items-center gap-3"},gt={class:"flex flex-col justify-between h-[40px]"},bt={key:1,class:"text-gray-700 font-bold"},xt={key:2,class:"flex items-center gap-2"},vt={key:3,class:"flex items-center gap-2"},yt={class:"flex items-center h-[18px] text-xs text-gray-500"},ht={class:"flex items-center h-[18px] text-xs text-gray-500"},wt={class:"absolute left-1/2 -translate-x-1/2"},kt={class:""},Ht=T({__name:"AppLayoutView",setup(v){var Y;const u=U(),c=R(!1),{loading:m,app:p,loadApp:b}=J((Y=u.params)==null?void 0:Y.app_id),{loading:w,handlePublish:H}=K(),{handleCancelPublish:M}=Q();return(k,t)=>{const C=o("icon-left"),f=o("a-button"),r=o("router-link"),V=o("a-avatar"),y=o("a-skeleton-line"),z=o("icon-user"),P=o("icon-schedule"),B=o("a-tag"),D=o("a-space"),S=o("icon-down"),j=o("a-doption"),h=o("a-dropdown"),q=o("a-button-group"),A=o("router-view");return i(),x("div",_t,[n("div",ut,[n("div",mt,[e(r,{to:{name:"space-apps-list"}},{default:a(()=>[e(f,{size:"mini"},{icon:a(()=>[e(C)]),_:1})]),_:1}),n("div",ft,[e(V,{size:40,shape:"square",class:"rounded-lg","image-url":s(p).icon},null,8,["image-url"]),n("div",gt,[s(m)?(i(),$(y,{key:0,widths:[100]})):(i(),x("div",bt,_(s(p).name),1)),s(m)?(i(),x("div",xt,[e(y,{widths:[60],"line-height":18}),e(y,{widths:[60],"line-height":18}),e(y,{widths:[60],"line-height":18})])):(i(),x("div",vt,[n("div",yt,[e(z),t[4]||(t[4]=d(" 个人空间 "))]),n("div",ht,[e(P),d(" "+_(s(p).status==="draft"?"草稿":"已发布"),1)]),e(B,{size:"small",class:"rounded h-[18px] leading-[18px] bg-gray-200 text-gray-500"},{default:a(()=>[d(" 已自动保存 "+_(s(F)(s(p).draft_updated_at*1e3).format("YYYY-MM-DD HH:mm:ss")),1)]),_:1})]))])])]),n("div",wt,[e(D,{size:12},{default:a(()=>{var l,g,L;return[e(r,{to:{name:"space-apps-detail",params:{app_id:String((l=s(u).params)==null?void 0:l.app_id)}},class:"text-base font-bold text-gray-500","active-class":"!text-blue-700"},{default:a(()=>t[5]||(t[5]=[d(" 编排 ")])),_:1},8,["to"]),e(r,{to:{name:"space-apps-published",params:{app_id:String((g=s(u).params)==null?void 0:g.app_id)}},class:"text-base font-bold text-gray-500","active-class":"!text-blue-700"},{default:a(()=>t[6]||(t[6]=[d(" 发布配置 ")])),_:1},8,["to"]),e(r,{to:{name:"space-apps-analysis",params:{app_id:String((L=s(u).params)==null?void 0:L.app_id)}},class:"text-base font-bold text-gray-500","active-class":"!text-blue-700"},{default:a(()=>t[7]||(t[7]=[d(" 统计分析 ")])),_:1},8,["to"])]}),_:1})]),n("div",kt,[e(D,{size:12},{default:a(()=>[e(f,{disabled:s(m),class:"rounded-lg",onClick:t[0]||(t[0]=l=>c.value=!0)},{icon:a(()=>[e(P)]),_:1},8,["disabled"]),e(q,null,{default:a(()=>[e(f,{disabled:s(m),loading:s(w),type:"primary",class:"!rounded-tl-lg !rounded-bl-lg",onClick:t[1]||(t[1]=async()=>{var g;const l=(g=s(u).params)==null?void 0:g.add_id;await s(H)(l),await s(b)(l)})},{default:a(()=>t[8]||(t[8]=[d("更新发布")])),_:1},8,["disabled","loading"]),e(h,{position:"br"},{content:a(()=>[e(j,{disabled:s(p).status==="draft",class:"!text-red-700",onClick:t[2]||(t[2]=async()=>{var g;const l=(g=s(u).params)==null?void 0:g.app_id;await s(M)(l,async()=>await s(b)(l))})},{default:a(()=>t[9]||(t[9]=[d("取消发布")])),_:1},8,["disabled"])]),default:a(()=>[e(f,{type:"primary",class:"!rounded-tr-lg !rounded-br-lg !w-5"},{icon:a(()=>[e(S)]),_:1})]),_:1})]),_:1})]),_:1})])]),e(A),e(pt,{app:s(p),visible:c.value,"onUpdate:visible":t[3]||(t[3]=l=>c.value=l),onLoadDraftAppConfig:()=>{}},null,8,["app","visible"])])}}});export{Ht as default};
