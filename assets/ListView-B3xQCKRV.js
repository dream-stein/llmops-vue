import{d as ce,E as de,G as ue,A as me,o as pe,B as u,w as a,b as o,C as _e,x as s,y as c,f as e,c as fe,k as ge,a as i,j as p,z as d,F as ye,h as B}from"./index-Bj2YrXyJ.js";import{h as xe}from"./moment-C5S46NFB.js";import{u as ve,a as be,b as we,c as he}from"./use-dataset-C8vqPJQx.js";const ke={class:"flex items-center gap-3 mb-3"},Ce={class:"flex flex-1 justify-between"},De={class:"flex flex-col"},Ve={class:"text-xs text-gray-500 line-clamp-1"},Se={class:"leading-[18px] text-gray-500 h-[72px] line-clamp-4 mb-2 break-all"},Ue={class:"flex items-center gap-1.5"},qe={class:"text-xs text-gray-400"},Le={class:"flex items-center justify-between"},ze={class:"text-lg font-bold text-gray-700"},Te={class:"pt-6"},je={class:"flex items-center justify-between"},He=ce({__name:"ListView",props:{createType:{type:String,required:!0}},emits:["update:create-type"],setup(R,{emit:F}){const C=_e(),D=R,H=F;let v="";const{dataset:_,loadDataset:I}=ve(),{loading:V,datasets:S,paginator:b,loadDatasets:m}=be(),{image_url:U,handleUploadImage:N}=de(),{loading:E,form:r,formRef:w,saveDataset:G,showUpdateModal:A,updateShowUpdateModal:q}=we(),{handleDelete:O}=he(),L=ue(()=>{var l;return String(((l=C.query)==null?void 0:l.search_word)??"")}),P=async l=>{const{scrollTop:t,scrollHeight:g,clientHeight:h}=l.target;if(t+h>=g-10){if(V.value)return;await m(!1,L.value)}},W=l=>{q(!0,async()=>{var t;await I(l),v=l,(t=w.value)==null||t.resetFields(),r.value.fileList=[{uid:"1",name:"知识库图标",url:_.value.icon}],r.value.icon=_.value.icon,r.value.name=_.value.name,r.value.description=_.value.description})},f=()=>{q(!1,async()=>{var l;v="",(l=w.value)==null||l.resetFields(),H("update:create-type","")})},J=async({errors:l})=>{l||(await G(v),f(),await m(!0))};return me(()=>{var l;return(l=C.query)==null?void 0:l.search_word},l=>m(!0,String(l))),pe(()=>{m(!0,L.value)}),(l,t)=>{const g=s("a-avatar"),h=s("router-link"),K=s("icon-more"),y=s("a-button"),z=s("a-doption"),Q=s("a-dropdown"),X=s("icon-user"),Y=s("a-card"),x=s("a-col"),Z=s("a-empty"),T=s("a-row"),j=s("a-spin"),M=s("a-space"),$=s("icon-close"),ee=s("a-upload"),k=s("a-form-item"),te=s("a-input"),ae=s("a-textarea"),oe=s("a-form"),se=s("a-modal");return c(),u(j,{loading:o(V),class:"block h-full w-full scrollbar-w-none overflow-scroll",onScroll:P},{default:a(()=>[e(T,{gutter:[20,20],class:"flex-1"},{default:a(()=>[(c(!0),fe(ye,null,ge(o(S),n=>(c(),u(x,{key:n.id,span:6},{default:a(()=>[e(Y,{hoverable:"",class:"cursor-pointer rounded-lg"},{default:a(()=>[i("div",ke,[e(g,{size:40,shape:"square","image-url":n.icon},null,8,["image-url"]),i("div",Ce,[i("div",De,[e(h,{to:{name:"space-datasets-documents-list",params:{dataset_id:n.id}},class:"text-base text-gray-900 font-bold"},{default:a(()=>[p(d(n.name),1)]),_:2},1032,["to"]),i("div",Ve,d(n.document_count)+" 文档 · "+d(Math.round(n.character_count/1e3))+" 千字符 · "+d(n.related_app_count)+" 关联应用 ",1)]),e(Q,{position:"br"},{content:a(()=>[e(z,{onClick:()=>W(n.id)},{default:a(()=>t[3]||(t[3]=[p("设置")])),_:2},1032,["onClick"]),e(z,{class:"!text-red-500",onClick:()=>o(O)(n.id,()=>o(m)(!0))},{default:a(()=>t[4]||(t[4]=[p(" 删除 ")])),_:2},1032,["onClick"])]),default:a(()=>[e(y,{type:"text",size:"small",class:"rounded-lg !text-gray-700"},{icon:a(()=>[e(K)]),_:1})]),_:2},1024)])]),i("div",Se,d(n.description),1),i("div",Ue,[e(g,{size:18,class:"bg-blue-700"},{default:a(()=>[e(X)]),_:1}),i("div",qe," 慕小课 · 最近编辑 "+d(o(xe)(n.created_at*1e3).format("MM-DD HH:mm")),1)])]),_:2},1024)]),_:2},1024))),128)),o(S).length===0?(c(),u(x,{key:0,span:24},{default:a(()=>[e(Z,{description:"没有可用的知识库",class:"h-[400px] flex flex-col items-center justify-center"})]),_:1})):B("",!0)]),_:1}),o(b).total_page>=2?(c(),u(T,{key:0},{default:a(()=>[o(b).current_page<=o(b).total_page?(c(),u(x,{key:0,span:24,align:"center"},{default:a(()=>[e(M,{class:"my-4"},{default:a(()=>[e(j),t[5]||(t[5]=i("div",{class:"text-gray-400"},"加载中",-1))]),_:1})]),_:1})):(c(),u(x,{key:1,span:24,align:"center"},{default:a(()=>t[6]||(t[6]=[i("div",{class:"text-gray-400 my-4"},"数据已加载完成",-1)])),_:1}))]),_:1})):B("",!0),e(se,{width:520,visible:D.createType==="dataset"||o(A),"hide-title":"",footer:!1,"modal-class":"rounded-xl",onCancel:f},{default:a(()=>[i("div",Le,[i("div",ze,d(D.createType==="dataset"?"新建":"更新")+"知识库 ",1),e(y,{type:"text",class:"!text-gray-700",size:"small",onClick:f},{icon:a(()=>[e($)]),_:1})]),i("div",Te,[e(oe,{ref_key:"formRef",ref:w,model:o(r),onSubmit:J,layout:"vertical"},{default:a(()=>[e(k,{field:"fileList","hide-label":"",rules:[{required:!0,message:"知识库图标不能为空"}]},{default:a(()=>[e(ee,{limit:1,"list-type":"picture-card",accept:"image/png, image/jpeg",class:"!w-auto mx-auto","file-list":o(r).fileList,"onUpdate:fileList":t[0]||(t[0]=n=>o(r).fileList=n),"image-preview":"","custom-request":n=>{const{fileItem:ne,onSuccess:le,onError:ie}=n;return(async()=>{try{await o(N)(ne.file),o(r).icon=o(U),le(o(U))}catch(re){ie(re)}})(),{abort:()=>{}}},"on-before-remove":async()=>(o(r).icon="",!0)},null,8,["file-list","custom-request","on-before-remove"])]),_:1}),e(k,{field:"name",label:"知识库名称","asterisk-position":"end",rules:[{required:!0,message:"知识库名称不能为空"}]},{default:a(()=>[e(te,{modelValue:o(r).name,"onUpdate:modelValue":t[1]||(t[1]=n=>o(r).name=n),placeholder:"请输入知识库名称","show-word-limit":"","max-length":60},null,8,["modelValue"])]),_:1}),e(k,{field:"description",label:"知识库描述","asterisk-position":"end"},{default:a(()=>[e(ae,{modelValue:o(r).description,"onUpdate:modelValue":t[2]||(t[2]=n=>o(r).description=n),"auto-size":{minRows:4,maxRows:6},placeholder:"请输入知识库内容的描述"},null,8,["modelValue"])]),_:1}),i("div",je,[t[9]||(t[9]=i("div",{class:""},null,-1)),e(M,{size:16},{default:a(()=>[e(y,{class:"rounded-lg",onClick:f},{default:a(()=>t[7]||(t[7]=[p("取消")])),_:1}),e(y,{loading:o(E),type:"primary","html-type":"submit",class:"rounded-lg"},{default:a(()=>t[8]||(t[8]=[p(" 保存 ")])),_:1},8,["loading"])]),_:1})])]),_:1},8,["model"])])]),_:1},8,["visible"])]),_:1},8,["loading"])}}});export{He as default};
