import{m as O}from"./moment-twGtwDsW.js";import{u as P,a as W,b as J,c as K,d as Q,e as X}from"./use-app-BcT6Xc2b.js";import{d as G,r as z,y as V,q as s,t as m,z as _,w as a,b as c,x as b,a as t,i as x,e as i,C as Y,u as Z,o as ee,A as te,c as ae,j as oe,f as N,F as se}from"./index-BYJWqtuV.js";const le={class:"flex items-center justify-between"},ne={class:"text-lg font-bold text-gray-700"},ie={class:"pt-6"},re={class:"flex items-center justify-between"},ce=G({__name:"CreateOrUpdateAppModal",props:{app_id:{type:String,default:"",required:!1},visible:{type:Boolean,required:!0},callback:{type:Function,required:!1}},emits:["update:visible","update:app_id"],setup(j,{emit:F}){const r=j,A=F,{loading:M,handleCreateApp:f}=P(),{loading:v,handleUpdateApp:T}=W(),{app:w,loadApp:S}=J(),C={fileList:[],icon:"",name:"",description:""},n=z({...C}),u=z(),h=()=>A("update:visible",!1),B=async({errors:l})=>{l||(r.app_id?await T(r.app_id,n.value):await f(n.value),A("update:visible",!1),r.callback&&r.callback())};return V(()=>r.visible,async l=>{var e,p;(e=u.value)==null||e.resetFields(),l?r.app_id&&(await S(r.app_id),n.value={fileList:[{uid:"1",name:"应用图标",url:w.value.icon}],icon:w.value.icon,name:w.value.name,description:w.value.description}):(n.value=C,(p=u.value)==null||p.resetFields(),A("update:app_id",""))}),(l,e)=>{const p=s("icon-close"),g=s("a-button"),y=s("a-upload"),q=s("a-form-item"),D=s("a-input"),k=s("a-textarea"),I=s("a-space"),R=s("a-form"),$=s("a-modal");return m(),_($,{width:520,visible:r.visible,"hide-title":"",footer:!1,"modal-class":"rounded-xl",onCancel:h},{default:a(()=>[c("div",le,[c("div",ne,b(r.app_id===""?"创建 AI 应用":"编辑 AI 应用"),1),t(g,{type:"text",class:"!text-gray-700",size:"small",onClick:h},{icon:a(()=>[t(p)]),_:1})]),c("div",ie,[t(R,{ref_key:"formRef",ref:u,model:n.value,layout:"vertical",onSubmit:B},{default:a(()=>[t(q,{field:"fileList","hide-label":"",rules:[{required:!0,message:"应用图标不能为空"}]},{default:a(()=>[t(y,{limit:1,"list-type":"picture-card",accept:"image/png, image/jpeg",class:"!w-auto mx-auto","file-list":n.value.fileList,"onUpdate:fileList":e[0]||(e[0]=d=>n.value.fileList=d),"image-preview":"","custom-request":d=>{const{fileItem:H,onSuccess:L,onError:U}=d;return(async()=>{try{const o=await i(Y)(H.file);n.value.icon=o.data.image_url,L(o)}catch(o){U(o)}})(),{abort:()=>{}}},"on-before-remove":async()=>(n.value.icon="",!0)},null,8,["file-list","custom-request","on-before-remove"])]),_:1}),t(q,{field:"name",label:"应用名称","asterisk-position":"end",rules:[{required:!0,message:"应用名称不能为空"}]},{default:a(()=>[t(D,{"model-value":n.value.name,"onUpdate:modelValue":e[1]||(e[1]=d=>n.value.name=d),placeholder:"请输入应用名称"},null,8,["model-value"])]),_:1}),t(q,{field:"content",label:"应用描述"},{default:a(()=>[t(k,{"model-value":n.value.description,"onUpdate:modelValue":e[2]||(e[2]=d=>n.value.description=d),"auto-size":{minRows:8,maxRows:8},"max-length":800,"show-word-limit":"",placeholder:"请输入关于该应用的描述信息"},null,8,["model-value"])]),_:1}),c("div",re,[e[5]||(e[5]=c("div",{class:""},null,-1)),t(I,{size:16},{default:a(()=>[t(g,{class:"rounded-lg",onClick:h},{default:a(()=>e[3]||(e[3]=[x("取消")])),_:1}),t(g,{loading:i(M)||i(v),type:"primary","html-type":"submit",class:"rounded-lg"},{default:a(()=>e[4]||(e[4]=[x(" 保存 ")])),_:1},8,["loading"])]),_:1})])]),_:1},8,["model"])])]),_:1},8,["visible"])}}}),de={class:"flex items-center gap-3 mb-3"},ue={class:"flex flex-1 justify-between"},pe={class:"flex flex-col"},me={class:"text-xs text-gray-500 line-clamp-1"},_e={class:"leading-[18px] text-gray-500 h-[72px] line-clamp-4 mb-2 break-all"},fe={class:"flex items-center gap-1.5"},ve={class:"text-xs text-gray-400"},xe=G({__name:"ListView",props:{createType:{type:String,default:"",required:!0}},emits:["update:create-type"],setup(j,{emit:F}){const r=te(),A=j,M=F,f=z(!1),v=z(""),T=Z(),{handleCopyApp:w}=K(),{loading:S,apps:C,paginator:n,loadApps:u}=Q(),{handleDeleteApp:h}=X(),B=async l=>{var y;const{scrollTop:e,scrollHeight:p,clientHeight:g}=l.target;if(e+g>=p-10){if(S.value)return;await u(!1,String(((y=r.query)==null?void 0:y.search_word)??""))}};return ee(async()=>{var l;await u(!0,String(((l=r.query)==null?void 0:l.search_word)??""))}),V(()=>A.createType,l=>{l==="app"&&(v.value="",f.value=!0,M("update:create-type",""))}),V(()=>{var l;return(l=r.query)==null?void 0:l.search_word},l=>u(!0,String(l))),V(()=>{var l;return(l=r.query)==null?void 0:l.create_type},l=>{l==="app"&&(v.value="",f.value=!0)},{immediate:!0}),(l,e)=>{const p=s("a-avatar"),g=s("icon-check-circle-fill"),y=s("router-link"),q=s("icon-more"),D=s("a-button"),k=s("a-doption"),I=s("a-dropdown"),R=s("icon-user"),$=s("a-card"),d=s("a-col"),H=s("a-empty"),L=s("a-row"),U=s("a-spin"),E=s("a-space");return m(),_(U,{loading:i(S),class:"block h-full w-full scrollbar-w-none overflow-scroll",onScroll:B},{default:a(()=>[t(L,{gutter:[20,20],class:"flex-1"},{default:a(()=>[(m(!0),ae(se,null,oe(i(C),o=>(m(),_(d,{key:o.id,span:6},{default:a(()=>[t($,{hoverable:"",class:"cursor-pointer rounded-lg"},{default:a(()=>[c("div",de,[t(p,{size:40,shape:"square","image-url":o.icon},null,8,["image-url"]),c("div",ue,[c("div",pe,[t(y,{to:{name:"space-apps-detail",params:{app_id:o.id}},class:"text-base text-gray-900 font-bold"},{default:a(()=>[x(b(o.name)+" ",1),o.status==="published"?(m(),_(g,{key:0,class:"text-green-700"})):N("",!0)]),_:2},1032,["to"]),c("div",me,b(o.model_config.provider)+" · "+b(o.model_config.model),1)]),t(I,{position:"br"},{content:a(()=>[t(y,{to:{name:"space-apps-analysis",params:{app_id:o.id}}},{default:a(()=>[t(k,null,{default:a(()=>e[2]||(e[2]=[x("分析")])),_:1})]),_:2},1032,["to"]),t(k,{onClick:()=>{v.value=o.id,f.value=!0}},{default:a(()=>e[3]||(e[3]=[x(" 编辑应用 ")])),_:2},1032,["onClick"]),t(k,{onClick:async()=>await i(w)(o.id)},{default:a(()=>e[4]||(e[4]=[x("创建副本")])),_:2},1032,["onClick"]),t(k,{class:"text-red-700",onClick:async()=>await i(h)(o.id,async()=>await i(u)(!0))},{default:a(()=>e[5]||(e[5]=[x(" 删除 ")])),_:2},1032,["onClick"])]),default:a(()=>[t(D,{type:"text",size:"small",class:"rounded-lg !text-gray-700"},{icon:a(()=>[t(q)]),_:1})]),_:2},1024)])]),c("div",_e,b(o.description.trim()===""?o.preset_prompt:o.description),1),c("div",fe,[t(p,{size:18,class:"bg-blue-700"},{default:a(()=>[t(R)]),_:1}),c("div",ve,b(i(T).account.name)+" · 最近编辑 "+b(i(O)(o.created_at).format("MM-DD HH:mm")),1)])]),_:2},1024)]),_:2},1024))),128)),i(C).length===0?(m(),_(d,{key:0,span:24},{default:a(()=>[t(H,{description:"没有可用的Agent智能体",class:"h-[400px] flex flex-col items-center justify-center"})]),_:1})):N("",!0)]),_:1}),i(n).total_page>=2?(m(),_(L,{key:0},{default:a(()=>[i(n).current_page<=i(n).total_page?(m(),_(d,{key:0,span:24,align:"center"},{default:a(()=>[t(E,{class:"my-4"},{default:a(()=>[t(U),e[6]||(e[6]=c("div",{class:"text-gray-400"},"加载中",-1))]),_:1})]),_:1})):(m(),_(d,{key:1,span:24,align:"center"},{default:a(()=>e[7]||(e[7]=[c("div",{class:"text-gray-400 my-4"},"数据已加载完成",-1)])),_:1}))]),_:1})):N("",!0),t(ce,{visible:f.value,"onUpdate:visible":e[0]||(e[0]=o=>f.value=o),app_id:v.value,"onUpdate:app_id":e[1]||(e[1]=o=>v.value=o),callback:async()=>await i(u)(!0)},null,8,["visible","app_id","callback"])]),_:1},8,["loading"])}}});export{xe as default};
