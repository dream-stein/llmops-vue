import{d as ee,r as L,E as ie,y as ce,z as h,w as a,q as s,t as r,b as o,x as u,a as e,i as m,e as t,c as g,A as re,B as _e,F as ue,j as me,f as Z}from"./index-C6MVbFgE.js";import{h as pe}from"./moment-C5S46NFB.js";import{g as ge,h as fe,i as ve,j as ye,k as be,l as he,m as xe}from"./use-dataset-B1jX_Zmb.js";import"./dataset-BbUy3dvp.js";const ke={class:"flex items-center justify-between"},we={class:"text-lg font-bold text-gray-700"},Se={class:"pt-6"},Ce={class:"flex items-center justify-between"},ze=ee({__name:"CreateOrUpdateSegmentModal",props:{dataset_id:{type:String,required:!1},document_id:{type:String,required:!1},segment_id:{type:String,required:!1},visible:{type:Boolean,required:!0},callback:{type:Function,required:!1}},emits:["update:visible"],setup(Y,{emit:d}){const i=Y,f=d,{loading:U,handleCreateSegment:p}=ge(),{loading:B,handleUpdateSegment:F}=fe(),{segment:x,loadSegment:q}=ve(),R={content:"",keywords:[]},_=L(R),V=L(),k=ie(()=>i.segment_id&&i.segment_id!==""),w=()=>f("update:visible",!1),E=async({errors:v})=>{v||(k.value?await F(i.dataset_id,i.document_id,i.segment_id,_.value):await p(i.dataset_id,i.document_id,_.value),f("update:visible",!1),i.callback&&i.callback())};return ce(()=>i.visible,async v=>{var c,n;(c=V.value)==null||c.resetFields(),v?k.value&&(await q(i.dataset_id,i.document_id,i.segment_id),_.value.content=x.value.content,_.value.keywords=x.value.keywords):((n=V.value)==null||n.resetFields(),_.value=R)}),(v,c)=>{const n=s("icon-close"),y=s("a-button"),b=s("a-textarea"),M=s("a-form-item"),$=s("a-input-tag"),N=s("a-space"),S=s("a-form"),C=s("a-modal");return r(),h(C,{width:520,visible:i.visible,"hide-title":"",footer:!1,"modal-class":"rounded-xl",onCancel:w},{default:a(()=>[o("div",ke,[o("div",we,u(k.value?"更新":"添加")+"片段 ",1),e(y,{type:"text",class:"!text-gray-700",size:"small",onClick:w},{icon:a(()=>[e(n)]),_:1})]),o("div",Se,[e(S,{ref_key:"formRef",ref:V,model:_.value,layout:"vertical",onSubmit:E},{default:a(()=>[e(M,{field:"content",label:"片段内容","asterisk-position":"end",rules:[{required:!0,message:"片段内容不能为空"}]},{default:a(()=>[e(b,{"model-value":_.value.content,"onUpdate:modelValue":c[0]||(c[0]=j=>_.value.content=j),"auto-size":{minRows:8,maxRows:8},placeholder:"在这里添加文档片段内容"},null,8,["model-value"])]),_:1}),e(M,{field:"keywords",label:"关键词"},{default:a(()=>[e($,{"model-value":_.value.keywords,"onUpdate:modelValue":c[1]||(c[1]=j=>_.value.keywords=j),"max-tag-count":10,placeholder:"请输入该文档片段关键词，最多不超过10个，按Enter输入"},null,8,["model-value"])]),_:1}),o("div",Ce,[c[4]||(c[4]=o("div",{class:""},null,-1)),e(N,{size:16},{default:a(()=>[e(y,{class:"rounded-lg",onClick:w},{default:a(()=>c[2]||(c[2]=[m("取消")])),_:1}),e(y,{loading:t(B)||t(U),type:"primary","html-type":"submit",class:"rounded-lg"},{default:a(()=>c[3]||(c[3]=[m(" 保存 ")])),_:1},8,["loading"])]),_:1})])]),_:1},8,["model"])])]),_:1},8,["visible"])}}}),Ue={class:"px-6 pt-6 flex flex-col overflow-hidden h-full"},qe={class:"sticky top-0 z-20 bg-gray-50"},Ve={class:"flex items-center w-full gap-2 mb-6"},je={class:"flex items-center gap-3"},De={class:"flex flex-col justify-between h-[40px]"},Be={key:1,class:"text-gray-700"},Fe={key:2,class:"flex items-center gap-2"},Re={key:3,class:"flex items-center gap-2"},Ee={class:"flex items-center justify-between mb-6"},Me={class:"flex items-center gap-2 h-8 leading-8 bg-white rounded-lg px-3 text-gray-700 border"},$e={key:0,class:"w-2 h-2 bg-green-500 border border-green-700 rounded-sm"},He={key:1,class:"w-2 h-2 bg-gray-500 border border-gray-200 rounded-sm"},Le={class:"flex items-center justify-between mb-2"},Ne={class:"flex items-center"},Ye={class:"flex items-center gap-1 text-xs text-gray-700"},Ge={key:0,class:"w-2 h-2 bg-green-500 border border-green-700 rounded-sm"},Oe={key:1,class:"w-2 h-2 bg-gray-500 border border-gray-700 rounded-sm"},Te=["onClick"],Ae={class:"flex items-center justify-between"},Ie={class:"flex items-center gap-3"},Pe={class:"flex items-center gap-1 text-xs text-gray-500"},We={class:"flex items-center gap-1 text-xs text-gray-500"},Ze=ee({__name:"ListView",setup(Y){var k,w,E,v;const d=re(),i=_e(),f=L(!1),U=L(""),{document:p}=ye((k=d.params)==null?void 0:k.dataset_id,(w=d.params)==null?void 0:w.document_id),{loading:B,segments:F,paginator:x,loadSegments:q}=be((E=d.params)==null?void 0:E.dataset_id,(v=d.params)==null?void 0:v.document_id),{handleDelete:R}=he(),{handleUpdate:_}=xe(),V=async c=>{const{scrollTop:n,scrollHeight:y,clientHeight:b}=c.target;if(n+b>=y-10){if(B.value)return;await q()}};return(c,n)=>{var A,I,P,W,J,K,Q;const y=s("icon-left"),b=s("a-button"),M=s("router-link"),$=s("icon-file"),N=s("a-avatar"),S=s("a-skeleton-line"),C=s("a-tag"),j=s("a-input-search"),G=s("a-space"),te=s("a-divider"),ae=s("a-switch"),se=s("icon-bookmark"),oe=s("icon-pushpin"),ne=s("icon-delete"),le=s("a-card"),H=s("a-col"),de=s("a-empty"),O=s("a-row"),T=s("a-spin");return r(),g("div",Ue,[o("div",qe,[o("div",Ve,[e(M,{to:{name:"space-datasets-documents-list",params:{dataset_id:(A=t(d).params)==null?void 0:A.dataset_id,document_id:(I=t(d).params)==null?void 0:I.document_id}}},{default:a(()=>[e(b,{size:"mini",type:"text",class:"!text-gray-700"},{icon:a(()=>[e(y)]),_:1})]),_:1},8,["to"]),o("div",je,[e(N,{size:40,shape:"square",class:"rounded-lg bg-blue-700"},{default:a(()=>[e($)]),_:1}),o("div",De,[(P=t(p))!=null&&P.name?(r(),g("div",Be,"文档 / "+u(t(p).name),1)):(r(),h(S,{key:0,widths:[100]})),(W=t(p))!=null&&W.name?(r(),g("div",Re,[e(C,{size:"small",class:"rounded h-[18px] leading-[18px] bg-gray-200 text-gray-500"},{default:a(()=>[m(u(t(p).segment_count)+" 文档片段 ",1)]),_:1}),e(C,{size:"small",class:"rounded h-[18px] leading-[18px] bg-gray-200 text-gray-500"},{default:a(()=>[m(u(t(p).hit_count)+" 命中 ",1)]),_:1}),e(C,{size:"small",class:"rounded h-[18px] leading-[18px] bg-gray-200 text-gray-500"},{default:a(()=>[m(u(t(pe)(t(p).updated_at).format("YYYY-MM-DD HH:mm"))+" 最后编辑 ",1)]),_:1})])):(r(),g("div",Fe,[e(S,{widths:[60],"line-height":18}),e(S,{widths:[60],"line-height":18}),e(S,{widths:[60],"line-height":18})]))])])]),o("div",Ee,[e(j,{"default-value":((J=t(d).query)==null?void 0:J.search_word)||"",placeholder:"请输入关键词搜索片段",class:"w-[240px] bg-white rounded-lg border-gray-200",onSearch:n[0]||(n[0]=l=>{t(i).push({path:t(d).path,query:{search_word:l}})})},null,8,["default-value"]),e(G,{size:12},{default:a(()=>[o("div",Me,[t(p).enabled?(r(),g("div",$e)):(r(),g("div",He)),m(" "+u(t(p).enabled?"可用":"已禁用"),1)]),e(b,{type:"primary",class:"rounded-lg",onClick:n[1]||(n[1]=()=>{f.value=!0,U.value=""})},{icon:a(()=>[e($)]),default:a(()=>[n[3]||(n[3]=m(" 添加片段 "))]),_:1})]),_:1})])]),e(T,{loading:t(B),class:"block h-full w-full scrollbar-w-none overflow-scroll",onScroll:V},{default:a(()=>[e(O,{gutter:[20,20]},{default:a(()=>[(r(!0),g(ue,null,me(t(F),l=>(r(),h(H,{key:l.id,span:6},{default:a(()=>[e(le,{hoverable:"",class:"cursor-pointer rounded-lg"},{default:a(()=>[o("div",Le,[e(C,{size:"small",class:"rounded-md text-gray-500"},{default:a(()=>[m(" #"+u(l.position.toString().padStart(3,"0")),1)]),_:2},1024),o("div",Ne,[o("div",Ye,[m(u(l.enabled?"已启用":"已禁用")+" ",1),l.enabled?(r(),g("div",Ge)):(r(),g("div",Oe))]),e(te,{direction:"vertical"}),e(ae,{"model-value":l.enabled,"onUpdate:modelValue":z=>l.enabled=z,disabled:l.status!=="completed",onChange:async z=>{var D,X;return await t(_)((D=t(d).params)==null?void 0:D.dataset_id,(X=t(d).params)==null?void 0:X.document_id,l.id,z)},"checked-color":"#10b981","unchecked-color":"#556581",type:"round",size:"small"},null,8,["model-value","onUpdate:modelValue","disabled","onChange"])])]),o("div",{class:"leading-[18px] text-gray-700 h-[72px] line-clamp-4 mb-2 break-all",onClick:()=>{U.value=l.id,f.value=!0}},u(l.content),9,Te),o("div",Ae,[o("div",Ie,[o("div",Pe,[e(se),m(" "+u(l.character_count)+" 字符 ",1)]),o("div",We,[e(oe),m(" "+u(l.hit_count)+" 命中 ",1)])]),e(b,{type:"text",size:"mini",class:"!text-gray-500",onClick:async()=>{var z,D;return await t(R)((z=t(d).params)==null?void 0:z.dataset_id,(D=t(d).params)==null?void 0:D.document_id,l.id,()=>t(q)(!0))}},{icon:a(()=>[e(ne)]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024))),128)),t(F).length===0?(r(),h(H,{key:0,span:24},{default:a(()=>[e(de,{description:"没有可用的文档片段",class:"h-[400px] flex flex-col items-center justify-center"})]),_:1})):Z("",!0)]),_:1}),t(x).total_page>=2?(r(),h(O,{key:0},{default:a(()=>[t(x).current_page<=t(x).total_page?(r(),h(H,{key:0,span:24,align:"center"},{default:a(()=>[e(G,{class:"my-4"},{default:a(()=>[e(T),n[4]||(n[4]=o("div",{class:"text-gray-400"},"加载中",-1))]),_:1})]),_:1})):(r(),h(H,{key:1,span:24,align:"center"},{default:a(()=>n[5]||(n[5]=[o("div",{class:"text-gray-400 my-4"},"数据已加载完成",-1)])),_:1}))]),_:1})):Z("",!0)]),_:1},8,["loading"]),e(ze,{visible:f.value,"onUpdate:visible":n[2]||(n[2]=l=>f.value=l),dataset_id:(K=t(d).params)==null?void 0:K.dataset_id,document_id:(Q=t(d).params)==null?void 0:Q.document_id,segment_id:U.value,callback:()=>t(q)(!0)},null,8,["visible","dataset_id","document_id","segment_id","callback"])])}}});export{Ze as default};
