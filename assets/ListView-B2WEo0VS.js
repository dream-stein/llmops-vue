import{u as $,a as ee,b as te,g as oe}from"./use-dataset-BCvgfPmx.js";import{h as ae}from"./moment-C5S46NFB.js";import{a as se,o as d,i as m,w as t,u as s,f as a,e,c as ne,s as le,b as l,g as _,t as u,F as ie,j as M}from"./index-T-crqSHV.js";import"./request-RJC2F4Zf.js";const re={class:"flex items-center gap-3 mb-3"},ce={class:"flex flex-1 justify-between"},de={class:"flex flex-col"},ue={class:"text-xs text-gray-500 line-clamp-1"},pe={class:"leading-[18px] text-gray-500 h-[72px] line-clamp-4 mb-2"},me={class:"flex items-center gap-1.5"},_e={class:"text-xs text-gray-400"},fe={class:"flex items-center justify-between"},ge={class:"text-lg font-bold text-gray-700"},xe={class:"pt-6"},ye={class:"flex items-center justify-between"},ke=se({__name:"ListView",props:{createType:{type:String,required:!0}},emits:["update-create-type"],setup(T,{emit:q}){let y="";const k=T,B=q,{loading:V,datasets:C,paginator:b,loadDatasets:v}=$(),{loading:F,form:i,formRef:w,saveDataset:H,showUpdateModal:N,updateShowUpdateModal:D}=ee(),{handleDelete:R}=te(),L=async r=>{const{scrollTop:o,scrollHeight:c,clientHeight:p}=r.target;if(o+p>=c-10){if(V.value)return;await v()}},E=r=>{D(!0,async()=>{var p;const c=(await oe(r)).data;y=r,(p=w.value)==null||p.resetFields(),i.icon=c.icon,i.name=c.name,i.description=c.description})},f=()=>{D(!1,async()=>{var r;y="",(r=w.value)==null||r.resetFields(),B("update-create-type","")})},G=async({errors:r})=>{r||(await H(y),f(),await v(!0))};return(r,o)=>{const c=a("a-avatar"),p=a("router-link"),I=a("icon-more"),g=a("a-button"),S=a("a-doption"),O=a("a-dropdown"),P=a("icon-user"),W=a("a-card"),x=a("a-col"),A=a("a-empty"),U=a("a-row"),j=a("a-spin"),z=a("a-space"),J=a("icon-close"),K=a("a-upload"),h=a("a-form-item"),Q=a("a-input"),X=a("a-textarea"),Y=a("a-form"),Z=a("a-modal");return d(),m(j,{loading:s(V),class:"block h-full w-full scrollbar-w-none overflow-scroll",onScroll:L},{default:t(()=>[e(U,{gutter:[20,20],class:"flex-1"},{default:t(()=>[(d(!0),ne(ie,null,le(s(C),n=>(d(),m(x,{key:n.id,span:6},{default:t(()=>[e(W,{hoverable:"",class:"cursor-pointer rounded-lg"},{default:t(()=>[l("div",re,[e(c,{size:40,shape:"square","image-url":n.icon},null,8,["image-url"]),l("div",ce,[l("div",de,[e(p,{to:{name:"space-datasets-documents-list",params:{dataset_id:n.id}},class:"text-base text-gray-900 font-bold"},{default:t(()=>[_(u(n.name),1)]),_:2},1032,["to"]),l("div",ue,u(n.document_count)+" 文档 · "+u(Math.round(n.character_count/1e3))+" 千字符 · "+u(n.related_app_count)+" 关联应用 ",1)]),e(O,{position:"br"},{content:t(()=>[e(S,{onClick:()=>E(n.id)},{default:t(()=>o[3]||(o[3]=[_("设置")])),_:2},1032,["onClick"]),e(S,{class:"!text-red-500",onClick:()=>s(R)(n.id,()=>s(v)(!0))},{default:t(()=>o[4]||(o[4]=[_("删除")])),_:2},1032,["onClick"])]),default:t(()=>[e(g,{type:"text",size:"small",class:"rounded-lg !text-gray-700"},{icon:t(()=>[e(I)]),_:1})]),_:2},1024)])]),l("div",pe,u(n.description),1),l("div",me,[e(c,{size:18,class:"bg-blue-700"},{default:t(()=>[e(P)]),_:1}),l("div",_e," 慕小课 · 最近编辑 "+u(s(ae)(n.created_at).format("MM-DD HH:mm")),1)])]),_:2},1024)]),_:2},1024))),128)),s(C).length===0?(d(),m(x,{key:0,span:24},{default:t(()=>[e(A,{description:"没有可用的知识库",class:"h-[400px] flex flex-col items-center justify-center"})]),_:1})):M("",!0)]),_:1}),s(b).total_page>=2?(d(),m(U,{key:0},{default:t(()=>[s(b).current_page<=s(b).total_page?(d(),m(x,{key:0,span:24,align:"center"},{default:t(()=>[e(z,{class:"my-4"},{default:t(()=>[e(j),o[5]||(o[5]=l("div",{class:"text-gray-400"},"加载中",-1))]),_:1})]),_:1})):(d(),m(x,{key:1,span:24,align:"center"},{default:t(()=>o[6]||(o[6]=[l("div",{class:"text-gray-400 my-4"},"数据已加载完成",-1)])),_:1}))]),_:1})):M("",!0),e(Z,{width:520,visible:k.createType==="dataset"||s(N),"hide-title":"",footer:!1,"modal-class":"rounded-xl",onCancel:f},{default:t(()=>[l("div",fe,[l("div",ge,u(k.createType==="dataset"?"新建":"更新")+"知识库 ",1),e(g,{type:"text",class:"!text-gray-700",size:"small",onClick:f},{icon:t(()=>[e(J)]),_:1})]),l("div",xe,[e(Y,{ref_key:"formRef",ref:w,model:s(i),onSubmit:G,layout:"vertical"},{default:t(()=>[e(h,{field:"icon","hide-label":"",rules:[{required:!0,message:"知识库图标不能为空"}]},{default:t(()=>[e(K,{modelValue:s(i).icon,"onUpdate:modelValue":o[0]||(o[0]=n=>s(i).icon=n),limit:1,"list-type":"picture-card",accept:"image/png, image/jpeg",class:"!w-auto mx-auto"},null,8,["modelValue"])]),_:1}),e(h,{field:"name",label:"知识库名称","asterisk-position":"end",rules:[{required:!0,message:"知识库名称不能为空"}]},{default:t(()=>[e(Q,{modelValue:s(i).name,"onUpdate:modelValue":o[1]||(o[1]=n=>s(i).name=n),placeholder:"请输入知识库名称","show-word-limit":"","max-length":60},null,8,["modelValue"])]),_:1}),e(h,{field:"description",label:"知识库描述","asterisk-position":"end"},{default:t(()=>[e(X,{modelValue:s(i).description,"onUpdate:modelValue":o[2]||(o[2]=n=>s(i).description=n),"auto-size":{minRows:4,maxRows:6},placeholder:"请输入知识库内容的描述"},null,8,["modelValue"])]),_:1}),l("div",ye,[o[9]||(o[9]=l("div",{class:""},null,-1)),e(z,{size:16},{default:t(()=>[e(g,{class:"rounded-lg",onClick:f},{default:t(()=>o[7]||(o[7]=[_("取消")])),_:1}),e(g,{loading:s(F),type:"primary","html-type":"submit",class:"rounded-lg"},{default:t(()=>o[8]||(o[8]=[_(" 保存 ")])),_:1},8,["loading"])]),_:1})])]),_:1},8,["model"])])]),_:1},8,["visible"])]),_:1},8,["loading"])}}});export{ke as default};
