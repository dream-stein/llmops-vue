import{a as T,r as N,p as Z,h as ee,o as r,i as M,w as t,f as s,b as _,e,g as u,v as te,c as m,u as a,t as y,k as ae,l as se}from"./index-Ci0pjunh.js";import{h as ne}from"./moment-C5S46NFB.js";import{c as oe,d as le,e as de,f as ie,h as re,i as ce}from"./use-dataset-Dz1dcaPG.js";import"./request-2K9xL87o.js";const ue={class:"flex items-center justify-between"},_e={class:"pt-6"},pe={class:"flex items-center justify-between"},me=T({__name:"UpdateDocumentNameModal",props:{visible:{type:Boolean,required:!0},dataset_id:{type:String,required:!0},document_id:{type:String,required:!0},onAfterUpdate:{type:Function,required:!1,default:()=>{}}},emits:["update:visible"],setup(B,{emit:i}){const p=B,v=i,h=N(!1),d=Z({name:""}),w=N(),b=()=>{var c;v("update:visible",!1),(c=w.value)==null||c.resetFields()},z=async({errors:c})=>{if(!c)try{h.value=!0;const o=await oe(p.dataset_id,p.document_id,d.name);te.success(o.message),b(),p.onAfterUpdate()}finally{h.value=!1}};return ee(()=>p.visible,async c=>{var o;if(c){const g=(await le(p.dataset_id,p.document_id)).data;(o=w.value)==null||o.resetFields(),d.name=g.name}}),(c,o)=>{const C=s("icon-close"),g=s("a-button"),q=s("a-input"),S=s("a-form-item"),R=s("a-space"),l=s("a-form"),$=s("a-modal");return r(),M($,{width:520,visible:B.visible,"hide-title":"",footer:!1,"modal-class":"rounded-xl",onCancel:b},{default:t(()=>[_("div",ue,[o[1]||(o[1]=_("div",{class:"text-lg font-bold text-gray-700"},"重命名",-1)),e(g,{type:"text",class:"!text-gray-700",size:"small",onClick:b},{icon:t(()=>[e(C)]),_:1})]),_("div",_e,[e(l,{ref_key:"formRef",ref:w,model:d,onSubmit:z,layout:"vertical"},{default:t(()=>[e(S,{field:"name",label:"名称","asterisk-position":"end",rules:[{required:!0,message:"文档名称不能为空"}]},{default:t(()=>[e(q,{modelValue:d.name,"onUpdate:modelValue":o[0]||(o[0]=x=>d.name=x),placeholder:"请输入文档名称","show-word-limit":"","max-length":100},null,8,["modelValue"])]),_:1}),_("div",pe,[o[4]||(o[4]=_("div",{class:""},null,-1)),e(R,{size:16},{default:t(()=>[e(g,{class:"rounded-lg",onClick:b},{default:t(()=>o[2]||(o[2]=[u("取消")])),_:1}),e(g,{loading:h.value,type:"primary","html-type":"submit",class:"rounded-lg"},{default:t(()=>o[3]||(o[3]=[u(" 保存 ")])),_:1},8,["loading"])]),_:1})])]),_:1},8,["model"])])]),_:1},8,["visible"])}}}),ge={class:"p-6"},fe={class:"flex items-center w-full gap-2 mb-6"},ye={class:"flex items-center gap-3"},he={class:"flex flex-col justify-between h-[40px]"},be={key:1,class:"text-gray-700"},xe={key:2,class:"flex items-center gap-2"},ve={key:3,class:"flex items-center gap-2"},we={class:"flex items-center justify-between mb-6"},ke={class:""},De={class:"line-clamp-1"},ze={key:0,class:"w-2 h-2 bg-green-500 rounded-sm border border-green-700"},Ce={key:1,class:"w-2 h-2 bg-gray-500 rounded-sm border border-gray-700"},qe={key:2,class:"text-gray-700"},Se={key:3,class:"text-gray-700"},Be=T({__name:"ListView",setup(B){var q,S;const i=ae(),p=se(),v=N(!1),h=N(""),{dataset:d,loadDataset:w}=de((q=i.params)==null?void 0:q.dataset_id),{loading:b,documents:z,paginator:c,loadDocuments:o}=ie((S=i.params)==null?void 0:S.dataset_id),{handleDelete:C}=re(),{handleUpdate:g}=ce();return(R,l)=>{var P,A,G,H;const $=s("icon-left"),x=s("a-button"),I=s("router-link"),L=s("a-avatar"),U=s("a-skeleton-line"),j=s("a-tag"),W=s("a-input-search"),F=s("a-space"),f=s("a-table-column"),J=s("a-divider"),Y=s("a-switch"),K=s("a-tooltip"),O=s("icon-more"),E=s("a-doption"),Q=s("a-dropdown"),X=s("a-table");return r(),m("div",ge,[_("div",fe,[e(I,{to:{name:"space-datasets-list"}},{default:t(()=>[e(x,{size:"mini",type:"text",class:"!text-gray-700"},{icon:t(()=>[e($)]),_:1})]),_:1}),_("div",ye,[e(L,{size:40,shape:"square",class:"rounded-lg","image-url":a(d).icon},null,8,["image-url"]),_("div",he,[(P=a(d))!=null&&P.name?(r(),m("div",be,"知识库 / "+y(a(d).name),1)):(r(),M(U,{key:0,widths:[100]})),(A=a(d))!=null&&A.name?(r(),m("div",ve,[e(j,{size:"small",class:"rounded h-[18px] leading-[18px] bg-gray-200 text-gray-500"},{default:t(()=>[u(y(a(d).document_count)+" 文档",1)]),_:1}),e(j,{size:"small",class:"rounded h-[18px] leading-[18px] bg-gray-200 text-gray-500"},{default:t(()=>[u(y(a(d).hit_count)+" 命中",1)]),_:1}),e(j,{size:"small",class:"rounded h-[18px] leading-[18px] bg-gray-200 text-gray-500"},{default:t(()=>[u(y(a(d).related_app_count)+" 关联应用",1)]),_:1})])):(r(),m("div",xe,[e(U,{widths:[60],"line-height":18}),e(U,{widths:[60],"line-height":18}),e(U,{widths:[60],"line-height":18})]))])])]),_("div",we,[e(W,{"default-value":((G=a(i).query)==null?void 0:G.search_word)||"",placeholder:"请输入关键词搜素文档",class:"w-[240px] bg-white rounded-lg border-gray-200",onSearch:l[0]||(l[0]=n=>{a(p).push({path:a(i).path,query:{search_word:n,current_page:1}})})},null,8,["default-value"]),e(F,{size:12},{default:t(()=>[e(x,{class:"rounded-lg"},{default:t(()=>l[3]||(l[3]=[u("召回测试")])),_:1}),e(x,{type:"primary",class:"rounded-lg"},{default:t(()=>l[4]||(l[4]=[u("添加文件")])),_:1})]),_:1})]),_("div",ke,[e(X,{hoverable:"",pagination:{total:a(c).total_record,current:a(c).current_page,defaultCurrent:1,pageSize:a(c).page_size,defaultPageSize:10,showTotal:!0},loading:a(b),data:a(z),bordered:{wrapper:!1},onPageChange:l[1]||(l[1]=n=>{var V;a(p).push({path:a(i).path,query:{current_page:n,search_word:((V=a(i).query)==null?void 0:V.search_word)||""}})})},{columns:t(()=>[e(f,{title:"#","data-index":"position",align:"center",width:80,"header-cell-class":"rounded-tl-lg !bg-gray-200 text-gray-700","cell-class":"bg-transparent text-gray-700"}),e(f,{title:"文档名","data-index":"name",width:400,"header-cell-class":"!bg-gray-200 text-gray-700","cell-class":"bg-transparent text-gray-700"},{cell:t(({record:n})=>[_("div",De,y(n.name),1)]),_:1}),e(f,{title:"字符数","data-index":"character_count","header-cell-class":"!bg-gray-200 text-gray-700","cell-class":"bg-transparent text-gray-700"},{cell:t(({record:n})=>[u(y((n.character_count/1e3).toFixed(1))+"k ",1)]),_:1}),e(f,{title:"召回次数","data-index":"hit_count","header-cell-class":"!bg-gray-200 text-gray-700","cell-class":"bg-transparent text-gray-700"}),e(f,{title:"上传时间","data-index":"created_at","header-cell-class":"!bg-gray-200 text-gray-700","cell-class":"bg-transparent text-gray-700"},{cell:t(({record:n})=>[u(y(a(ne)(n.created_at*1e3).format("YYYY-MM-DD HH:mm:ss")),1)]),_:1}),e(f,{title:"状态","data-index":"enabled","header-cell-class":"!bg-gray-200 text-gray-700","cell-class":"bg-transparent text-gray-700"},{cell:t(({record:n})=>[e(F,null,{default:t(()=>[n.enabled?(r(),m("div",ze)):(r(),m("div",Ce)),n.enabled?(r(),m("div",qe,"可用")):(r(),m("div",Se,"已禁用"))]),_:2},1024)]),_:1}),e(f,{title:"操作","data-index":"operator","header-cell-class":"rounded-tr-lg !bg-gray-200 text-gray-700","cell-class":"bg-transparent text-gray-700 !h-[40px]",width:100},{cell:t(({record:n,rowIndex:V})=>[e(F,{size:0},{split:t(()=>[e(J,{direction:"vertical"})]),default:t(()=>[n.status==="error"?(r(),M(K,{key:0,content:`错误信息:${n.error}`},{default:t(()=>[e(Y,{size:"small",type:"round","default-checked":!1,disabled:""})]),_:2},1032,["content"])):(r(),M(Y,{key:1,size:"small","checked-color":"#10b981",type:"round","unchecked-color":"#556581","model-value":n.enabled,onChange:k=>{var D;a(g)((D=a(i).params)==null?void 0:D.dataset_id,n.id,k,()=>{a(z)[V].enabled=k})}},null,8,["model-value","onChange"])),e(Q,{position:"br"},{content:t(()=>[e(E,{onClick:()=>{v.value=!0,h.value=n.id}},{default:t(()=>l[5]||(l[5]=[u("重命名")])),_:2},1032,["onClick"]),e(E,{class:"!text-red-700",onClick:()=>{var k;return a(C)((k=a(i).params)==null?void 0:k.dataset_id,n.id,async()=>{var D;await a(o)(),await a(w)((D=a(i).params)==null?void 0:D.dataset_id)})}},{default:t(()=>l[6]||(l[6]=[u("删除")])),_:2},1032,["onClick"])]),default:t(()=>[e(x,{type:"text",size:"small",class:"!text-gray-700"},{icon:t(()=>[e(O)]),_:1})]),_:2},1024)]),_:2},1024)]),_:1})]),_:1},8,["pagination","loading","data"])]),e(me,{document_id:h.value,dataset_id:(H=a(i).params)==null?void 0:H.dataset_id,visible:v.value,"onUpdate:visible":l[2]||(l[2]=n=>v.value=n),"on-after-update":()=>a(o)()},null,8,["document_id","dataset_id","visible","on-after-update"])])}}});export{Be as default};
